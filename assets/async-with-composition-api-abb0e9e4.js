import{u as a,c as t,w as c,_ as p,o as r,a as s,d as l}from"./app-b1fb3549.js";const y=s("div",{class:"prose m-auto"},[s("p",null,"There is a major caveat when working with asynchronous functions in Vue Composition API, that I believe many of you have ever come across. I have acknowledged it for a while from somewhere, but every time I want to have a detailed reference and share to others, I can’t find it’s documented anywhere. So, I am thinking about writing one, with a detailed explanation while sorting out the possible solutions for you."),s("ul",null,[s("li",null,[s("a",{href:"#the-problem"},"The Problem")]),s("li",null,[s("a",{href:"#the-mechanism"},"The Mechanism")]),s("li",null,[s("a",{href:"#the-limitation"},"The Limitation")]),s("li",null,[s("a",{href:"#the-solutions"},"The Solutions")])]),s("h2",{id:"the-problem",tabindex:"-1"},[l("The Problem "),s("a",{class:"header-anchor",href:"#the-problem","aria-hidden":"true"},"#")]),s("p",null,[l("When using asynchronous "),s("code",null,"setup()"),l(", "),s("strong",null,[l("you have to use effects and lifecycle hooks before the first "),s("code",null,"await"),l(" statement.")]),l(" ("),s("a",{href:"https://github.com/vuejs/rfcs/discussions/234",target:"_blank",rel:"noopener"},"details"),l(")")]),s("p",null,"For example:"),s("pre",null,[s("code",{class:"language-ts"},[s("div",{class:"shiki-container"},[s("pre",{class:"shiki shiki-dark",style:{"background-color":"#121212"}},[s("code",{"v-pre":""},[s("span",{class:"line"},[s("span",{style:{color:"#4D9375"}},"import"),s("span",{style:{color:"#DBD7CAEE"}}," "),s("span",{style:{color:"#666666"}},"{"),s("span",{style:{color:"#DBD7CAEE"}}," "),s("span",{style:{color:"#BD976A"}},"ref"),s("span",{style:{color:"#666666"}},","),s("span",{style:{color:"#DBD7CAEE"}}," "),s("span",{style:{color:"#BD976A"}},"watch"),s("span",{style:{color:"#666666"}},","),s("span",{style:{color:"#DBD7CAEE"}}," "),s("span",{style:{color:"#BD976A"}},"onMounted"),s("span",{style:{color:"#666666"}},","),s("span",{style:{color:"#DBD7CAEE"}}," "),s("span",{style:{color:"#BD976A"}},"onUnmounted"),s("span",{style:{color:"#DBD7CAEE"}}," "),s("span",{style:{color:"#666666"}},"}"),s("span",{style:{color:"#DBD7CAEE"}}," "),s("span",{style:{color:"#4D9375"}},"from"),s("span",{style:{color:"#DBD7CAEE"}}," "),s("span",{style:{color:"#C98A7DAA"}},"'"),s("span",{style:{color:"#C98A7D"}},"vue"),s("span",{style:{color:"#C98A7DAA"}},"'")]),l(`
`),s("span",{class:"line"}),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#4D9375"}},"export"),s("span",{style:{color:"#DBD7CAEE"}}," "),s("span",{style:{color:"#4D9375"}},"default"),s("span",{style:{color:"#DBD7CAEE"}}," "),s("span",{style:{color:"#80A665"}},"defineAsyncComponent"),s("span",{style:{color:"#666666"}},"({")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#DBD7CAEE"}},"  "),s("span",{style:{color:"#CB7676"}},"async"),s("span",{style:{color:"#DBD7CAEE"}}," "),s("span",{style:{color:"#80A665"}},"setup"),s("span",{style:{color:"#666666"}},"()"),s("span",{style:{color:"#DBD7CAEE"}}," "),s("span",{style:{color:"#666666"}},"{")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#DBD7CAEE"}},"    "),s("span",{style:{color:"#CB7676"}},"const "),s("span",{style:{color:"#BD976A"}},"counter"),s("span",{style:{color:"#CB7676"}}," "),s("span",{style:{color:"#666666"}},"="),s("span",{style:{color:"#CB7676"}}," "),s("span",{style:{color:"#80A665"}},"ref"),s("span",{style:{color:"#666666"}},"("),s("span",{style:{color:"#4C9A91"}},"0"),s("span",{style:{color:"#666666"}},")")]),l(`
`),s("span",{class:"line"}),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#DBD7CAEE"}},"    "),s("span",{style:{color:"#80A665"}},"watch"),s("span",{style:{color:"#666666"}},"("),s("span",{style:{color:"#BD976A"}},"counter"),s("span",{style:{color:"#666666"}},","),s("span",{style:{color:"#DBD7CAEE"}}," "),s("span",{style:{color:"#666666"}},"()"),s("span",{style:{color:"#DBD7CAEE"}}," "),s("span",{style:{color:"#666666"}},"=>"),s("span",{style:{color:"#DBD7CAEE"}}," "),s("span",{style:{color:"#BD976A"}},"console"),s("span",{style:{color:"#666666"}},"."),s("span",{style:{color:"#80A665"}},"log"),s("span",{style:{color:"#666666"}},"("),s("span",{style:{color:"#BD976A"}},"counter"),s("span",{style:{color:"#666666"}},"."),s("span",{style:{color:"#BD976A"}},"value"),s("span",{style:{color:"#666666"}},"))")]),l(`
`),s("span",{class:"line"}),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#666666"}},"    "),s("span",{style:{color:"#758575DD"}},"// OK!")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#DBD7CAEE"}},"    "),s("span",{style:{color:"#80A665"}},"onMounted"),s("span",{style:{color:"#666666"}},"(()"),s("span",{style:{color:"#DBD7CAEE"}}," "),s("span",{style:{color:"#666666"}},"=>"),s("span",{style:{color:"#DBD7CAEE"}}," "),s("span",{style:{color:"#BD976A"}},"console"),s("span",{style:{color:"#666666"}},"."),s("span",{style:{color:"#80A665"}},"log"),s("span",{style:{color:"#666666"}},"("),s("span",{style:{color:"#C98A7DAA"}},"'"),s("span",{style:{color:"#C98A7D"}},"Mounted"),s("span",{style:{color:"#C98A7DAA"}},"'"),s("span",{style:{color:"#666666"}},"))")]),l(`
`),s("span",{class:"line"}),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#666666"}},"    "),s("span",{style:{color:"#758575DD"}},"// the await statement")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#DBD7CAEE"}},"    "),s("span",{style:{color:"#4D9375"}},"await"),s("span",{style:{color:"#DBD7CAEE"}}," "),s("span",{style:{color:"#80A665"}},"someAsyncFunction"),s("span",{style:{color:"#666666"}},"()"),s("span",{style:{color:"#DBD7CAEE"}}," "),s("span",{style:{color:"#758575DD"}},"// <-----------")]),l(`
`),s("span",{class:"line"}),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#666666"}},"    "),s("span",{style:{color:"#758575DD"}},"// does NOT work!")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#DBD7CAEE"}},"    "),s("span",{style:{color:"#80A665"}},"onUnmounted"),s("span",{style:{color:"#666666"}},"(()"),s("span",{style:{color:"#DBD7CAEE"}}," "),s("span",{style:{color:"#666666"}},"=>"),s("span",{style:{color:"#DBD7CAEE"}}," "),s("span",{style:{color:"#BD976A"}},"console"),s("span",{style:{color:"#666666"}},"."),s("span",{style:{color:"#80A665"}},"log"),s("span",{style:{color:"#666666"}},"("),s("span",{style:{color:"#C98A7DAA"}},"'"),s("span",{style:{color:"#C98A7D"}},"Unmounted"),s("span",{style:{color:"#C98A7DAA"}},"'"),s("span",{style:{color:"#666666"}},"))")]),l(`
`),s("span",{class:"line"}),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#666666"}},"    "),s("span",{style:{color:"#758575DD"}},"// still works, but does not auto-dispose ")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#666666"}},"    "),s("span",{style:{color:"#758575DD"}},"// after the component is destroyed (memory leak!)")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#DBD7CAEE"}},"    "),s("span",{style:{color:"#80A665"}},"watch"),s("span",{style:{color:"#666666"}},"("),s("span",{style:{color:"#BD976A"}},"counter"),s("span",{style:{color:"#666666"}},","),s("span",{style:{color:"#DBD7CAEE"}}," "),s("span",{style:{color:"#666666"}},"()"),s("span",{style:{color:"#DBD7CAEE"}}," "),s("span",{style:{color:"#666666"}},"=>"),s("span",{style:{color:"#DBD7CAEE"}}," "),s("span",{style:{color:"#BD976A"}},"console"),s("span",{style:{color:"#666666"}},"."),s("span",{style:{color:"#80A665"}},"log"),s("span",{style:{color:"#666666"}},"("),s("span",{style:{color:"#BD976A"}},"counter"),s("span",{style:{color:"#666666"}},"."),s("span",{style:{color:"#BD976A"}},"value"),s("span",{style:{color:"#DBD7CAEE"}}," "),s("span",{style:{color:"#CB7676"}},"*"),s("span",{style:{color:"#DBD7CAEE"}}," "),s("span",{style:{color:"#4C9A91"}},"2"),s("span",{style:{color:"#666666"}},"))")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#DBD7CAEE"}},"  "),s("span",{style:{color:"#666666"}},"}")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#666666"}},"})")]),l(`
`),s("span",{class:"line"})])]),s("pre",{class:"shiki shiki-light",style:{"background-color":"#ffffff"}},[s("code",{"v-pre":""},[s("span",{class:"line"},[s("span",{style:{color:"#1E754F"}},"import"),s("span",{style:{color:"#393A34"}}," "),s("span",{style:{color:"#999999"}},"{"),s("span",{style:{color:"#393A34"}}," "),s("span",{style:{color:"#B07D48"}},"ref"),s("span",{style:{color:"#999999"}},","),s("span",{style:{color:"#393A34"}}," "),s("span",{style:{color:"#B07D48"}},"watch"),s("span",{style:{color:"#999999"}},","),s("span",{style:{color:"#393A34"}}," "),s("span",{style:{color:"#B07D48"}},"onMounted"),s("span",{style:{color:"#999999"}},","),s("span",{style:{color:"#393A34"}}," "),s("span",{style:{color:"#B07D48"}},"onUnmounted"),s("span",{style:{color:"#393A34"}}," "),s("span",{style:{color:"#999999"}},"}"),s("span",{style:{color:"#393A34"}}," "),s("span",{style:{color:"#1E754F"}},"from"),s("span",{style:{color:"#393A34"}}," "),s("span",{style:{color:"#B56959AA"}},"'"),s("span",{style:{color:"#B56959"}},"vue"),s("span",{style:{color:"#B56959AA"}},"'")]),l(`
`),s("span",{class:"line"}),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#1E754F"}},"export"),s("span",{style:{color:"#393A34"}}," "),s("span",{style:{color:"#1E754F"}},"default"),s("span",{style:{color:"#393A34"}}," "),s("span",{style:{color:"#59873A"}},"defineAsyncComponent"),s("span",{style:{color:"#999999"}},"({")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#393A34"}},"  "),s("span",{style:{color:"#AB5959"}},"async"),s("span",{style:{color:"#393A34"}}," "),s("span",{style:{color:"#59873A"}},"setup"),s("span",{style:{color:"#999999"}},"()"),s("span",{style:{color:"#393A34"}}," "),s("span",{style:{color:"#999999"}},"{")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#393A34"}},"    "),s("span",{style:{color:"#AB5959"}},"const "),s("span",{style:{color:"#B07D48"}},"counter"),s("span",{style:{color:"#AB5959"}}," "),s("span",{style:{color:"#999999"}},"="),s("span",{style:{color:"#AB5959"}}," "),s("span",{style:{color:"#59873A"}},"ref"),s("span",{style:{color:"#999999"}},"("),s("span",{style:{color:"#2F798A"}},"0"),s("span",{style:{color:"#999999"}},")")]),l(`
`),s("span",{class:"line"}),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#393A34"}},"    "),s("span",{style:{color:"#59873A"}},"watch"),s("span",{style:{color:"#999999"}},"("),s("span",{style:{color:"#B07D48"}},"counter"),s("span",{style:{color:"#999999"}},","),s("span",{style:{color:"#393A34"}}," "),s("span",{style:{color:"#999999"}},"()"),s("span",{style:{color:"#393A34"}}," "),s("span",{style:{color:"#999999"}},"=>"),s("span",{style:{color:"#393A34"}}," "),s("span",{style:{color:"#B07D48"}},"console"),s("span",{style:{color:"#999999"}},"."),s("span",{style:{color:"#59873A"}},"log"),s("span",{style:{color:"#999999"}},"("),s("span",{style:{color:"#B07D48"}},"counter"),s("span",{style:{color:"#999999"}},"."),s("span",{style:{color:"#B07D48"}},"value"),s("span",{style:{color:"#999999"}},"))")]),l(`
`),s("span",{class:"line"}),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#999999"}},"    "),s("span",{style:{color:"#A0ADA0"}},"// OK!")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#393A34"}},"    "),s("span",{style:{color:"#59873A"}},"onMounted"),s("span",{style:{color:"#999999"}},"(()"),s("span",{style:{color:"#393A34"}}," "),s("span",{style:{color:"#999999"}},"=>"),s("span",{style:{color:"#393A34"}}," "),s("span",{style:{color:"#B07D48"}},"console"),s("span",{style:{color:"#999999"}},"."),s("span",{style:{color:"#59873A"}},"log"),s("span",{style:{color:"#999999"}},"("),s("span",{style:{color:"#B56959AA"}},"'"),s("span",{style:{color:"#B56959"}},"Mounted"),s("span",{style:{color:"#B56959AA"}},"'"),s("span",{style:{color:"#999999"}},"))")]),l(`
`),s("span",{class:"line"}),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#999999"}},"    "),s("span",{style:{color:"#A0ADA0"}},"// the await statement")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#393A34"}},"    "),s("span",{style:{color:"#1E754F"}},"await"),s("span",{style:{color:"#393A34"}}," "),s("span",{style:{color:"#59873A"}},"someAsyncFunction"),s("span",{style:{color:"#999999"}},"()"),s("span",{style:{color:"#393A34"}}," "),s("span",{style:{color:"#A0ADA0"}},"// <-----------")]),l(`
`),s("span",{class:"line"}),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#999999"}},"    "),s("span",{style:{color:"#A0ADA0"}},"// does NOT work!")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#393A34"}},"    "),s("span",{style:{color:"#59873A"}},"onUnmounted"),s("span",{style:{color:"#999999"}},"(()"),s("span",{style:{color:"#393A34"}}," "),s("span",{style:{color:"#999999"}},"=>"),s("span",{style:{color:"#393A34"}}," "),s("span",{style:{color:"#B07D48"}},"console"),s("span",{style:{color:"#999999"}},"."),s("span",{style:{color:"#59873A"}},"log"),s("span",{style:{color:"#999999"}},"("),s("span",{style:{color:"#B56959AA"}},"'"),s("span",{style:{color:"#B56959"}},"Unmounted"),s("span",{style:{color:"#B56959AA"}},"'"),s("span",{style:{color:"#999999"}},"))")]),l(`
`),s("span",{class:"line"}),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#999999"}},"    "),s("span",{style:{color:"#A0ADA0"}},"// still works, but does not auto-dispose ")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#999999"}},"    "),s("span",{style:{color:"#A0ADA0"}},"// after the component is destroyed (memory leak!)")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#393A34"}},"    "),s("span",{style:{color:"#59873A"}},"watch"),s("span",{style:{color:"#999999"}},"("),s("span",{style:{color:"#B07D48"}},"counter"),s("span",{style:{color:"#999999"}},","),s("span",{style:{color:"#393A34"}}," "),s("span",{style:{color:"#999999"}},"()"),s("span",{style:{color:"#393A34"}}," "),s("span",{style:{color:"#999999"}},"=>"),s("span",{style:{color:"#393A34"}}," "),s("span",{style:{color:"#B07D48"}},"console"),s("span",{style:{color:"#999999"}},"."),s("span",{style:{color:"#59873A"}},"log"),s("span",{style:{color:"#999999"}},"("),s("span",{style:{color:"#B07D48"}},"counter"),s("span",{style:{color:"#999999"}},"."),s("span",{style:{color:"#B07D48"}},"value"),s("span",{style:{color:"#393A34"}}," "),s("span",{style:{color:"#AB5959"}},"*"),s("span",{style:{color:"#393A34"}}," "),s("span",{style:{color:"#2F798A"}},"2"),s("span",{style:{color:"#999999"}},"))")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#393A34"}},"  "),s("span",{style:{color:"#999999"}},"}")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#999999"}},"})")]),l(`
`),s("span",{class:"line"})])])])])]),s("p",null,[l("After the "),s("code",null,"await"),l(" statement,")]),s("p",null,[l("the following functions will be "),s("strong",null,"limited"),l(" (no auto-dispose):")]),s("ul",null,[s("li",null,[s("code",null,"watch"),l(" / "),s("code",null,"watchEffect")]),s("li",null,[s("code",null,"computed")]),s("li",null,[s("code",null,"effect")])]),s("p",null,[l("the following functions will "),s("strong",null,"not work"),l(":")]),s("ul",null,[s("li",null,[s("code",null,"onMounted"),l(" / "),s("code",null,"onUnmounted"),l(" / "),s("code",null,"onXXX")]),s("li",null,[s("code",null,"provide"),l(" / "),s("code",null,"inject")]),s("li",null,[s("code",null,"getCurrentInstance")]),s("li",null,"…")]),s("h2",{id:"the-mechanism",tabindex:"-1"},[l("The Mechanism "),s("a",{class:"header-anchor",href:"#the-mechanism","aria-hidden":"true"},"#")]),s("p",null,[l("Let’s take the "),s("code",null,"onMounted"),l(" API as an example. As we know, "),s("code",null,"onMounted"),l(" is a hook that registers a listener when the current component gets mounted. Notice that "),s("code",null,"onMounted"),l(" (along with other composition APIs) are "),s("strong",null,"global"),l(', for what I mean "global" is that it can be imported and called anywhere - there is '),s("strong",null,"no local context"),l(" bound to it.")]),s("pre",null,[s("code",{class:"language-ts"},[s("div",{class:"shiki-container"},[s("pre",{class:"shiki shiki-dark",style:{"background-color":"#121212"}},[s("code",{"v-pre":""},[s("span",{class:"line"},[s("span",{style:{color:"#758575DD"}},"// local: `onMounted` is a method of `component` that bound to it")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#BD976A"}},"component"),s("span",{style:{color:"#666666"}},"."),s("span",{style:{color:"#80A665"}},"onMounted"),s("span",{style:{color:"#666666"}},"("),s("span",{style:{color:"#758575DD"}},"/* ... */"),s("span",{style:{color:"#666666"}},")")]),l(`
`),s("span",{class:"line"}),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#758575DD"}},"// global: `onMounted` can be called without context")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#80A665"}},"onMounted"),s("span",{style:{color:"#666666"}},"("),s("span",{style:{color:"#758575DD"}},"/* ... */"),s("span",{style:{color:"#666666"}},")")]),l(`
`),s("span",{class:"line"})])]),s("pre",{class:"shiki shiki-light",style:{"background-color":"#ffffff"}},[s("code",{"v-pre":""},[s("span",{class:"line"},[s("span",{style:{color:"#A0ADA0"}},"// local: `onMounted` is a method of `component` that bound to it")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#B07D48"}},"component"),s("span",{style:{color:"#999999"}},"."),s("span",{style:{color:"#59873A"}},"onMounted"),s("span",{style:{color:"#999999"}},"("),s("span",{style:{color:"#A0ADA0"}},"/* ... */"),s("span",{style:{color:"#999999"}},")")]),l(`
`),s("span",{class:"line"}),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A0ADA0"}},"// global: `onMounted` can be called without context")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#59873A"}},"onMounted"),s("span",{style:{color:"#999999"}},"("),s("span",{style:{color:"#A0ADA0"}},"/* ... */"),s("span",{style:{color:"#999999"}},")")]),l(`
`),s("span",{class:"line"})])])])])]),s("p",null,[l("So, how does "),s("code",null,"onMounted"),l(" know what component is being mounted?")]),s("p",null,"Vue takes an interesting approach to solve this. It uses an internal variable to record the current component instance. There is a simplified code:"),s("p",null,"When Vue mounts a component, it stores the instance in a global variable. When hooks been called inside the setup function, it will use the global variable to get the current component instance."),s("pre",null,[s("code",{class:"language-js"},[s("div",{class:"shiki-container"},[s("pre",{class:"shiki shiki-dark",style:{"background-color":"#121212"}},[s("code",{"v-pre":""},[s("span",{class:"line"},[s("span",{style:{color:"#CB7676"}},"let"),s("span",{style:{color:"#DBD7CAEE"}}," "),s("span",{style:{color:"#BD976A"}},"currentInstance"),s("span",{style:{color:"#DBD7CAEE"}}," "),s("span",{style:{color:"#666666"}},"="),s("span",{style:{color:"#DBD7CAEE"}}," "),s("span",{style:{color:"#CB7676"}},"null")]),l(`
`),s("span",{class:"line"}),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#758575DD"}},"// (pseudo code)")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#4D9375"}},"export"),s("span",{style:{color:"#DBD7CAEE"}}," "),s("span",{style:{color:"#CB7676"}},"function"),s("span",{style:{color:"#DBD7CAEE"}}," "),s("span",{style:{color:"#80A665"}},"mountComponent"),s("span",{style:{color:"#666666"}},"("),s("span",{style:{color:"#BD976A"}},"component"),s("span",{style:{color:"#666666"}},")"),s("span",{style:{color:"#DBD7CAEE"}}," "),s("span",{style:{color:"#666666"}},"{")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#DBD7CAEE"}},"  "),s("span",{style:{color:"#CB7676"}},"const"),s("span",{style:{color:"#DBD7CAEE"}}," "),s("span",{style:{color:"#BD976A"}},"instance"),s("span",{style:{color:"#DBD7CAEE"}}," "),s("span",{style:{color:"#666666"}},"="),s("span",{style:{color:"#DBD7CAEE"}}," "),s("span",{style:{color:"#80A665"}},"createComponent"),s("span",{style:{color:"#666666"}},"("),s("span",{style:{color:"#BD976A"}},"component"),s("span",{style:{color:"#666666"}},")")]),l(`
`),s("span",{class:"line"}),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#666666"}},"  "),s("span",{style:{color:"#758575DD"}},"// hold the previous instance")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#DBD7CAEE"}},"  "),s("span",{style:{color:"#CB7676"}},"const"),s("span",{style:{color:"#DBD7CAEE"}}," "),s("span",{style:{color:"#BD976A"}},"prev"),s("span",{style:{color:"#DBD7CAEE"}}," "),s("span",{style:{color:"#666666"}},"="),s("span",{style:{color:"#DBD7CAEE"}}," "),s("span",{style:{color:"#BD976A"}},"currentInstance")]),l(`
`),s("span",{class:"line"}),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#666666"}},"  "),s("span",{style:{color:"#758575DD"}},"// set the instance to global")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#DBD7CAEE"}},"  "),s("span",{style:{color:"#BD976A"}},"currentInstance"),s("span",{style:{color:"#DBD7CAEE"}}," "),s("span",{style:{color:"#666666"}},"="),s("span",{style:{color:"#DBD7CAEE"}}," "),s("span",{style:{color:"#BD976A"}},"instance")]),l(`
`),s("span",{class:"line"}),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#666666"}},"  "),s("span",{style:{color:"#758575DD"}},"// hooks called inside the `setup()` will have")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#666666"}},"  "),s("span",{style:{color:"#758575DD"}},"// the `currentInstance` as the context")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#DBD7CAEE"}},"  "),s("span",{style:{color:"#BD976A"}},"component"),s("span",{style:{color:"#666666"}},"."),s("span",{style:{color:"#80A665"}},"setup"),s("span",{style:{color:"#666666"}},"()"),s("span",{style:{color:"#DBD7CAEE"}}," ")]),l(`
`),s("span",{class:"line"}),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#666666"}},"  "),s("span",{style:{color:"#758575DD"}},"// restore the previous instance")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#DBD7CAEE"}},"  "),s("span",{style:{color:"#BD976A"}},"currentInstance"),s("span",{style:{color:"#DBD7CAEE"}}," "),s("span",{style:{color:"#666666"}},"="),s("span",{style:{color:"#DBD7CAEE"}}," "),s("span",{style:{color:"#BD976A"}},"prev"),s("span",{style:{color:"#DBD7CAEE"}}," ")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#666666"}},"}")]),l(`
`),s("span",{class:"line"})])]),s("pre",{class:"shiki shiki-light",style:{"background-color":"#ffffff"}},[s("code",{"v-pre":""},[s("span",{class:"line"},[s("span",{style:{color:"#AB5959"}},"let"),s("span",{style:{color:"#393A34"}}," "),s("span",{style:{color:"#B07D48"}},"currentInstance"),s("span",{style:{color:"#393A34"}}," "),s("span",{style:{color:"#999999"}},"="),s("span",{style:{color:"#393A34"}}," "),s("span",{style:{color:"#AB5959"}},"null")]),l(`
`),s("span",{class:"line"}),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A0ADA0"}},"// (pseudo code)")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#1E754F"}},"export"),s("span",{style:{color:"#393A34"}}," "),s("span",{style:{color:"#AB5959"}},"function"),s("span",{style:{color:"#393A34"}}," "),s("span",{style:{color:"#59873A"}},"mountComponent"),s("span",{style:{color:"#999999"}},"("),s("span",{style:{color:"#B07D48"}},"component"),s("span",{style:{color:"#999999"}},")"),s("span",{style:{color:"#393A34"}}," "),s("span",{style:{color:"#999999"}},"{")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#393A34"}},"  "),s("span",{style:{color:"#AB5959"}},"const"),s("span",{style:{color:"#393A34"}}," "),s("span",{style:{color:"#B07D48"}},"instance"),s("span",{style:{color:"#393A34"}}," "),s("span",{style:{color:"#999999"}},"="),s("span",{style:{color:"#393A34"}}," "),s("span",{style:{color:"#59873A"}},"createComponent"),s("span",{style:{color:"#999999"}},"("),s("span",{style:{color:"#B07D48"}},"component"),s("span",{style:{color:"#999999"}},")")]),l(`
`),s("span",{class:"line"}),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#999999"}},"  "),s("span",{style:{color:"#A0ADA0"}},"// hold the previous instance")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#393A34"}},"  "),s("span",{style:{color:"#AB5959"}},"const"),s("span",{style:{color:"#393A34"}}," "),s("span",{style:{color:"#B07D48"}},"prev"),s("span",{style:{color:"#393A34"}}," "),s("span",{style:{color:"#999999"}},"="),s("span",{style:{color:"#393A34"}}," "),s("span",{style:{color:"#B07D48"}},"currentInstance")]),l(`
`),s("span",{class:"line"}),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#999999"}},"  "),s("span",{style:{color:"#A0ADA0"}},"// set the instance to global")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#393A34"}},"  "),s("span",{style:{color:"#B07D48"}},"currentInstance"),s("span",{style:{color:"#393A34"}}," "),s("span",{style:{color:"#999999"}},"="),s("span",{style:{color:"#393A34"}}," "),s("span",{style:{color:"#B07D48"}},"instance")]),l(`
`),s("span",{class:"line"}),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#999999"}},"  "),s("span",{style:{color:"#A0ADA0"}},"// hooks called inside the `setup()` will have")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#999999"}},"  "),s("span",{style:{color:"#A0ADA0"}},"// the `currentInstance` as the context")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#393A34"}},"  "),s("span",{style:{color:"#B07D48"}},"component"),s("span",{style:{color:"#999999"}},"."),s("span",{style:{color:"#59873A"}},"setup"),s("span",{style:{color:"#999999"}},"()"),s("span",{style:{color:"#393A34"}}," ")]),l(`
`),s("span",{class:"line"}),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#999999"}},"  "),s("span",{style:{color:"#A0ADA0"}},"// restore the previous instance")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#393A34"}},"  "),s("span",{style:{color:"#B07D48"}},"currentInstance"),s("span",{style:{color:"#393A34"}}," "),s("span",{style:{color:"#999999"}},"="),s("span",{style:{color:"#393A34"}}," "),s("span",{style:{color:"#B07D48"}},"prev"),s("span",{style:{color:"#393A34"}}," ")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#999999"}},"}")]),l(`
`),s("span",{class:"line"})])])])])]),s("p",null,[l("A simplified "),s("code",null,"onMounted"),l(" implementation would be like:")]),s("pre",null,[s("code",{class:"language-js"},[s("div",{class:"shiki-container"},[s("pre",{class:"shiki shiki-dark",style:{"background-color":"#121212"}},[s("code",{"v-pre":""},[s("span",{class:"line"},[s("span",{style:{color:"#758575DD"}},"// (pseudo code)")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#4D9375"}},"export"),s("span",{style:{color:"#DBD7CAEE"}}," "),s("span",{style:{color:"#CB7676"}},"function"),s("span",{style:{color:"#DBD7CAEE"}}," "),s("span",{style:{color:"#80A665"}},"onMounted"),s("span",{style:{color:"#666666"}},"("),s("span",{style:{color:"#BD976A"}},"fn"),s("span",{style:{color:"#666666"}},")"),s("span",{style:{color:"#DBD7CAEE"}}," "),s("span",{style:{color:"#666666"}},"{")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#DBD7CAEE"}},"  "),s("span",{style:{color:"#4D9375"}},"if"),s("span",{style:{color:"#DBD7CAEE"}}," "),s("span",{style:{color:"#666666"}},"("),s("span",{style:{color:"#CB7676"}},"!"),s("span",{style:{color:"#BD976A"}},"currentInstance"),s("span",{style:{color:"#666666"}},")"),s("span",{style:{color:"#DBD7CAEE"}}," "),s("span",{style:{color:"#666666"}},"{")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#DBD7CAEE"}},"    "),s("span",{style:{color:"#80A665"}},"warn"),s("span",{style:{color:"#666666"}},"("),s("span",{style:{color:"#C98A7DAA"}},"`"),s("span",{style:{color:"#C98A7D"}},`"onMounted" can't be called outside of component setup()`),s("span",{style:{color:"#C98A7DAA"}},"`"),s("span",{style:{color:"#666666"}},")")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#DBD7CAEE"}},"    "),s("span",{style:{color:"#4D9375"}},"return")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#DBD7CAEE"}},"  "),s("span",{style:{color:"#666666"}},"}")]),l(`
`),s("span",{class:"line"}),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#666666"}},"  "),s("span",{style:{color:"#758575DD"}},"// bound listener to the current instance")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#DBD7CAEE"}},"  "),s("span",{style:{color:"#BD976A"}},"currentInstance"),s("span",{style:{color:"#666666"}},"."),s("span",{style:{color:"#80A665"}},"onMounted"),s("span",{style:{color:"#666666"}},"("),s("span",{style:{color:"#BD976A"}},"fn"),s("span",{style:{color:"#666666"}},")")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#666666"}},"}")]),l(`
`),s("span",{class:"line"})])]),s("pre",{class:"shiki shiki-light",style:{"background-color":"#ffffff"}},[s("code",{"v-pre":""},[s("span",{class:"line"},[s("span",{style:{color:"#A0ADA0"}},"// (pseudo code)")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#1E754F"}},"export"),s("span",{style:{color:"#393A34"}}," "),s("span",{style:{color:"#AB5959"}},"function"),s("span",{style:{color:"#393A34"}}," "),s("span",{style:{color:"#59873A"}},"onMounted"),s("span",{style:{color:"#999999"}},"("),s("span",{style:{color:"#B07D48"}},"fn"),s("span",{style:{color:"#999999"}},")"),s("span",{style:{color:"#393A34"}}," "),s("span",{style:{color:"#999999"}},"{")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#393A34"}},"  "),s("span",{style:{color:"#1E754F"}},"if"),s("span",{style:{color:"#393A34"}}," "),s("span",{style:{color:"#999999"}},"("),s("span",{style:{color:"#AB5959"}},"!"),s("span",{style:{color:"#B07D48"}},"currentInstance"),s("span",{style:{color:"#999999"}},")"),s("span",{style:{color:"#393A34"}}," "),s("span",{style:{color:"#999999"}},"{")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#393A34"}},"    "),s("span",{style:{color:"#59873A"}},"warn"),s("span",{style:{color:"#999999"}},"("),s("span",{style:{color:"#B56959AA"}},"`"),s("span",{style:{color:"#B56959"}},`"onMounted" can't be called outside of component setup()`),s("span",{style:{color:"#B56959AA"}},"`"),s("span",{style:{color:"#999999"}},")")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#393A34"}},"    "),s("span",{style:{color:"#1E754F"}},"return")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#393A34"}},"  "),s("span",{style:{color:"#999999"}},"}")]),l(`
`),s("span",{class:"line"}),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#999999"}},"  "),s("span",{style:{color:"#A0ADA0"}},"// bound listener to the current instance")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#393A34"}},"  "),s("span",{style:{color:"#B07D48"}},"currentInstance"),s("span",{style:{color:"#999999"}},"."),s("span",{style:{color:"#59873A"}},"onMounted"),s("span",{style:{color:"#999999"}},"("),s("span",{style:{color:"#B07D48"}},"fn"),s("span",{style:{color:"#999999"}},")")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#999999"}},"}")]),l(`
`),s("span",{class:"line"})])])])])]),s("p",null,[l("With this approach, as long as the "),s("code",null,"onMounted"),l(" is called inside the component "),s("code",null,"setup()"),l(", it will be able to get the instance of the current component.")]),s("h2",{id:"the-limitation",tabindex:"-1"},[l("The Limitation "),s("a",{class:"header-anchor",href:"#the-limitation","aria-hidden":"true"},"#")]),s("p",null,"So far so good, but what’s wrong with asynchronous functions?"),s("p",null,[l("The implementation would work based on the fact that JavaScript is "),s("strong",null,"single-threaded"),l(". Single thread makes sure the following statements will be executed right next to each other, which in other words, there is no one could accidentally modify the "),s("code",null,"currentInstance"),l(" at the same time (a.k.a. it’s "),s("a",{href:"https://stackoverflow.com/questions/52196678/what-are-atomic-operations-for-newbies",target:"_blank",rel:"noopener"},"atomic"),l(").")]),s("pre",null,[s("code",{class:"language-ts"},[s("div",{class:"shiki-container"},[s("pre",{class:"shiki shiki-dark",style:{"background-color":"#121212"}},[s("code",{"v-pre":""},[s("span",{class:"line"},[s("span",{style:{color:"#BD976A"}},"currentInstance"),s("span",{style:{color:"#DBD7CAEE"}}," "),s("span",{style:{color:"#666666"}},"="),s("span",{style:{color:"#DBD7CAEE"}}," "),s("span",{style:{color:"#BD976A"}},"instance")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#BD976A"}},"component"),s("span",{style:{color:"#666666"}},"."),s("span",{style:{color:"#80A665"}},"setup"),s("span",{style:{color:"#666666"}},"()"),s("span",{style:{color:"#DBD7CAEE"}}," ")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#BD976A"}},"currentInstance"),s("span",{style:{color:"#DBD7CAEE"}}," "),s("span",{style:{color:"#666666"}},"="),s("span",{style:{color:"#DBD7CAEE"}}," "),s("span",{style:{color:"#BD976A"}},"prev"),s("span",{style:{color:"#DBD7CAEE"}}," ")]),l(`
`),s("span",{class:"line"})])]),s("pre",{class:"shiki shiki-light",style:{"background-color":"#ffffff"}},[s("code",{"v-pre":""},[s("span",{class:"line"},[s("span",{style:{color:"#B07D48"}},"currentInstance"),s("span",{style:{color:"#393A34"}}," "),s("span",{style:{color:"#999999"}},"="),s("span",{style:{color:"#393A34"}}," "),s("span",{style:{color:"#B07D48"}},"instance")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#B07D48"}},"component"),s("span",{style:{color:"#999999"}},"."),s("span",{style:{color:"#59873A"}},"setup"),s("span",{style:{color:"#999999"}},"()"),s("span",{style:{color:"#393A34"}}," ")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#B07D48"}},"currentInstance"),s("span",{style:{color:"#393A34"}}," "),s("span",{style:{color:"#999999"}},"="),s("span",{style:{color:"#393A34"}}," "),s("span",{style:{color:"#B07D48"}},"prev"),s("span",{style:{color:"#393A34"}}," ")]),l(`
`),s("span",{class:"line"})])])])])]),s("p",null,[l("The situation changes when the "),s("code",null,"setup()"),l(" is asynchronous. Whenever you "),s("code",null,"await"),l(" a promise, you can think the engine paused the works here and went to do another task. If we "),s("code",null,"await"),l(" the function, during the time period, multiple components creation will change the global variable unpredictably and end up with a mess.")]),s("pre",null,[s("code",{class:"language-ts"},[s("div",{class:"shiki-container"},[s("pre",{class:"shiki shiki-dark",style:{"background-color":"#121212"}},[s("code",{"v-pre":""},[s("span",{class:"line"},[s("span",{style:{color:"#BD976A"}},"currentInstance"),s("span",{style:{color:"#DBD7CAEE"}}," "),s("span",{style:{color:"#666666"}},"="),s("span",{style:{color:"#DBD7CAEE"}}," "),s("span",{style:{color:"#BD976A"}},"instance")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#4D9375"}},"await"),s("span",{style:{color:"#DBD7CAEE"}}," "),s("span",{style:{color:"#BD976A"}},"component"),s("span",{style:{color:"#666666"}},"."),s("span",{style:{color:"#80A665"}},"setup"),s("span",{style:{color:"#666666"}},"()"),s("span",{style:{color:"#DBD7CAEE"}}," "),s("span",{style:{color:"#758575DD"}},"// atomic lost")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#BD976A"}},"currentInstance"),s("span",{style:{color:"#DBD7CAEE"}}," "),s("span",{style:{color:"#666666"}},"="),s("span",{style:{color:"#DBD7CAEE"}}," "),s("span",{style:{color:"#BD976A"}},"prev"),s("span",{style:{color:"#DBD7CAEE"}}," ")]),l(`
`),s("span",{class:"line"})])]),s("pre",{class:"shiki shiki-light",style:{"background-color":"#ffffff"}},[s("code",{"v-pre":""},[s("span",{class:"line"},[s("span",{style:{color:"#B07D48"}},"currentInstance"),s("span",{style:{color:"#393A34"}}," "),s("span",{style:{color:"#999999"}},"="),s("span",{style:{color:"#393A34"}}," "),s("span",{style:{color:"#B07D48"}},"instance")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#1E754F"}},"await"),s("span",{style:{color:"#393A34"}}," "),s("span",{style:{color:"#B07D48"}},"component"),s("span",{style:{color:"#999999"}},"."),s("span",{style:{color:"#59873A"}},"setup"),s("span",{style:{color:"#999999"}},"()"),s("span",{style:{color:"#393A34"}}," "),s("span",{style:{color:"#A0ADA0"}},"// atomic lost")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#B07D48"}},"currentInstance"),s("span",{style:{color:"#393A34"}}," "),s("span",{style:{color:"#999999"}},"="),s("span",{style:{color:"#393A34"}}," "),s("span",{style:{color:"#B07D48"}},"prev"),s("span",{style:{color:"#393A34"}}," ")]),l(`
`),s("span",{class:"line"})])])])])]),s("p",null,[l("If we don’t use "),s("code",null,"await"),l(" to check the instance, calling the "),s("code",null,"setup()"),l(" function will make it finish the tasks before the first "),s("code",null,"await"),l(" statement, and the rest will be executed whenever the "),s("code",null,"await"),l(" statement is resolved.")]),s("div",{class:"grid grid-cols-2 gap-2 lt-sm:grid-cols-1"},[s("pre",null,[s("code",{class:"language-ts"},[s("div",{class:"shiki-container"},[s("pre",{class:"shiki shiki-dark",style:{"background-color":"#121212"}},[s("code",{"v-pre":""},[s("span",{class:"line"},[s("span",{style:{color:"#CB7676"}},"async"),s("span",{style:{color:"#DBD7CAEE"}}," "),s("span",{style:{color:"#CB7676"}},"function"),s("span",{style:{color:"#DBD7CAEE"}}," "),s("span",{style:{color:"#80A665"}},"setup"),s("span",{style:{color:"#666666"}},"()"),s("span",{style:{color:"#DBD7CAEE"}}," "),s("span",{style:{color:"#666666"}},"{")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#DBD7CAEE"}},"  "),s("span",{style:{color:"#BD976A"}},"console"),s("span",{style:{color:"#666666"}},"."),s("span",{style:{color:"#80A665"}},"log"),s("span",{style:{color:"#666666"}},"("),s("span",{style:{color:"#4C9A91"}},"1"),s("span",{style:{color:"#666666"}},")")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#DBD7CAEE"}},"  "),s("span",{style:{color:"#4D9375"}},"await"),s("span",{style:{color:"#DBD7CAEE"}}," "),s("span",{style:{color:"#80A665"}},"someAsyncFunction"),s("span",{style:{color:"#666666"}},"()")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#DBD7CAEE"}},"  "),s("span",{style:{color:"#BD976A"}},"console"),s("span",{style:{color:"#666666"}},"."),s("span",{style:{color:"#80A665"}},"log"),s("span",{style:{color:"#666666"}},"("),s("span",{style:{color:"#4C9A91"}},"2"),s("span",{style:{color:"#666666"}},")")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#666666"}},"}")]),l(`
`),s("span",{class:"line"}),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#BD976A"}},"console"),s("span",{style:{color:"#666666"}},"."),s("span",{style:{color:"#80A665"}},"log"),s("span",{style:{color:"#666666"}},"("),s("span",{style:{color:"#4C9A91"}},"3"),s("span",{style:{color:"#666666"}},")")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#80A665"}},"setup"),s("span",{style:{color:"#666666"}},"()")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#BD976A"}},"console"),s("span",{style:{color:"#666666"}},"."),s("span",{style:{color:"#80A665"}},"log"),s("span",{style:{color:"#666666"}},"("),s("span",{style:{color:"#4C9A91"}},"4"),s("span",{style:{color:"#666666"}},")")]),l(`
`),s("span",{class:"line"})])]),s("pre",{class:"shiki shiki-light",style:{"background-color":"#ffffff"}},[s("code",{"v-pre":""},[s("span",{class:"line"},[s("span",{style:{color:"#AB5959"}},"async"),s("span",{style:{color:"#393A34"}}," "),s("span",{style:{color:"#AB5959"}},"function"),s("span",{style:{color:"#393A34"}}," "),s("span",{style:{color:"#59873A"}},"setup"),s("span",{style:{color:"#999999"}},"()"),s("span",{style:{color:"#393A34"}}," "),s("span",{style:{color:"#999999"}},"{")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#393A34"}},"  "),s("span",{style:{color:"#B07D48"}},"console"),s("span",{style:{color:"#999999"}},"."),s("span",{style:{color:"#59873A"}},"log"),s("span",{style:{color:"#999999"}},"("),s("span",{style:{color:"#2F798A"}},"1"),s("span",{style:{color:"#999999"}},")")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#393A34"}},"  "),s("span",{style:{color:"#1E754F"}},"await"),s("span",{style:{color:"#393A34"}}," "),s("span",{style:{color:"#59873A"}},"someAsyncFunction"),s("span",{style:{color:"#999999"}},"()")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#393A34"}},"  "),s("span",{style:{color:"#B07D48"}},"console"),s("span",{style:{color:"#999999"}},"."),s("span",{style:{color:"#59873A"}},"log"),s("span",{style:{color:"#999999"}},"("),s("span",{style:{color:"#2F798A"}},"2"),s("span",{style:{color:"#999999"}},")")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#999999"}},"}")]),l(`
`),s("span",{class:"line"}),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#B07D48"}},"console"),s("span",{style:{color:"#999999"}},"."),s("span",{style:{color:"#59873A"}},"log"),s("span",{style:{color:"#999999"}},"("),s("span",{style:{color:"#2F798A"}},"3"),s("span",{style:{color:"#999999"}},")")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#59873A"}},"setup"),s("span",{style:{color:"#999999"}},"()")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#B07D48"}},"console"),s("span",{style:{color:"#999999"}},"."),s("span",{style:{color:"#59873A"}},"log"),s("span",{style:{color:"#999999"}},"("),s("span",{style:{color:"#2F798A"}},"4"),s("span",{style:{color:"#999999"}},")")]),l(`
`),s("span",{class:"line"})])])])])]),s("pre",null,[s("code",{class:"language-ts"},[s("div",{class:"shiki-container"},[s("pre",{class:"shiki shiki-dark",style:{"background-color":"#121212"}},[s("code",{"v-pre":""},[s("span",{class:"line"},[s("span",{style:{color:"#758575DD"}},"// output:")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#4C9A91"}},"3")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#4C9A91"}},"1")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#4C9A91"}},"4")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#666666"}},"("),s("span",{style:{color:"#BD976A"}},"awaiting"),s("span",{style:{color:"#666666"}},")")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#4C9A91"}},"2")]),l(`
`),s("span",{class:"line"})])]),s("pre",{class:"shiki shiki-light",style:{"background-color":"#ffffff"}},[s("code",{"v-pre":""},[s("span",{class:"line"},[s("span",{style:{color:"#A0ADA0"}},"// output:")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#2F798A"}},"3")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#2F798A"}},"1")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#2F798A"}},"4")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#999999"}},"("),s("span",{style:{color:"#B07D48"}},"awaiting"),s("span",{style:{color:"#999999"}},")")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#2F798A"}},"2")]),l(`
`),s("span",{class:"line"})])])])])])]),s("p",null,"This means, there is no way for Vue to know when will the asynchronous part been called from the outside, so there is also no way to bound the instance to the context."),s("h2",{id:"the-solutions",tabindex:"-1"},[l("The Solutions "),s("a",{class:"header-anchor",href:"#the-solutions","aria-hidden":"true"},"#")]),s("p",null,"This is actually a limitation of JavaScript itself, unless we have some new proposal to open the gate on the language level, we have to live with it."),s("p",null,"But to work around it, I have collected a few solutions for you to choose from based on your needs."),s("h3",{id:"remember-the-caveat-and-avoid-it",tabindex:"-1"},[l("Remember the Caveat and Avoid It "),s("a",{class:"header-anchor",href:"#remember-the-caveat-and-avoid-it","aria-hidden":"true"},"#")]),s("p",null,[l('This is, of course, an obvious "solution". You can try to move your effect and hooks before the first '),s("code",null,"await"),l(" statement and carefully remember not to have them after that again.")]),s("p",null,[l("Luckily, if you are using ESLint, you can have the "),s("a",{href:"https://eslint.vuejs.org/rules/no-watch-after-await.html",target:"_blank",rel:"noopener"},[s("code",null,"vue/no-watch-after-await")]),l(" and "),s("a",{href:"https://eslint.vuejs.org/rules/no-lifecycle-after-await.html",target:"_blank",rel:"noopener"},[s("code",null,"vue/no-lifecycle-after-await")]),l(" rules from "),s("a",{href:"https://eslint.vuejs.org/",target:"_blank",rel:"noopener"},[s("code",null,"eslint-plugin-vue")]),l(" enabled so it could warn you whenever you made some mistakes (they are enabled by default within the plugin presets).")]),s("h3",{id:"wrap-the-async-function-as-reactive-sync",tabindex:"-1"},[l('Wrap the Async Function as "Reactive Sync" '),s("a",{class:"header-anchor",href:"#wrap-the-async-function-as-reactive-sync","aria-hidden":"true"},"#")]),s("p",null,[l("In some situations, your logic might be relying on the data that fetched asynchronously. In this way, you could consider using the "),s("a",{href:"/posts/composable-vue-vueday-2021#async-to-sync"},"trick I have shared on VueDay 2021"),l(" to "),s("strong",null,"turn your async function into a sync reactive state"),l(".")]),s("pre",null,[s("code",{class:"language-ts"},[s("div",{class:"shiki-container"},[s("pre",{class:"shiki shiki-dark",style:{"background-color":"#121212"}},[s("code",{"v-pre":""},[s("span",{class:"line"},[s("span",{style:{color:"#CB7676"}},"const "),s("span",{style:{color:"#BD976A"}},"data"),s("span",{style:{color:"#CB7676"}}," "),s("span",{style:{color:"#666666"}},"="),s("span",{style:{color:"#CB7676"}}," "),s("span",{style:{color:"#4D9375"}},"await"),s("span",{style:{color:"#CB7676"}}," "),s("span",{style:{color:"#80A665"}},"fetch"),s("span",{style:{color:"#666666"}},"("),s("span",{style:{color:"#C98A7DAA"}},"'"),s("span",{style:{color:"#C98A7D"}},"https://api.github.com/"),s("span",{style:{color:"#C98A7DAA"}},"'"),s("span",{style:{color:"#666666"}},")."),s("span",{style:{color:"#80A665"}},"then"),s("span",{style:{color:"#666666"}},"("),s("span",{style:{color:"#BD976A"}},"r"),s("span",{style:{color:"#CB7676"}}," "),s("span",{style:{color:"#666666"}},"=>"),s("span",{style:{color:"#CB7676"}}," "),s("span",{style:{color:"#BD976A"}},"r"),s("span",{style:{color:"#666666"}},"."),s("span",{style:{color:"#80A665"}},"json"),s("span",{style:{color:"#666666"}},"())")]),l(`
`),s("span",{class:"line"}),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#CB7676"}},"const "),s("span",{style:{color:"#BD976A"}},"user"),s("span",{style:{color:"#CB7676"}}," "),s("span",{style:{color:"#666666"}},"="),s("span",{style:{color:"#CB7676"}}," "),s("span",{style:{color:"#BD976A"}},"data"),s("span",{style:{color:"#666666"}},"."),s("span",{style:{color:"#BD976A"}},"user")]),l(`
`),s("span",{class:"line"})])]),s("pre",{class:"shiki shiki-light",style:{"background-color":"#ffffff"}},[s("code",{"v-pre":""},[s("span",{class:"line"},[s("span",{style:{color:"#AB5959"}},"const "),s("span",{style:{color:"#B07D48"}},"data"),s("span",{style:{color:"#AB5959"}}," "),s("span",{style:{color:"#999999"}},"="),s("span",{style:{color:"#AB5959"}}," "),s("span",{style:{color:"#1E754F"}},"await"),s("span",{style:{color:"#AB5959"}}," "),s("span",{style:{color:"#59873A"}},"fetch"),s("span",{style:{color:"#999999"}},"("),s("span",{style:{color:"#B56959AA"}},"'"),s("span",{style:{color:"#B56959"}},"https://api.github.com/"),s("span",{style:{color:"#B56959AA"}},"'"),s("span",{style:{color:"#999999"}},")."),s("span",{style:{color:"#59873A"}},"then"),s("span",{style:{color:"#999999"}},"("),s("span",{style:{color:"#B07D48"}},"r"),s("span",{style:{color:"#AB5959"}}," "),s("span",{style:{color:"#999999"}},"=>"),s("span",{style:{color:"#AB5959"}}," "),s("span",{style:{color:"#B07D48"}},"r"),s("span",{style:{color:"#999999"}},"."),s("span",{style:{color:"#59873A"}},"json"),s("span",{style:{color:"#999999"}},"())")]),l(`
`),s("span",{class:"line"}),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#AB5959"}},"const "),s("span",{style:{color:"#B07D48"}},"user"),s("span",{style:{color:"#AB5959"}}," "),s("span",{style:{color:"#999999"}},"="),s("span",{style:{color:"#AB5959"}}," "),s("span",{style:{color:"#B07D48"}},"data"),s("span",{style:{color:"#999999"}},"."),s("span",{style:{color:"#B07D48"}},"user")]),l(`
`),s("span",{class:"line"})])])])])]),s("pre",null,[s("code",{class:"language-ts"},[s("div",{class:"shiki-container"},[s("pre",{class:"shiki shiki-dark",style:{"background-color":"#121212"}},[s("code",{"v-pre":""},[s("span",{class:"line"},[s("span",{style:{color:"#CB7676"}},"const "),s("span",{style:{color:"#BD976A"}},"data"),s("span",{style:{color:"#CB7676"}}," "),s("span",{style:{color:"#666666"}},"="),s("span",{style:{color:"#CB7676"}}," "),s("span",{style:{color:"#80A665"}},"ref"),s("span",{style:{color:"#666666"}},"("),s("span",{style:{color:"#CB7676"}},"null"),s("span",{style:{color:"#666666"}},")")]),l(`
`),s("span",{class:"line"}),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#80A665"}},"fetch"),s("span",{style:{color:"#666666"}},"("),s("span",{style:{color:"#C98A7DAA"}},"'"),s("span",{style:{color:"#C98A7D"}},"https://api.github.com/"),s("span",{style:{color:"#C98A7DAA"}},"'"),s("span",{style:{color:"#666666"}},")")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#DBD7CAEE"}},"  "),s("span",{style:{color:"#666666"}},"."),s("span",{style:{color:"#80A665"}},"then"),s("span",{style:{color:"#666666"}},"("),s("span",{style:{color:"#BD976A"}},"r"),s("span",{style:{color:"#DBD7CAEE"}}," "),s("span",{style:{color:"#666666"}},"=>"),s("span",{style:{color:"#DBD7CAEE"}}," "),s("span",{style:{color:"#BD976A"}},"r"),s("span",{style:{color:"#666666"}},"."),s("span",{style:{color:"#80A665"}},"json"),s("span",{style:{color:"#666666"}},"())")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#DBD7CAEE"}},"  "),s("span",{style:{color:"#666666"}},"."),s("span",{style:{color:"#80A665"}},"then"),s("span",{style:{color:"#666666"}},"("),s("span",{style:{color:"#BD976A"}},"res"),s("span",{style:{color:"#DBD7CAEE"}}," "),s("span",{style:{color:"#666666"}},"=>"),s("span",{style:{color:"#DBD7CAEE"}}," "),s("span",{style:{color:"#BD976A"}},"data"),s("span",{style:{color:"#666666"}},"."),s("span",{style:{color:"#BD976A"}},"value"),s("span",{style:{color:"#DBD7CAEE"}}," "),s("span",{style:{color:"#666666"}},"="),s("span",{style:{color:"#DBD7CAEE"}}," "),s("span",{style:{color:"#BD976A"}},"res"),s("span",{style:{color:"#666666"}},")")]),l(`
`),s("span",{class:"line"}),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#CB7676"}},"const "),s("span",{style:{color:"#BD976A"}},"user"),s("span",{style:{color:"#CB7676"}}," "),s("span",{style:{color:"#666666"}},"="),s("span",{style:{color:"#CB7676"}}," "),s("span",{style:{color:"#80A665"}},"computed"),s("span",{style:{color:"#666666"}},"(()"),s("span",{style:{color:"#CB7676"}}," "),s("span",{style:{color:"#666666"}},"=>"),s("span",{style:{color:"#CB7676"}}," "),s("span",{style:{color:"#BD976A"}},"data"),s("span",{style:{color:"#666666"}},"?."),s("span",{style:{color:"#BD976A"}},"user"),s("span",{style:{color:"#666666"}},")")]),l(`
`),s("span",{class:"line"})])]),s("pre",{class:"shiki shiki-light",style:{"background-color":"#ffffff"}},[s("code",{"v-pre":""},[s("span",{class:"line"},[s("span",{style:{color:"#AB5959"}},"const "),s("span",{style:{color:"#B07D48"}},"data"),s("span",{style:{color:"#AB5959"}}," "),s("span",{style:{color:"#999999"}},"="),s("span",{style:{color:"#AB5959"}}," "),s("span",{style:{color:"#59873A"}},"ref"),s("span",{style:{color:"#999999"}},"("),s("span",{style:{color:"#AB5959"}},"null"),s("span",{style:{color:"#999999"}},")")]),l(`
`),s("span",{class:"line"}),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#59873A"}},"fetch"),s("span",{style:{color:"#999999"}},"("),s("span",{style:{color:"#B56959AA"}},"'"),s("span",{style:{color:"#B56959"}},"https://api.github.com/"),s("span",{style:{color:"#B56959AA"}},"'"),s("span",{style:{color:"#999999"}},")")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#393A34"}},"  "),s("span",{style:{color:"#999999"}},"."),s("span",{style:{color:"#59873A"}},"then"),s("span",{style:{color:"#999999"}},"("),s("span",{style:{color:"#B07D48"}},"r"),s("span",{style:{color:"#393A34"}}," "),s("span",{style:{color:"#999999"}},"=>"),s("span",{style:{color:"#393A34"}}," "),s("span",{style:{color:"#B07D48"}},"r"),s("span",{style:{color:"#999999"}},"."),s("span",{style:{color:"#59873A"}},"json"),s("span",{style:{color:"#999999"}},"())")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#393A34"}},"  "),s("span",{style:{color:"#999999"}},"."),s("span",{style:{color:"#59873A"}},"then"),s("span",{style:{color:"#999999"}},"("),s("span",{style:{color:"#B07D48"}},"res"),s("span",{style:{color:"#393A34"}}," "),s("span",{style:{color:"#999999"}},"=>"),s("span",{style:{color:"#393A34"}}," "),s("span",{style:{color:"#B07D48"}},"data"),s("span",{style:{color:"#999999"}},"."),s("span",{style:{color:"#B07D48"}},"value"),s("span",{style:{color:"#393A34"}}," "),s("span",{style:{color:"#999999"}},"="),s("span",{style:{color:"#393A34"}}," "),s("span",{style:{color:"#B07D48"}},"res"),s("span",{style:{color:"#999999"}},")")]),l(`
`),s("span",{class:"line"}),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#AB5959"}},"const "),s("span",{style:{color:"#B07D48"}},"user"),s("span",{style:{color:"#AB5959"}}," "),s("span",{style:{color:"#999999"}},"="),s("span",{style:{color:"#AB5959"}}," "),s("span",{style:{color:"#59873A"}},"computed"),s("span",{style:{color:"#999999"}},"(()"),s("span",{style:{color:"#AB5959"}}," "),s("span",{style:{color:"#999999"}},"=>"),s("span",{style:{color:"#AB5959"}}," "),s("span",{style:{color:"#B07D48"}},"data"),s("span",{style:{color:"#999999"}},"?."),s("span",{style:{color:"#B07D48"}},"user"),s("span",{style:{color:"#999999"}},")")]),l(`
`),s("span",{class:"line"})])])])])]),s("p",null,'This approach make the "connections" between your logic to resolve first, and then reactive updates when the asynchronous function get resolved and filled with data.'),s("p",null,[l("There is also some more general utilities for it from "),s("a",{href:"https://vueuse.org/",target:"_blank",rel:"noopener"},"VueUse"),l(":")]),s("h4",{id:"useasyncstate",tabindex:"-1"},[s("a",{href:"https://vueuse.org/useAsyncState",target:"_blank",rel:"noopener"},[s("code",null,"useAsyncState")]),l(),s("a",{class:"header-anchor",href:"#useasyncstate","aria-hidden":"true"},"#")]),s("pre",null,[s("code",{class:"language-ts"},[s("div",{class:"shiki-container"},[s("pre",{class:"shiki shiki-dark",style:{"background-color":"#121212"}},[s("code",{"v-pre":""},[s("span",{class:"line"},[s("span",{style:{color:"#4D9375"}},"import"),s("span",{style:{color:"#DBD7CAEE"}}," "),s("span",{style:{color:"#666666"}},"{"),s("span",{style:{color:"#DBD7CAEE"}}," "),s("span",{style:{color:"#BD976A"}},"useAsyncState"),s("span",{style:{color:"#DBD7CAEE"}}," "),s("span",{style:{color:"#666666"}},"}"),s("span",{style:{color:"#DBD7CAEE"}}," "),s("span",{style:{color:"#4D9375"}},"from"),s("span",{style:{color:"#DBD7CAEE"}}," "),s("span",{style:{color:"#C98A7DAA"}},"'"),s("span",{style:{color:"#C98A7D"}},"@vueuse/core"),s("span",{style:{color:"#C98A7DAA"}},"'")]),l(`
`),s("span",{class:"line"}),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#CB7676"}},"const "),s("span",{style:{color:"#666666"}},"{"),s("span",{style:{color:"#CB7676"}}," "),s("span",{style:{color:"#BD976A"}},"state"),s("span",{style:{color:"#666666"}},","),s("span",{style:{color:"#CB7676"}}," "),s("span",{style:{color:"#BD976A"}},"ready"),s("span",{style:{color:"#CB7676"}}," "),s("span",{style:{color:"#666666"}},"}"),s("span",{style:{color:"#CB7676"}}," "),s("span",{style:{color:"#666666"}},"="),s("span",{style:{color:"#CB7676"}}," "),s("span",{style:{color:"#80A665"}},"useAsyncState"),s("span",{style:{color:"#666666"}},"("),s("span",{style:{color:"#CB7676"}},"async "),s("span",{style:{color:"#666666"}},"()"),s("span",{style:{color:"#CB7676"}}," "),s("span",{style:{color:"#666666"}},"=>"),s("span",{style:{color:"#CB7676"}}," "),s("span",{style:{color:"#666666"}},"{")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#CB7676"}},"  const "),s("span",{style:{color:"#666666"}},"{"),s("span",{style:{color:"#CB7676"}}," "),s("span",{style:{color:"#BD976A"}},"data"),s("span",{style:{color:"#CB7676"}}," "),s("span",{style:{color:"#666666"}},"}"),s("span",{style:{color:"#CB7676"}}," "),s("span",{style:{color:"#666666"}},"="),s("span",{style:{color:"#CB7676"}}," "),s("span",{style:{color:"#4D9375"}},"await"),s("span",{style:{color:"#CB7676"}}," "),s("span",{style:{color:"#BD976A"}},"axios"),s("span",{style:{color:"#666666"}},"."),s("span",{style:{color:"#80A665"}},"get"),s("span",{style:{color:"#666666"}},"("),s("span",{style:{color:"#C98A7DAA"}},"'"),s("span",{style:{color:"#C98A7D"}},"https://api.github.com/"),s("span",{style:{color:"#C98A7DAA"}},"'"),s("span",{style:{color:"#666666"}},")")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#CB7676"}},"  "),s("span",{style:{color:"#4D9375"}},"return"),s("span",{style:{color:"#CB7676"}}," "),s("span",{style:{color:"#666666"}},"{"),s("span",{style:{color:"#CB7676"}}," "),s("span",{style:{color:"#BD976A"}},"data"),s("span",{style:{color:"#CB7676"}}," "),s("span",{style:{color:"#666666"}},"}")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#666666"}},"})")]),l(`
`),s("span",{class:"line"}),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#CB7676"}},"const "),s("span",{style:{color:"#BD976A"}},"user"),s("span",{style:{color:"#CB7676"}}," "),s("span",{style:{color:"#666666"}},"="),s("span",{style:{color:"#CB7676"}}," "),s("span",{style:{color:"#80A665"}},"computed"),s("span",{style:{color:"#666666"}},"(()"),s("span",{style:{color:"#CB7676"}}," "),s("span",{style:{color:"#666666"}},"=>"),s("span",{style:{color:"#CB7676"}}," "),s("span",{style:{color:"#BD976A"}},"state"),s("span",{style:{color:"#666666"}},"?."),s("span",{style:{color:"#BD976A"}},"user"),s("span",{style:{color:"#666666"}},")")]),l(`
`),s("span",{class:"line"})])]),s("pre",{class:"shiki shiki-light",style:{"background-color":"#ffffff"}},[s("code",{"v-pre":""},[s("span",{class:"line"},[s("span",{style:{color:"#1E754F"}},"import"),s("span",{style:{color:"#393A34"}}," "),s("span",{style:{color:"#999999"}},"{"),s("span",{style:{color:"#393A34"}}," "),s("span",{style:{color:"#B07D48"}},"useAsyncState"),s("span",{style:{color:"#393A34"}}," "),s("span",{style:{color:"#999999"}},"}"),s("span",{style:{color:"#393A34"}}," "),s("span",{style:{color:"#1E754F"}},"from"),s("span",{style:{color:"#393A34"}}," "),s("span",{style:{color:"#B56959AA"}},"'"),s("span",{style:{color:"#B56959"}},"@vueuse/core"),s("span",{style:{color:"#B56959AA"}},"'")]),l(`
`),s("span",{class:"line"}),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#AB5959"}},"const "),s("span",{style:{color:"#999999"}},"{"),s("span",{style:{color:"#AB5959"}}," "),s("span",{style:{color:"#B07D48"}},"state"),s("span",{style:{color:"#999999"}},","),s("span",{style:{color:"#AB5959"}}," "),s("span",{style:{color:"#B07D48"}},"ready"),s("span",{style:{color:"#AB5959"}}," "),s("span",{style:{color:"#999999"}},"}"),s("span",{style:{color:"#AB5959"}}," "),s("span",{style:{color:"#999999"}},"="),s("span",{style:{color:"#AB5959"}}," "),s("span",{style:{color:"#59873A"}},"useAsyncState"),s("span",{style:{color:"#999999"}},"("),s("span",{style:{color:"#AB5959"}},"async "),s("span",{style:{color:"#999999"}},"()"),s("span",{style:{color:"#AB5959"}}," "),s("span",{style:{color:"#999999"}},"=>"),s("span",{style:{color:"#AB5959"}}," "),s("span",{style:{color:"#999999"}},"{")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#AB5959"}},"  const "),s("span",{style:{color:"#999999"}},"{"),s("span",{style:{color:"#AB5959"}}," "),s("span",{style:{color:"#B07D48"}},"data"),s("span",{style:{color:"#AB5959"}}," "),s("span",{style:{color:"#999999"}},"}"),s("span",{style:{color:"#AB5959"}}," "),s("span",{style:{color:"#999999"}},"="),s("span",{style:{color:"#AB5959"}}," "),s("span",{style:{color:"#1E754F"}},"await"),s("span",{style:{color:"#AB5959"}}," "),s("span",{style:{color:"#B07D48"}},"axios"),s("span",{style:{color:"#999999"}},"."),s("span",{style:{color:"#59873A"}},"get"),s("span",{style:{color:"#999999"}},"("),s("span",{style:{color:"#B56959AA"}},"'"),s("span",{style:{color:"#B56959"}},"https://api.github.com/"),s("span",{style:{color:"#B56959AA"}},"'"),s("span",{style:{color:"#999999"}},")")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#AB5959"}},"  "),s("span",{style:{color:"#1E754F"}},"return"),s("span",{style:{color:"#AB5959"}}," "),s("span",{style:{color:"#999999"}},"{"),s("span",{style:{color:"#AB5959"}}," "),s("span",{style:{color:"#B07D48"}},"data"),s("span",{style:{color:"#AB5959"}}," "),s("span",{style:{color:"#999999"}},"}")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#999999"}},"})")]),l(`
`),s("span",{class:"line"}),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#AB5959"}},"const "),s("span",{style:{color:"#B07D48"}},"user"),s("span",{style:{color:"#AB5959"}}," "),s("span",{style:{color:"#999999"}},"="),s("span",{style:{color:"#AB5959"}}," "),s("span",{style:{color:"#59873A"}},"computed"),s("span",{style:{color:"#999999"}},"(()"),s("span",{style:{color:"#AB5959"}}," "),s("span",{style:{color:"#999999"}},"=>"),s("span",{style:{color:"#AB5959"}}," "),s("span",{style:{color:"#B07D48"}},"state"),s("span",{style:{color:"#999999"}},"?."),s("span",{style:{color:"#B07D48"}},"user"),s("span",{style:{color:"#999999"}},")")]),l(`
`),s("span",{class:"line"})])])])])]),s("h4",{id:"usefetch",tabindex:"-1"},[s("a",{href:"https://vueuse.org/useFetch",target:"_blank",rel:"noopener"},[s("code",null,"useFetch")]),l(),s("a",{class:"header-anchor",href:"#usefetch","aria-hidden":"true"},"#")]),s("pre",null,[s("code",{class:"language-ts"},[s("div",{class:"shiki-container"},[s("pre",{class:"shiki shiki-dark",style:{"background-color":"#121212"}},[s("code",{"v-pre":""},[s("span",{class:"line"},[s("span",{style:{color:"#4D9375"}},"import"),s("span",{style:{color:"#DBD7CAEE"}}," "),s("span",{style:{color:"#666666"}},"{"),s("span",{style:{color:"#DBD7CAEE"}}," "),s("span",{style:{color:"#BD976A"}},"useFetch"),s("span",{style:{color:"#DBD7CAEE"}}," "),s("span",{style:{color:"#666666"}},"}"),s("span",{style:{color:"#DBD7CAEE"}}," "),s("span",{style:{color:"#4D9375"}},"from"),s("span",{style:{color:"#DBD7CAEE"}}," "),s("span",{style:{color:"#C98A7DAA"}},"'"),s("span",{style:{color:"#C98A7D"}},"@vueuse/core"),s("span",{style:{color:"#C98A7DAA"}},"'")]),l(`
`),s("span",{class:"line"}),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#CB7676"}},"const "),s("span",{style:{color:"#666666"}},"{"),s("span",{style:{color:"#CB7676"}}," "),s("span",{style:{color:"#BD976A"}},"data"),s("span",{style:{color:"#666666"}},","),s("span",{style:{color:"#CB7676"}}," "),s("span",{style:{color:"#BD976A"}},"isFetching"),s("span",{style:{color:"#666666"}},","),s("span",{style:{color:"#CB7676"}}," "),s("span",{style:{color:"#BD976A"}},"error"),s("span",{style:{color:"#CB7676"}}," "),s("span",{style:{color:"#666666"}},"}"),s("span",{style:{color:"#CB7676"}}," "),s("span",{style:{color:"#666666"}},"="),s("span",{style:{color:"#CB7676"}}," "),s("span",{style:{color:"#80A665"}},"useFetch"),s("span",{style:{color:"#666666"}},"("),s("span",{style:{color:"#C98A7DAA"}},"'"),s("span",{style:{color:"#C98A7D"}},"https://api.github.com/"),s("span",{style:{color:"#C98A7DAA"}},"'"),s("span",{style:{color:"#666666"}},")")]),l(`
`),s("span",{class:"line"}),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#CB7676"}},"const "),s("span",{style:{color:"#BD976A"}},"user"),s("span",{style:{color:"#CB7676"}}," "),s("span",{style:{color:"#666666"}},"="),s("span",{style:{color:"#CB7676"}}," "),s("span",{style:{color:"#80A665"}},"computed"),s("span",{style:{color:"#666666"}},"(()"),s("span",{style:{color:"#CB7676"}}," "),s("span",{style:{color:"#666666"}},"=>"),s("span",{style:{color:"#CB7676"}}," "),s("span",{style:{color:"#BD976A"}},"data"),s("span",{style:{color:"#666666"}},"?."),s("span",{style:{color:"#BD976A"}},"user"),s("span",{style:{color:"#666666"}},")")]),l(`
`),s("span",{class:"line"})])]),s("pre",{class:"shiki shiki-light",style:{"background-color":"#ffffff"}},[s("code",{"v-pre":""},[s("span",{class:"line"},[s("span",{style:{color:"#1E754F"}},"import"),s("span",{style:{color:"#393A34"}}," "),s("span",{style:{color:"#999999"}},"{"),s("span",{style:{color:"#393A34"}}," "),s("span",{style:{color:"#B07D48"}},"useFetch"),s("span",{style:{color:"#393A34"}}," "),s("span",{style:{color:"#999999"}},"}"),s("span",{style:{color:"#393A34"}}," "),s("span",{style:{color:"#1E754F"}},"from"),s("span",{style:{color:"#393A34"}}," "),s("span",{style:{color:"#B56959AA"}},"'"),s("span",{style:{color:"#B56959"}},"@vueuse/core"),s("span",{style:{color:"#B56959AA"}},"'")]),l(`
`),s("span",{class:"line"}),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#AB5959"}},"const "),s("span",{style:{color:"#999999"}},"{"),s("span",{style:{color:"#AB5959"}}," "),s("span",{style:{color:"#B07D48"}},"data"),s("span",{style:{color:"#999999"}},","),s("span",{style:{color:"#AB5959"}}," "),s("span",{style:{color:"#B07D48"}},"isFetching"),s("span",{style:{color:"#999999"}},","),s("span",{style:{color:"#AB5959"}}," "),s("span",{style:{color:"#B07D48"}},"error"),s("span",{style:{color:"#AB5959"}}," "),s("span",{style:{color:"#999999"}},"}"),s("span",{style:{color:"#AB5959"}}," "),s("span",{style:{color:"#999999"}},"="),s("span",{style:{color:"#AB5959"}}," "),s("span",{style:{color:"#59873A"}},"useFetch"),s("span",{style:{color:"#999999"}},"("),s("span",{style:{color:"#B56959AA"}},"'"),s("span",{style:{color:"#B56959"}},"https://api.github.com/"),s("span",{style:{color:"#B56959AA"}},"'"),s("span",{style:{color:"#999999"}},")")]),l(`
`),s("span",{class:"line"}),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#AB5959"}},"const "),s("span",{style:{color:"#B07D48"}},"user"),s("span",{style:{color:"#AB5959"}}," "),s("span",{style:{color:"#999999"}},"="),s("span",{style:{color:"#AB5959"}}," "),s("span",{style:{color:"#59873A"}},"computed"),s("span",{style:{color:"#999999"}},"(()"),s("span",{style:{color:"#AB5959"}}," "),s("span",{style:{color:"#999999"}},"=>"),s("span",{style:{color:"#AB5959"}}," "),s("span",{style:{color:"#B07D48"}},"data"),s("span",{style:{color:"#999999"}},"?."),s("span",{style:{color:"#B07D48"}},"user"),s("span",{style:{color:"#999999"}},")")]),l(`
`),s("span",{class:"line"})])])])])]),s("h3",{id:"explicitly-bound-the-instance",tabindex:"-1"},[l("Explicitly Bound the Instance "),s("a",{class:"header-anchor",href:"#explicitly-bound-the-instance","aria-hidden":"true"},"#")]),s("p",null,"Lifecycle hooks actually accept a second argument for setting the instance explicitly."),s("pre",null,[s("code",{class:"language-ts"},[s("div",{class:"shiki-container"},[s("pre",{class:"shiki shiki-dark",style:{"background-color":"#121212"}},[s("code",{"v-pre":""},[s("span",{class:"line"},[s("span",{style:{color:"#4D9375"}},"export"),s("span",{style:{color:"#DBD7CAEE"}}," "),s("span",{style:{color:"#4D9375"}},"default"),s("span",{style:{color:"#DBD7CAEE"}}," "),s("span",{style:{color:"#80A665"}},"defineAsyncComponent"),s("span",{style:{color:"#666666"}},"({")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#DBD7CAEE"}},"  "),s("span",{style:{color:"#CB7676"}},"async"),s("span",{style:{color:"#DBD7CAEE"}}," "),s("span",{style:{color:"#80A665"}},"setup"),s("span",{style:{color:"#666666"}},"()"),s("span",{style:{color:"#DBD7CAEE"}}," "),s("span",{style:{color:"#666666"}},"{")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#666666"}},"    "),s("span",{style:{color:"#758575DD"}},"// get and hold the instance before `await`")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#DBD7CAEE"}},"    "),s("span",{style:{color:"#CB7676"}},"const "),s("span",{style:{color:"#BD976A"}},"instance"),s("span",{style:{color:"#CB7676"}}," "),s("span",{style:{color:"#666666"}},"="),s("span",{style:{color:"#CB7676"}}," "),s("span",{style:{color:"#80A665"}},"getCurrentInstance"),s("span",{style:{color:"#666666"}},"()")]),l(`
`),s("span",{class:"line"}),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#DBD7CAEE"}},"    "),s("span",{style:{color:"#4D9375"}},"await"),s("span",{style:{color:"#DBD7CAEE"}}," "),s("span",{style:{color:"#80A665"}},"someAsyncFunction"),s("span",{style:{color:"#666666"}},"()"),s("span",{style:{color:"#DBD7CAEE"}}," "),s("span",{style:{color:"#758575DD"}},"// <-----------")]),l(`
`),s("span",{class:"line"}),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#DBD7CAEE"}},"    "),s("span",{style:{color:"#80A665"}},"onUnmounted"),s("span",{style:{color:"#666666"}},"(")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#DBD7CAEE"}},"      "),s("span",{style:{color:"#666666"}},"()"),s("span",{style:{color:"#DBD7CAEE"}}," "),s("span",{style:{color:"#666666"}},"=>"),s("span",{style:{color:"#DBD7CAEE"}}," "),s("span",{style:{color:"#BD976A"}},"console"),s("span",{style:{color:"#666666"}},"."),s("span",{style:{color:"#80A665"}},"log"),s("span",{style:{color:"#666666"}},"("),s("span",{style:{color:"#C98A7DAA"}},"'"),s("span",{style:{color:"#C98A7D"}},"Unmounted"),s("span",{style:{color:"#C98A7DAA"}},"'"),s("span",{style:{color:"#666666"}},"),")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#DBD7CAEE"}},"      "),s("span",{style:{color:"#BD976A"}},"instance"),s("span",{style:{color:"#DBD7CAEE"}}," "),s("span",{style:{color:"#758575DD"}},"// <--- pass the instance to it")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#DBD7CAEE"}},"    "),s("span",{style:{color:"#666666"}},")")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#DBD7CAEE"}},"  "),s("span",{style:{color:"#666666"}},"}")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#666666"}},"})")]),l(`
`),s("span",{class:"line"})])]),s("pre",{class:"shiki shiki-light",style:{"background-color":"#ffffff"}},[s("code",{"v-pre":""},[s("span",{class:"line"},[s("span",{style:{color:"#1E754F"}},"export"),s("span",{style:{color:"#393A34"}}," "),s("span",{style:{color:"#1E754F"}},"default"),s("span",{style:{color:"#393A34"}}," "),s("span",{style:{color:"#59873A"}},"defineAsyncComponent"),s("span",{style:{color:"#999999"}},"({")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#393A34"}},"  "),s("span",{style:{color:"#AB5959"}},"async"),s("span",{style:{color:"#393A34"}}," "),s("span",{style:{color:"#59873A"}},"setup"),s("span",{style:{color:"#999999"}},"()"),s("span",{style:{color:"#393A34"}}," "),s("span",{style:{color:"#999999"}},"{")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#999999"}},"    "),s("span",{style:{color:"#A0ADA0"}},"// get and hold the instance before `await`")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#393A34"}},"    "),s("span",{style:{color:"#AB5959"}},"const "),s("span",{style:{color:"#B07D48"}},"instance"),s("span",{style:{color:"#AB5959"}}," "),s("span",{style:{color:"#999999"}},"="),s("span",{style:{color:"#AB5959"}}," "),s("span",{style:{color:"#59873A"}},"getCurrentInstance"),s("span",{style:{color:"#999999"}},"()")]),l(`
`),s("span",{class:"line"}),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#393A34"}},"    "),s("span",{style:{color:"#1E754F"}},"await"),s("span",{style:{color:"#393A34"}}," "),s("span",{style:{color:"#59873A"}},"someAsyncFunction"),s("span",{style:{color:"#999999"}},"()"),s("span",{style:{color:"#393A34"}}," "),s("span",{style:{color:"#A0ADA0"}},"// <-----------")]),l(`
`),s("span",{class:"line"}),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#393A34"}},"    "),s("span",{style:{color:"#59873A"}},"onUnmounted"),s("span",{style:{color:"#999999"}},"(")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#393A34"}},"      "),s("span",{style:{color:"#999999"}},"()"),s("span",{style:{color:"#393A34"}}," "),s("span",{style:{color:"#999999"}},"=>"),s("span",{style:{color:"#393A34"}}," "),s("span",{style:{color:"#B07D48"}},"console"),s("span",{style:{color:"#999999"}},"."),s("span",{style:{color:"#59873A"}},"log"),s("span",{style:{color:"#999999"}},"("),s("span",{style:{color:"#B56959AA"}},"'"),s("span",{style:{color:"#B56959"}},"Unmounted"),s("span",{style:{color:"#B56959AA"}},"'"),s("span",{style:{color:"#999999"}},"),")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#393A34"}},"      "),s("span",{style:{color:"#B07D48"}},"instance"),s("span",{style:{color:"#393A34"}}," "),s("span",{style:{color:"#A0ADA0"}},"// <--- pass the instance to it")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#393A34"}},"    "),s("span",{style:{color:"#999999"}},")")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#393A34"}},"  "),s("span",{style:{color:"#999999"}},"}")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#999999"}},"})")]),l(`
`),s("span",{class:"line"})])])])])]),s("p",null,[l("However, the downside is that this solution "),s("strong",null,"does not work"),l(" with "),s("code",null,"watch"),l(" / "),s("code",null,"watchEffect"),l(" / "),s("code",null,"computed"),l(" / "),s("code",null,"provide"),l(" / "),s("code",null,"inject"),l(" as they does not accept the instance argument.")]),s("p",null,[l("To get the effects work, you could use the "),s("a",{href:"https://github.com/vuejs/rfcs/blob/master/active-rfcs/0041-reactivity-effect-scope.md",target:"_blank",rel:"noopener"},[s("code",null,"effectScope"),l(" API")]),l(" in the upcoming Vue 3.2.")]),s("pre",null,[s("code",{class:"language-ts"},[s("div",{class:"shiki-container"},[s("pre",{class:"shiki shiki-dark",style:{"background-color":"#121212"}},[s("code",{"v-pre":""},[s("span",{class:"line"},[s("span",{style:{color:"#4D9375"}},"import"),s("span",{style:{color:"#DBD7CAEE"}}," "),s("span",{style:{color:"#666666"}},"{"),s("span",{style:{color:"#DBD7CAEE"}}," "),s("span",{style:{color:"#BD976A"}},"effectScope"),s("span",{style:{color:"#DBD7CAEE"}}," "),s("span",{style:{color:"#666666"}},"}"),s("span",{style:{color:"#DBD7CAEE"}}," "),s("span",{style:{color:"#4D9375"}},"from"),s("span",{style:{color:"#DBD7CAEE"}}," "),s("span",{style:{color:"#C98A7DAA"}},"'"),s("span",{style:{color:"#C98A7D"}},"vue"),s("span",{style:{color:"#C98A7DAA"}},"'")]),l(`
`),s("span",{class:"line"}),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#4D9375"}},"export"),s("span",{style:{color:"#DBD7CAEE"}}," "),s("span",{style:{color:"#4D9375"}},"default"),s("span",{style:{color:"#DBD7CAEE"}}," "),s("span",{style:{color:"#80A665"}},"defineAsyncComponent"),s("span",{style:{color:"#666666"}},"({")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#DBD7CAEE"}},"  "),s("span",{style:{color:"#CB7676"}},"async"),s("span",{style:{color:"#DBD7CAEE"}}," "),s("span",{style:{color:"#80A665"}},"setup"),s("span",{style:{color:"#666666"}},"()"),s("span",{style:{color:"#DBD7CAEE"}}," "),s("span",{style:{color:"#666666"}},"{")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#666666"}},"    "),s("span",{style:{color:"#758575DD"}},"// create the scope before `await`, so it will be bond to the instance")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#DBD7CAEE"}},"    "),s("span",{style:{color:"#CB7676"}},"const "),s("span",{style:{color:"#BD976A"}},"scope"),s("span",{style:{color:"#CB7676"}}," "),s("span",{style:{color:"#666666"}},"="),s("span",{style:{color:"#CB7676"}}," "),s("span",{style:{color:"#80A665"}},"effectScope"),s("span",{style:{color:"#666666"}},"()")]),l(`
`),s("span",{class:"line"}),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#DBD7CAEE"}},"    "),s("span",{style:{color:"#CB7676"}},"const "),s("span",{style:{color:"#BD976A"}},"data"),s("span",{style:{color:"#CB7676"}}," "),s("span",{style:{color:"#666666"}},"="),s("span",{style:{color:"#CB7676"}}," "),s("span",{style:{color:"#4D9375"}},"await"),s("span",{style:{color:"#CB7676"}}," "),s("span",{style:{color:"#80A665"}},"someAsyncFunction"),s("span",{style:{color:"#666666"}},"()"),s("span",{style:{color:"#CB7676"}}," "),s("span",{style:{color:"#758575DD"}},"// <-----------")]),l(`
`),s("span",{class:"line"}),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#DBD7CAEE"}},"    "),s("span",{style:{color:"#BD976A"}},"scope"),s("span",{style:{color:"#666666"}},"."),s("span",{style:{color:"#80A665"}},"run"),s("span",{style:{color:"#666666"}},"(()"),s("span",{style:{color:"#DBD7CAEE"}}," "),s("span",{style:{color:"#666666"}},"=>"),s("span",{style:{color:"#DBD7CAEE"}}," "),s("span",{style:{color:"#666666"}},"{")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#DBD7CAEE"}},"      "),s("span",{style:{color:"#758575DD"}},"/* Use `computed`, `watch`, etc. ... */")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#DBD7CAEE"}},"    "),s("span",{style:{color:"#666666"}},"})")]),l(`
`),s("span",{class:"line"}),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#666666"}},"    "),s("span",{style:{color:"#758575DD"}},"// the lifecycle hooks will not be available here,")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#666666"}},"    "),s("span",{style:{color:"#758575DD"}},"// you will need to combine it with the previous snippet")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#666666"}},"    "),s("span",{style:{color:"#758575DD"}},"// to have both lifecycle hooks and effects works.")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#DBD7CAEE"}},"  "),s("span",{style:{color:"#666666"}},"}")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#666666"}},"})")]),l(`
`),s("span",{class:"line"})])]),s("pre",{class:"shiki shiki-light",style:{"background-color":"#ffffff"}},[s("code",{"v-pre":""},[s("span",{class:"line"},[s("span",{style:{color:"#1E754F"}},"import"),s("span",{style:{color:"#393A34"}}," "),s("span",{style:{color:"#999999"}},"{"),s("span",{style:{color:"#393A34"}}," "),s("span",{style:{color:"#B07D48"}},"effectScope"),s("span",{style:{color:"#393A34"}}," "),s("span",{style:{color:"#999999"}},"}"),s("span",{style:{color:"#393A34"}}," "),s("span",{style:{color:"#1E754F"}},"from"),s("span",{style:{color:"#393A34"}}," "),s("span",{style:{color:"#B56959AA"}},"'"),s("span",{style:{color:"#B56959"}},"vue"),s("span",{style:{color:"#B56959AA"}},"'")]),l(`
`),s("span",{class:"line"}),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#1E754F"}},"export"),s("span",{style:{color:"#393A34"}}," "),s("span",{style:{color:"#1E754F"}},"default"),s("span",{style:{color:"#393A34"}}," "),s("span",{style:{color:"#59873A"}},"defineAsyncComponent"),s("span",{style:{color:"#999999"}},"({")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#393A34"}},"  "),s("span",{style:{color:"#AB5959"}},"async"),s("span",{style:{color:"#393A34"}}," "),s("span",{style:{color:"#59873A"}},"setup"),s("span",{style:{color:"#999999"}},"()"),s("span",{style:{color:"#393A34"}}," "),s("span",{style:{color:"#999999"}},"{")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#999999"}},"    "),s("span",{style:{color:"#A0ADA0"}},"// create the scope before `await`, so it will be bond to the instance")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#393A34"}},"    "),s("span",{style:{color:"#AB5959"}},"const "),s("span",{style:{color:"#B07D48"}},"scope"),s("span",{style:{color:"#AB5959"}}," "),s("span",{style:{color:"#999999"}},"="),s("span",{style:{color:"#AB5959"}}," "),s("span",{style:{color:"#59873A"}},"effectScope"),s("span",{style:{color:"#999999"}},"()")]),l(`
`),s("span",{class:"line"}),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#393A34"}},"    "),s("span",{style:{color:"#AB5959"}},"const "),s("span",{style:{color:"#B07D48"}},"data"),s("span",{style:{color:"#AB5959"}}," "),s("span",{style:{color:"#999999"}},"="),s("span",{style:{color:"#AB5959"}}," "),s("span",{style:{color:"#1E754F"}},"await"),s("span",{style:{color:"#AB5959"}}," "),s("span",{style:{color:"#59873A"}},"someAsyncFunction"),s("span",{style:{color:"#999999"}},"()"),s("span",{style:{color:"#AB5959"}}," "),s("span",{style:{color:"#A0ADA0"}},"// <-----------")]),l(`
`),s("span",{class:"line"}),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#393A34"}},"    "),s("span",{style:{color:"#B07D48"}},"scope"),s("span",{style:{color:"#999999"}},"."),s("span",{style:{color:"#59873A"}},"run"),s("span",{style:{color:"#999999"}},"(()"),s("span",{style:{color:"#393A34"}}," "),s("span",{style:{color:"#999999"}},"=>"),s("span",{style:{color:"#393A34"}}," "),s("span",{style:{color:"#999999"}},"{")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#393A34"}},"      "),s("span",{style:{color:"#A0ADA0"}},"/* Use `computed`, `watch`, etc. ... */")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#393A34"}},"    "),s("span",{style:{color:"#999999"}},"})")]),l(`
`),s("span",{class:"line"}),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#999999"}},"    "),s("span",{style:{color:"#A0ADA0"}},"// the lifecycle hooks will not be available here,")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#999999"}},"    "),s("span",{style:{color:"#A0ADA0"}},"// you will need to combine it with the previous snippet")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#999999"}},"    "),s("span",{style:{color:"#A0ADA0"}},"// to have both lifecycle hooks and effects works.")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#393A34"}},"  "),s("span",{style:{color:"#999999"}},"}")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#999999"}},"})")]),l(`
`),s("span",{class:"line"})])])])])]),s("h3",{id:"compile-time-magic",tabindex:"-1"},[l("Compile-time Magic! "),s("a",{class:"header-anchor",href:"#compile-time-magic","aria-hidden":"true"},"#")]),s("p",null,[l("In the recent "),s("a",{href:"https://github.com/vuejs/rfcs/blob/master/active-rfcs/0040-script-setup.md",target:"_blank",rel:"noopener"},[s("code",null,"<script setup>"),l(" proposal")]),l(" update, a new "),s("a",{href:"https://github.com/vuejs/rfcs/blob/master/active-rfcs/0040-script-setup.md#top-level-await",target:"_blank",rel:"noopener"},"compile-time magic"),l(" is introduced.")]),s("p",null,[l("The way it works is to inject a script after each "),s("code",null,"await"),l(" statement for restoring the current instance state.")]),s("pre",null,[s("code",{class:"language-html"},[s("div",{class:"shiki-container"},[s("pre",{class:"shiki shiki-dark",style:{"background-color":"#121212"}},[s("code",{"v-pre":""},[s("span",{class:"line"},[s("span",{style:{color:"#666666"}},"<"),s("span",{style:{color:"#4D9375"}},"script"),s("span",{style:{color:"#DBD7CAEE"}}," "),s("span",{style:{color:"#BD976A"}},"setup"),s("span",{style:{color:"#666666"}},">")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#CB7676"}},"const"),s("span",{style:{color:"#DBD7CAEE"}}," "),s("span",{style:{color:"#BD976A"}},"post"),s("span",{style:{color:"#DBD7CAEE"}}," "),s("span",{style:{color:"#666666"}},"="),s("span",{style:{color:"#DBD7CAEE"}}," "),s("span",{style:{color:"#4D9375"}},"await"),s("span",{style:{color:"#DBD7CAEE"}}," "),s("span",{style:{color:"#80A665"}},"fetch"),s("span",{style:{color:"#666666"}},"("),s("span",{style:{color:"#C98A7DAA"}},"`"),s("span",{style:{color:"#C98A7D"}},"/api/post/1"),s("span",{style:{color:"#C98A7DAA"}},"`"),s("span",{style:{color:"#666666"}},")."),s("span",{style:{color:"#80A665"}},"then"),s("span",{style:{color:"#666666"}},"(("),s("span",{style:{color:"#BD976A"}},"r"),s("span",{style:{color:"#666666"}},")"),s("span",{style:{color:"#DBD7CAEE"}}," "),s("span",{style:{color:"#666666"}},"=>"),s("span",{style:{color:"#DBD7CAEE"}}," "),s("span",{style:{color:"#BD976A"}},"r"),s("span",{style:{color:"#666666"}},"."),s("span",{style:{color:"#80A665"}},"json"),s("span",{style:{color:"#666666"}},"())")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#666666"}},"</"),s("span",{style:{color:"#4D9375"}},"script"),s("span",{style:{color:"#666666"}},">")]),l(`
`),s("span",{class:"line"})])]),s("pre",{class:"shiki shiki-light",style:{"background-color":"#ffffff"}},[s("code",{"v-pre":""},[s("span",{class:"line"},[s("span",{style:{color:"#999999"}},"<"),s("span",{style:{color:"#1E754F"}},"script"),s("span",{style:{color:"#393A34"}}," "),s("span",{style:{color:"#B07D48"}},"setup"),s("span",{style:{color:"#999999"}},">")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#AB5959"}},"const"),s("span",{style:{color:"#393A34"}}," "),s("span",{style:{color:"#B07D48"}},"post"),s("span",{style:{color:"#393A34"}}," "),s("span",{style:{color:"#999999"}},"="),s("span",{style:{color:"#393A34"}}," "),s("span",{style:{color:"#1E754F"}},"await"),s("span",{style:{color:"#393A34"}}," "),s("span",{style:{color:"#59873A"}},"fetch"),s("span",{style:{color:"#999999"}},"("),s("span",{style:{color:"#B56959AA"}},"`"),s("span",{style:{color:"#B56959"}},"/api/post/1"),s("span",{style:{color:"#B56959AA"}},"`"),s("span",{style:{color:"#999999"}},")."),s("span",{style:{color:"#59873A"}},"then"),s("span",{style:{color:"#999999"}},"(("),s("span",{style:{color:"#B07D48"}},"r"),s("span",{style:{color:"#999999"}},")"),s("span",{style:{color:"#393A34"}}," "),s("span",{style:{color:"#999999"}},"=>"),s("span",{style:{color:"#393A34"}}," "),s("span",{style:{color:"#B07D48"}},"r"),s("span",{style:{color:"#999999"}},"."),s("span",{style:{color:"#59873A"}},"json"),s("span",{style:{color:"#999999"}},"())")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#999999"}},"</"),s("span",{style:{color:"#1E754F"}},"script"),s("span",{style:{color:"#999999"}},">")]),l(`
`),s("span",{class:"line"})])])])])]),s("pre",null,[s("code",{class:"language-js"},[s("div",{class:"shiki-container"},[s("pre",{class:"shiki shiki-dark",style:{"background-color":"#121212"}},[s("code",{"v-pre":""},[s("span",{class:"line"},[s("span",{style:{color:"#4D9375"}},"import"),s("span",{style:{color:"#DBD7CAEE"}}," "),s("span",{style:{color:"#666666"}},"{"),s("span",{style:{color:"#DBD7CAEE"}}," "),s("span",{style:{color:"#BD976A"}},"withAsyncContext"),s("span",{style:{color:"#DBD7CAEE"}}," "),s("span",{style:{color:"#666666"}},"}"),s("span",{style:{color:"#DBD7CAEE"}}," "),s("span",{style:{color:"#4D9375"}},"from"),s("span",{style:{color:"#DBD7CAEE"}}," "),s("span",{style:{color:"#C98A7DAA"}},"'"),s("span",{style:{color:"#C98A7D"}},"vue"),s("span",{style:{color:"#C98A7DAA"}},"'")]),l(`
`),s("span",{class:"line"}),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#4D9375"}},"export"),s("span",{style:{color:"#DBD7CAEE"}}," "),s("span",{style:{color:"#4D9375"}},"default"),s("span",{style:{color:"#DBD7CAEE"}}," "),s("span",{style:{color:"#666666"}},"{")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#DBD7CAEE"}},"  "),s("span",{style:{color:"#CB7676"}},"async"),s("span",{style:{color:"#DBD7CAEE"}}," "),s("span",{style:{color:"#80A665"}},"setup"),s("span",{style:{color:"#666666"}},"()"),s("span",{style:{color:"#DBD7CAEE"}}," "),s("span",{style:{color:"#666666"}},"{")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#DBD7CAEE"}},"    "),s("span",{style:{color:"#CB7676"}},"let"),s("span",{style:{color:"#DBD7CAEE"}}," "),s("span",{style:{color:"#BD976A"}},"__temp"),s("span",{style:{color:"#666666"}},","),s("span",{style:{color:"#DBD7CAEE"}}," "),s("span",{style:{color:"#BD976A"}},"__restore")]),l(`
`),s("span",{class:"line"}),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#DBD7CAEE"}},"    "),s("span",{style:{color:"#CB7676"}},"const"),s("span",{style:{color:"#DBD7CAEE"}}," "),s("span",{style:{color:"#BD976A"}},"post"),s("span",{style:{color:"#DBD7CAEE"}}," "),s("span",{style:{color:"#666666"}},"=")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#DBD7CAEE"}},"      "),s("span",{style:{color:"#666666"}},"((["),s("span",{style:{color:"#BD976A"}},"__temp"),s("span",{style:{color:"#666666"}},","),s("span",{style:{color:"#DBD7CAEE"}}," "),s("span",{style:{color:"#BD976A"}},"__restore"),s("span",{style:{color:"#666666"}},"]"),s("span",{style:{color:"#DBD7CAEE"}}," "),s("span",{style:{color:"#666666"}},"="),s("span",{style:{color:"#DBD7CAEE"}}," "),s("span",{style:{color:"#80A665"}},"withAsyncContext"),s("span",{style:{color:"#666666"}},"(()"),s("span",{style:{color:"#DBD7CAEE"}}," "),s("span",{style:{color:"#666666"}},"=>")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#DBD7CAEE"}},"        "),s("span",{style:{color:"#80A665"}},"fetch"),s("span",{style:{color:"#666666"}},"("),s("span",{style:{color:"#C98A7DAA"}},"`"),s("span",{style:{color:"#C98A7D"}},"/api/post/1"),s("span",{style:{color:"#C98A7DAA"}},"`"),s("span",{style:{color:"#666666"}},")."),s("span",{style:{color:"#80A665"}},"then"),s("span",{style:{color:"#666666"}},"(("),s("span",{style:{color:"#BD976A"}},"r"),s("span",{style:{color:"#666666"}},")"),s("span",{style:{color:"#DBD7CAEE"}}," "),s("span",{style:{color:"#666666"}},"=>"),s("span",{style:{color:"#DBD7CAEE"}}," "),s("span",{style:{color:"#BD976A"}},"r"),s("span",{style:{color:"#666666"}},"."),s("span",{style:{color:"#80A665"}},"json"),s("span",{style:{color:"#666666"}},"())")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#DBD7CAEE"}},"      "),s("span",{style:{color:"#666666"}},")),")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#DBD7CAEE"}},"      "),s("span",{style:{color:"#666666"}},"("),s("span",{style:{color:"#BD976A"}},"__temp"),s("span",{style:{color:"#DBD7CAEE"}}," "),s("span",{style:{color:"#666666"}},"="),s("span",{style:{color:"#DBD7CAEE"}}," "),s("span",{style:{color:"#4D9375"}},"await"),s("span",{style:{color:"#DBD7CAEE"}}," "),s("span",{style:{color:"#BD976A"}},"__temp"),s("span",{style:{color:"#666666"}},"),")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#DBD7CAEE"}},"      "),s("span",{style:{color:"#80A665"}},"__restore"),s("span",{style:{color:"#666666"}},"(),")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#DBD7CAEE"}},"      "),s("span",{style:{color:"#BD976A"}},"__temp"),s("span",{style:{color:"#666666"}},")")]),l(`
`),s("span",{class:"line"}),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#666666"}},"    "),s("span",{style:{color:"#758575DD"}},"// current instance context preserved")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#666666"}},"    "),s("span",{style:{color:"#758575DD"}},"// e.g. onMounted() will still work.")]),l(`
`),s("span",{class:"line"}),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#DBD7CAEE"}},"    "),s("span",{style:{color:"#4D9375"}},"return"),s("span",{style:{color:"#DBD7CAEE"}}," "),s("span",{style:{color:"#666666"}},"{"),s("span",{style:{color:"#DBD7CAEE"}}," "),s("span",{style:{color:"#BD976A"}},"post"),s("span",{style:{color:"#DBD7CAEE"}}," "),s("span",{style:{color:"#666666"}},"}")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#DBD7CAEE"}},"  "),s("span",{style:{color:"#666666"}},"}")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#666666"}},"}")]),l(`
`),s("span",{class:"line"})])]),s("pre",{class:"shiki shiki-light",style:{"background-color":"#ffffff"}},[s("code",{"v-pre":""},[s("span",{class:"line"},[s("span",{style:{color:"#1E754F"}},"import"),s("span",{style:{color:"#393A34"}}," "),s("span",{style:{color:"#999999"}},"{"),s("span",{style:{color:"#393A34"}}," "),s("span",{style:{color:"#B07D48"}},"withAsyncContext"),s("span",{style:{color:"#393A34"}}," "),s("span",{style:{color:"#999999"}},"}"),s("span",{style:{color:"#393A34"}}," "),s("span",{style:{color:"#1E754F"}},"from"),s("span",{style:{color:"#393A34"}}," "),s("span",{style:{color:"#B56959AA"}},"'"),s("span",{style:{color:"#B56959"}},"vue"),s("span",{style:{color:"#B56959AA"}},"'")]),l(`
`),s("span",{class:"line"}),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#1E754F"}},"export"),s("span",{style:{color:"#393A34"}}," "),s("span",{style:{color:"#1E754F"}},"default"),s("span",{style:{color:"#393A34"}}," "),s("span",{style:{color:"#999999"}},"{")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#393A34"}},"  "),s("span",{style:{color:"#AB5959"}},"async"),s("span",{style:{color:"#393A34"}}," "),s("span",{style:{color:"#59873A"}},"setup"),s("span",{style:{color:"#999999"}},"()"),s("span",{style:{color:"#393A34"}}," "),s("span",{style:{color:"#999999"}},"{")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#393A34"}},"    "),s("span",{style:{color:"#AB5959"}},"let"),s("span",{style:{color:"#393A34"}}," "),s("span",{style:{color:"#B07D48"}},"__temp"),s("span",{style:{color:"#999999"}},","),s("span",{style:{color:"#393A34"}}," "),s("span",{style:{color:"#B07D48"}},"__restore")]),l(`
`),s("span",{class:"line"}),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#393A34"}},"    "),s("span",{style:{color:"#AB5959"}},"const"),s("span",{style:{color:"#393A34"}}," "),s("span",{style:{color:"#B07D48"}},"post"),s("span",{style:{color:"#393A34"}}," "),s("span",{style:{color:"#999999"}},"=")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#393A34"}},"      "),s("span",{style:{color:"#999999"}},"((["),s("span",{style:{color:"#B07D48"}},"__temp"),s("span",{style:{color:"#999999"}},","),s("span",{style:{color:"#393A34"}}," "),s("span",{style:{color:"#B07D48"}},"__restore"),s("span",{style:{color:"#999999"}},"]"),s("span",{style:{color:"#393A34"}}," "),s("span",{style:{color:"#999999"}},"="),s("span",{style:{color:"#393A34"}}," "),s("span",{style:{color:"#59873A"}},"withAsyncContext"),s("span",{style:{color:"#999999"}},"(()"),s("span",{style:{color:"#393A34"}}," "),s("span",{style:{color:"#999999"}},"=>")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#393A34"}},"        "),s("span",{style:{color:"#59873A"}},"fetch"),s("span",{style:{color:"#999999"}},"("),s("span",{style:{color:"#B56959AA"}},"`"),s("span",{style:{color:"#B56959"}},"/api/post/1"),s("span",{style:{color:"#B56959AA"}},"`"),s("span",{style:{color:"#999999"}},")."),s("span",{style:{color:"#59873A"}},"then"),s("span",{style:{color:"#999999"}},"(("),s("span",{style:{color:"#B07D48"}},"r"),s("span",{style:{color:"#999999"}},")"),s("span",{style:{color:"#393A34"}}," "),s("span",{style:{color:"#999999"}},"=>"),s("span",{style:{color:"#393A34"}}," "),s("span",{style:{color:"#B07D48"}},"r"),s("span",{style:{color:"#999999"}},"."),s("span",{style:{color:"#59873A"}},"json"),s("span",{style:{color:"#999999"}},"())")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#393A34"}},"      "),s("span",{style:{color:"#999999"}},")),")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#393A34"}},"      "),s("span",{style:{color:"#999999"}},"("),s("span",{style:{color:"#B07D48"}},"__temp"),s("span",{style:{color:"#393A34"}}," "),s("span",{style:{color:"#999999"}},"="),s("span",{style:{color:"#393A34"}}," "),s("span",{style:{color:"#1E754F"}},"await"),s("span",{style:{color:"#393A34"}}," "),s("span",{style:{color:"#B07D48"}},"__temp"),s("span",{style:{color:"#999999"}},"),")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#393A34"}},"      "),s("span",{style:{color:"#59873A"}},"__restore"),s("span",{style:{color:"#999999"}},"(),")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#393A34"}},"      "),s("span",{style:{color:"#B07D48"}},"__temp"),s("span",{style:{color:"#999999"}},")")]),l(`
`),s("span",{class:"line"}),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#999999"}},"    "),s("span",{style:{color:"#A0ADA0"}},"// current instance context preserved")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#999999"}},"    "),s("span",{style:{color:"#A0ADA0"}},"// e.g. onMounted() will still work.")]),l(`
`),s("span",{class:"line"}),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#393A34"}},"    "),s("span",{style:{color:"#1E754F"}},"return"),s("span",{style:{color:"#393A34"}}," "),s("span",{style:{color:"#999999"}},"{"),s("span",{style:{color:"#393A34"}}," "),s("span",{style:{color:"#B07D48"}},"post"),s("span",{style:{color:"#393A34"}}," "),s("span",{style:{color:"#999999"}},"}")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#393A34"}},"  "),s("span",{style:{color:"#999999"}},"}")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#999999"}},"}")]),l(`
`),s("span",{class:"line"})])])])])]),s("p",null,[l("With it, the async functions will "),s("strong",null,"just work"),l(" when using with "),s("code",null,"<script setup>"),l(". The only shame is it does not work outside of "),s("code",null,"<script setup>"),l(".")])],-1),h="Async with Composition API",d="Notes about the caveat when using async functions in Vue Composition API.",E="2021-07-16T08:00:00.000Z",C="en",f="17min",m="https://antfu.me/og/async-with-composition-api.png",g=[{property:"og:title",content:"Async with Composition API"},{property:"og:description",content:"Notes about the caveat when using async functions in Vue Composition API."},{name:"description",content:"Notes about the caveat when using async functions in Vue Composition API."},{property:"og:image",content:"https://antfu.me/og/async-with-composition-api.png"},{name:"twitter:card",content:"summary_large_image"}],k={__name:"async-with-composition-api",setup(i,{expose:n}){const o={title:"Async with Composition API",description:"Notes about the caveat when using async functions in Vue Composition API.",date:"2021-07-16T08:00:00.000Z",lang:"en",duration:"17min",image:"https://antfu.me/og/async-with-composition-api.png",meta:[{property:"og:title",content:"Async with Composition API"},{property:"og:description",content:"Notes about the caveat when using async functions in Vue Composition API."},{name:"description",content:"Notes about the caveat when using async functions in Vue Composition API."},{property:"og:image",content:"https://antfu.me/og/async-with-composition-api.png"},{name:"twitter:card",content:"summary_large_image"}]};return n({frontmatter:o}),a({title:"Async with Composition API",meta:[{property:"og:title",content:"Async with Composition API"},{property:"og:description",content:"Notes about the caveat when using async functions in Vue Composition API."},{name:"description",content:"Notes about the caveat when using async functions in Vue Composition API."},{property:"og:image",content:"https://antfu.me/og/async-with-composition-api.png"},{name:"twitter:card",content:"summary_large_image"}]}),(D,u)=>{const e=p;return r(),t(e,{frontmatter:o},{default:c(()=>[y]),_:1})}}};export{E as date,k as default,d as description,f as duration,m as image,C as lang,g as meta,h as title};
