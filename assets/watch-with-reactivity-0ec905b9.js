import{u as a,c as t,w as c,_ as r,o as p,a as s,d as l}from"./app-5cf5a87e.js";const y=s("div",{class:"prose m-auto"},[s("p",null,[s("div",{class:"table-of-contents"},[s("ul",null,[s("li",null,[s("a",{href:"#understanding-vue-reactivity"},"Understanding @vue/reactivity "),s("ul",null,[s("li",null,[s("a",{href:"#computed"},"Computed ")])])]),s("li",null,[s("a",{href:"#effect"},"Effect ")]),s("li",null,[s("a",{href:"#build-yourself-a-watch"},"Build yourself a watch "),s("ul",null,[s("li",null,[s("a",{href:"#the-basic"},"The Basic ")]),s("li",null,[s("a",{href:"#watch-for-ref"},"Watch for Ref ")]),s("li",null,[s("a",{href:"#watch-deeply"},"Watch Deeply ")])])]),s("li",null,[s("a",{href:"#lifecycles"},"Lifecycles ")]),s("li",null,[s("a",{href:"#take-away"},"Take Away ")])])])]),s("p",null,[s("a",{href:"https://twitter.com/antfu7/status/1298667080804233221",target:"_blank",rel:"noopener"},"As you probably know"),l(", the things I excited most in Vue 3 are the "),s("a",{href:"https://v3.vuejs.org/guide/composition-api-introduction.html",target:"_blank",rel:"noopener"},"Composition API"),l(" and the "),s("a",{href:"https://v3.vuejs.org/guide/reactivity.html",target:"_blank",rel:"noopener"},"reactivity system"),l(". With the Composition API we can reuse logics and states across components or even apps. Whatâ€™s better? The underhood reactivity system is decoupled from Vue, which means you can use it almost everywhere, even without UI.")]),s("p",null,"Here are some proof of concepts for using the reactivity system outside of Vue:"),s("ul",null,[s("li",null,[s("p",null,[s("a",{href:"https://github.com/yyx990803/vue-lit",target:"_blank",rel:"noopener"},[s("code",null,"@vue/lit")]),l(" is a minimal framework wrote by Evan combining "),s("a",{href:"https://github.com/vuejs/core/tree/main/packages/reactivity",target:"_blank",rel:"noopener"},[s("code",null,"@vue/reactivity")]),l(" and "),s("a",{href:"https://lit-html.polymer-project.org/",target:"_blank",rel:"noopener"},[s("code",null,"lit-html")]),l(". It can run directly in browsers, with the almost identical experience as Vue Composition API.")])]),s("li",null,[s("p",null,[s("a",{href:"https://github.com/antfu/reactivue",target:"_blank",rel:"noopener"},[s("code",null,"ReactiVue")]),l(" ports Vue Composition API to React. It also provides Reactâ€™s lifecycles in the Vue style.")])])]),s("p",null,[l("Furthermore, you can even use Vueâ€™s libraries in them. Tested with "),s("a",{href:"https://github.com/antfu/vueuse",target:"_blank",rel:"noopener"},[s("code",null,"VueUse")]),l(" and "),s("a",{href:"https://github.com/posva/pinia",target:"_blank",rel:"noopener"},[s("code",null,"pinia")]),l(" in "),s("a",{href:"https://github.com/antfu/reactivue",target:"_blank",rel:"noopener"},[s("code",null,"ReactiVue")]),l(", and they just work. You can find "),s("a",{href:"https://github.com/antfu/reactivue#using-vues-libraries",target:"_blank",rel:"noopener"},"more details and examples here"),l(".")]),s("p",null,[l("I am also experimenting more possibility of Vue reactivity in other scenarios, for example "),s("a",{href:"https://twitter.com/antfu7/status/1305313110903779330?s=20",target:"_blank",rel:"noopener"},"reactive file system"),l(", in a project called "),s("code",null,"tive"),l(". Itâ€™s currently a WIP private repo, but keep tuned, I get more to come ðŸ˜‰!")]),s("h2",{id:"understanding-vue-reactivity",tabindex:"-1"},[l("Understanding "),s("code",null,"@vue/reactivity"),l(),s("a",{class:"header-anchor",href:"#understanding-vue-reactivity","aria-hidden":"true"},"#")]),s("p",null,[l('"reactive objects" returned by '),s("code",null,"ref()"),l(" or "),s("code",null,"reactive()"),l(" are actually "),s("a",{href:"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Proxy",target:"_blank",rel:"noopener"},"Proxies"),l(". Those proxies will trigger some actions to track the changes on properties accessing or writing.")]),s("p",null,"For a simplified example,"),s("pre",null,[s("code",{class:"language-ts"},[s("div",{class:"shiki-container"},[s("pre",{class:"shiki shiki-dark",style:{"background-color":"#121212"}},[s("code",{"v-pre":""},[s("span",{class:"line"},[s("span",{style:{color:"#CB7676"}},"const "),s("span",{style:{color:"#80A665"}},"reactive"),s("span",{style:{color:"#CB7676"}}," "),s("span",{style:{color:"#666666"}},"="),s("span",{style:{color:"#CB7676"}}," "),s("span",{style:{color:"#666666"}},"("),s("span",{style:{color:"#BD976A"}},"target"),s("span",{style:{color:"#666666"}},")"),s("span",{style:{color:"#CB7676"}}," "),s("span",{style:{color:"#666666"}},"=>"),s("span",{style:{color:"#CB7676"}}," new "),s("span",{style:{color:"#80A665"}},"Proxy"),s("span",{style:{color:"#666666"}},"("),s("span",{style:{color:"#BD976A"}},"target"),s("span",{style:{color:"#666666"}},","),s("span",{style:{color:"#CB7676"}}," "),s("span",{style:{color:"#666666"}},"{")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#CB7676"}},"  "),s("span",{style:{color:"#80A665"}},"get"),s("span",{style:{color:"#666666"}},"("),s("span",{style:{color:"#BD976A"}},"target"),s("span",{style:{color:"#666666"}},","),s("span",{style:{color:"#CB7676"}}," "),s("span",{style:{color:"#BD976A"}},"prop"),s("span",{style:{color:"#666666"}},","),s("span",{style:{color:"#CB7676"}}," "),s("span",{style:{color:"#BD976A"}},"receiver"),s("span",{style:{color:"#666666"}},")"),s("span",{style:{color:"#CB7676"}}," "),s("span",{style:{color:"#666666"}},"{")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#CB7676"}},"    "),s("span",{style:{color:"#80A665"}},"track"),s("span",{style:{color:"#666666"}},"("),s("span",{style:{color:"#BD976A"}},"target"),s("span",{style:{color:"#666666"}},","),s("span",{style:{color:"#CB7676"}}," "),s("span",{style:{color:"#BD976A"}},"prop"),s("span",{style:{color:"#666666"}},")")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#CB7676"}},"    "),s("span",{style:{color:"#4D9375"}},"return"),s("span",{style:{color:"#CB7676"}}," "),s("span",{style:{color:"#BD976A"}},"Reflect"),s("span",{style:{color:"#666666"}},"."),s("span",{style:{color:"#80A665"}},"get"),s("span",{style:{color:"#666666"}},"(..."),s("span",{style:{color:"#C99076"}},"arguments"),s("span",{style:{color:"#666666"}},")"),s("span",{style:{color:"#CB7676"}}," "),s("span",{style:{color:"#758575DD"}},"// get the original data")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#CB7676"}},"  "),s("span",{style:{color:"#666666"}},"},")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#CB7676"}},"  "),s("span",{style:{color:"#80A665"}},"set"),s("span",{style:{color:"#666666"}},"("),s("span",{style:{color:"#BD976A"}},"target"),s("span",{style:{color:"#666666"}},","),s("span",{style:{color:"#CB7676"}}," "),s("span",{style:{color:"#BD976A"}},"key"),s("span",{style:{color:"#666666"}},","),s("span",{style:{color:"#CB7676"}}," "),s("span",{style:{color:"#BD976A"}},"value"),s("span",{style:{color:"#666666"}},","),s("span",{style:{color:"#CB7676"}}," "),s("span",{style:{color:"#BD976A"}},"receiver"),s("span",{style:{color:"#666666"}},")"),s("span",{style:{color:"#CB7676"}}," "),s("span",{style:{color:"#666666"}},"{")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#CB7676"}},"    "),s("span",{style:{color:"#80A665"}},"trigger"),s("span",{style:{color:"#666666"}},"("),s("span",{style:{color:"#BD976A"}},"target"),s("span",{style:{color:"#666666"}},","),s("span",{style:{color:"#CB7676"}}," "),s("span",{style:{color:"#BD976A"}},"key"),s("span",{style:{color:"#666666"}},")")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#CB7676"}},"    "),s("span",{style:{color:"#4D9375"}},"return"),s("span",{style:{color:"#CB7676"}}," "),s("span",{style:{color:"#BD976A"}},"Reflect"),s("span",{style:{color:"#666666"}},"."),s("span",{style:{color:"#80A665"}},"set"),s("span",{style:{color:"#666666"}},"(..."),s("span",{style:{color:"#C99076"}},"arguments"),s("span",{style:{color:"#666666"}},")"),s("span",{style:{color:"#CB7676"}}," "),s("span",{style:{color:"#758575DD"}},"// set the original data")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#CB7676"}},"  "),s("span",{style:{color:"#666666"}},"}")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#666666"}},"})")]),l(`
`),s("span",{class:"line"}),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#CB7676"}},"const "),s("span",{style:{color:"#BD976A"}},"obj"),s("span",{style:{color:"#CB7676"}}," "),s("span",{style:{color:"#666666"}},"="),s("span",{style:{color:"#CB7676"}}," "),s("span",{style:{color:"#80A665"}},"reactive"),s("span",{style:{color:"#666666"}},"({")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#CB7676"}},"  "),s("span",{style:{color:"#B8A965"}},"hello"),s("span",{style:{color:"#666666"}},":"),s("span",{style:{color:"#CB7676"}}," "),s("span",{style:{color:"#C98A7DAA"}},"'"),s("span",{style:{color:"#C98A7D"}},"world"),s("span",{style:{color:"#C98A7DAA"}},"'")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#666666"}},"})")]),l(`
`),s("span",{class:"line"}),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#BD976A"}},"console"),s("span",{style:{color:"#666666"}},"."),s("span",{style:{color:"#80A665"}},"log"),s("span",{style:{color:"#666666"}},"("),s("span",{style:{color:"#BD976A"}},"obj"),s("span",{style:{color:"#666666"}},"."),s("span",{style:{color:"#BD976A"}},"hello"),s("span",{style:{color:"#666666"}},")"),s("span",{style:{color:"#DBD7CAEE"}}," "),s("span",{style:{color:"#758575DD"}},"// `track()` get called")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#BD976A"}},"obj"),s("span",{style:{color:"#666666"}},"."),s("span",{style:{color:"#BD976A"}},"hello"),s("span",{style:{color:"#DBD7CAEE"}}," "),s("span",{style:{color:"#666666"}},"="),s("span",{style:{color:"#DBD7CAEE"}}," "),s("span",{style:{color:"#C98A7DAA"}},"'"),s("span",{style:{color:"#C98A7D"}},"vue"),s("span",{style:{color:"#C98A7DAA"}},"'"),s("span",{style:{color:"#DBD7CAEE"}}," "),s("span",{style:{color:"#758575DD"}},"// `trigger()` get called")]),l(`
`),s("span",{class:"line"})])]),s("pre",{class:"shiki shiki-light",style:{"background-color":"#ffffff"}},[s("code",{"v-pre":""},[s("span",{class:"line"},[s("span",{style:{color:"#AB5959"}},"const "),s("span",{style:{color:"#59873A"}},"reactive"),s("span",{style:{color:"#AB5959"}}," "),s("span",{style:{color:"#999999"}},"="),s("span",{style:{color:"#AB5959"}}," "),s("span",{style:{color:"#999999"}},"("),s("span",{style:{color:"#B07D48"}},"target"),s("span",{style:{color:"#999999"}},")"),s("span",{style:{color:"#AB5959"}}," "),s("span",{style:{color:"#999999"}},"=>"),s("span",{style:{color:"#AB5959"}}," new "),s("span",{style:{color:"#59873A"}},"Proxy"),s("span",{style:{color:"#999999"}},"("),s("span",{style:{color:"#B07D48"}},"target"),s("span",{style:{color:"#999999"}},","),s("span",{style:{color:"#AB5959"}}," "),s("span",{style:{color:"#999999"}},"{")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#AB5959"}},"  "),s("span",{style:{color:"#59873A"}},"get"),s("span",{style:{color:"#999999"}},"("),s("span",{style:{color:"#B07D48"}},"target"),s("span",{style:{color:"#999999"}},","),s("span",{style:{color:"#AB5959"}}," "),s("span",{style:{color:"#B07D48"}},"prop"),s("span",{style:{color:"#999999"}},","),s("span",{style:{color:"#AB5959"}}," "),s("span",{style:{color:"#B07D48"}},"receiver"),s("span",{style:{color:"#999999"}},")"),s("span",{style:{color:"#AB5959"}}," "),s("span",{style:{color:"#999999"}},"{")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#AB5959"}},"    "),s("span",{style:{color:"#59873A"}},"track"),s("span",{style:{color:"#999999"}},"("),s("span",{style:{color:"#B07D48"}},"target"),s("span",{style:{color:"#999999"}},","),s("span",{style:{color:"#AB5959"}}," "),s("span",{style:{color:"#B07D48"}},"prop"),s("span",{style:{color:"#999999"}},")")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#AB5959"}},"    "),s("span",{style:{color:"#1E754F"}},"return"),s("span",{style:{color:"#AB5959"}}," "),s("span",{style:{color:"#B07D48"}},"Reflect"),s("span",{style:{color:"#999999"}},"."),s("span",{style:{color:"#59873A"}},"get"),s("span",{style:{color:"#999999"}},"(..."),s("span",{style:{color:"#A65E2B"}},"arguments"),s("span",{style:{color:"#999999"}},")"),s("span",{style:{color:"#AB5959"}}," "),s("span",{style:{color:"#A0ADA0"}},"// get the original data")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#AB5959"}},"  "),s("span",{style:{color:"#999999"}},"},")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#AB5959"}},"  "),s("span",{style:{color:"#59873A"}},"set"),s("span",{style:{color:"#999999"}},"("),s("span",{style:{color:"#B07D48"}},"target"),s("span",{style:{color:"#999999"}},","),s("span",{style:{color:"#AB5959"}}," "),s("span",{style:{color:"#B07D48"}},"key"),s("span",{style:{color:"#999999"}},","),s("span",{style:{color:"#AB5959"}}," "),s("span",{style:{color:"#B07D48"}},"value"),s("span",{style:{color:"#999999"}},","),s("span",{style:{color:"#AB5959"}}," "),s("span",{style:{color:"#B07D48"}},"receiver"),s("span",{style:{color:"#999999"}},")"),s("span",{style:{color:"#AB5959"}}," "),s("span",{style:{color:"#999999"}},"{")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#AB5959"}},"    "),s("span",{style:{color:"#59873A"}},"trigger"),s("span",{style:{color:"#999999"}},"("),s("span",{style:{color:"#B07D48"}},"target"),s("span",{style:{color:"#999999"}},","),s("span",{style:{color:"#AB5959"}}," "),s("span",{style:{color:"#B07D48"}},"key"),s("span",{style:{color:"#999999"}},")")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#AB5959"}},"    "),s("span",{style:{color:"#1E754F"}},"return"),s("span",{style:{color:"#AB5959"}}," "),s("span",{style:{color:"#B07D48"}},"Reflect"),s("span",{style:{color:"#999999"}},"."),s("span",{style:{color:"#59873A"}},"set"),s("span",{style:{color:"#999999"}},"(..."),s("span",{style:{color:"#A65E2B"}},"arguments"),s("span",{style:{color:"#999999"}},")"),s("span",{style:{color:"#AB5959"}}," "),s("span",{style:{color:"#A0ADA0"}},"// set the original data")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#AB5959"}},"  "),s("span",{style:{color:"#999999"}},"}")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#999999"}},"})")]),l(`
`),s("span",{class:"line"}),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#AB5959"}},"const "),s("span",{style:{color:"#B07D48"}},"obj"),s("span",{style:{color:"#AB5959"}}," "),s("span",{style:{color:"#999999"}},"="),s("span",{style:{color:"#AB5959"}}," "),s("span",{style:{color:"#59873A"}},"reactive"),s("span",{style:{color:"#999999"}},"({")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#AB5959"}},"  "),s("span",{style:{color:"#998418"}},"hello"),s("span",{style:{color:"#999999"}},":"),s("span",{style:{color:"#AB5959"}}," "),s("span",{style:{color:"#B56959AA"}},"'"),s("span",{style:{color:"#B56959"}},"world"),s("span",{style:{color:"#B56959AA"}},"'")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#999999"}},"})")]),l(`
`),s("span",{class:"line"}),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#B07D48"}},"console"),s("span",{style:{color:"#999999"}},"."),s("span",{style:{color:"#59873A"}},"log"),s("span",{style:{color:"#999999"}},"("),s("span",{style:{color:"#B07D48"}},"obj"),s("span",{style:{color:"#999999"}},"."),s("span",{style:{color:"#B07D48"}},"hello"),s("span",{style:{color:"#999999"}},")"),s("span",{style:{color:"#393A34"}}," "),s("span",{style:{color:"#A0ADA0"}},"// `track()` get called")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#B07D48"}},"obj"),s("span",{style:{color:"#999999"}},"."),s("span",{style:{color:"#B07D48"}},"hello"),s("span",{style:{color:"#393A34"}}," "),s("span",{style:{color:"#999999"}},"="),s("span",{style:{color:"#393A34"}}," "),s("span",{style:{color:"#B56959AA"}},"'"),s("span",{style:{color:"#B56959"}},"vue"),s("span",{style:{color:"#B56959AA"}},"'"),s("span",{style:{color:"#393A34"}}," "),s("span",{style:{color:"#A0ADA0"}},"// `trigger()` get called")]),l(`
`),s("span",{class:"line"})])])])])]),s("p",null,"So in this way, vue can be notified when those properties get accessed or when they be modified."),s("blockquote",null,[s("p",null,[l("For more detailed explanations, check out the "),s("a",{href:"https://v3.vuejs.org/guide/reactivity.html#what-is-reactivity",target:"_blank",rel:"noopener"},"official docs")])]),s("h3",{id:"computed",tabindex:"-1"},[l("Computed "),s("a",{class:"header-anchor",href:"#computed","aria-hidden":"true"},"#")]),s("p",null,[l("Since we are able to know those events, we can start diving into the "),s("code",null,"computed"),l(' which is where the "reactive" magic start shining.')]),s("p",null,[s("code",null,"computed"),l(" is like a getter that auto collects the reactive dependencies source and auto re-evaluate when they get changed.")]),s("p",null,"For example,"),s("pre",null,[s("code",{class:"language-ts"},[s("div",{class:"shiki-container"},[s("pre",{class:"shiki shiki-dark",style:{"background-color":"#121212"}},[s("code",{"v-pre":""},[s("span",{class:"line"},[s("span",{style:{color:"#CB7676"}},"const "),s("span",{style:{color:"#BD976A"}},"counter"),s("span",{style:{color:"#CB7676"}}," "),s("span",{style:{color:"#666666"}},"="),s("span",{style:{color:"#CB7676"}}," "),s("span",{style:{color:"#80A665"}},"ref"),s("span",{style:{color:"#666666"}},"("),s("span",{style:{color:"#4C9A91"}},"1"),s("span",{style:{color:"#666666"}},")")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#CB7676"}},"const "),s("span",{style:{color:"#BD976A"}},"multiplier"),s("span",{style:{color:"#CB7676"}}," "),s("span",{style:{color:"#666666"}},"="),s("span",{style:{color:"#CB7676"}}," "),s("span",{style:{color:"#80A665"}},"ref"),s("span",{style:{color:"#666666"}},"("),s("span",{style:{color:"#4C9A91"}},"2"),s("span",{style:{color:"#666666"}},")")]),l(`
`),s("span",{class:"line"}),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#CB7676"}},"const "),s("span",{style:{color:"#BD976A"}},"result"),s("span",{style:{color:"#CB7676"}}," "),s("span",{style:{color:"#666666"}},"="),s("span",{style:{color:"#CB7676"}}," "),s("span",{style:{color:"#80A665"}},"computed"),s("span",{style:{color:"#666666"}},"(()"),s("span",{style:{color:"#CB7676"}}," "),s("span",{style:{color:"#666666"}},"=>"),s("span",{style:{color:"#CB7676"}}," "),s("span",{style:{color:"#BD976A"}},"counter"),s("span",{style:{color:"#666666"}},"."),s("span",{style:{color:"#BD976A"}},"value"),s("span",{style:{color:"#CB7676"}}," * "),s("span",{style:{color:"#BD976A"}},"multiplier"),s("span",{style:{color:"#666666"}},"."),s("span",{style:{color:"#BD976A"}},"value"),s("span",{style:{color:"#666666"}},")")]),l(`
`),s("span",{class:"line"}),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#BD976A"}},"console"),s("span",{style:{color:"#666666"}},"."),s("span",{style:{color:"#80A665"}},"log"),s("span",{style:{color:"#666666"}},"("),s("span",{style:{color:"#BD976A"}},"result"),s("span",{style:{color:"#666666"}},"."),s("span",{style:{color:"#BD976A"}},"value"),s("span",{style:{color:"#666666"}},")"),s("span",{style:{color:"#DBD7CAEE"}}," "),s("span",{style:{color:"#758575DD"}},"// 2")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#BD976A"}},"counter"),s("span",{style:{color:"#666666"}},"."),s("span",{style:{color:"#BD976A"}},"value"),s("span",{style:{color:"#DBD7CAEE"}}," "),s("span",{style:{color:"#666666"}},"+="),s("span",{style:{color:"#DBD7CAEE"}}," "),s("span",{style:{color:"#4C9A91"}},"1")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#BD976A"}},"console"),s("span",{style:{color:"#666666"}},"."),s("span",{style:{color:"#80A665"}},"log"),s("span",{style:{color:"#666666"}},"("),s("span",{style:{color:"#BD976A"}},"result"),s("span",{style:{color:"#666666"}},"."),s("span",{style:{color:"#BD976A"}},"value"),s("span",{style:{color:"#666666"}},")"),s("span",{style:{color:"#DBD7CAEE"}}," "),s("span",{style:{color:"#758575DD"}},"// 4")]),l(`
`),s("span",{class:"line"})])]),s("pre",{class:"shiki shiki-light",style:{"background-color":"#ffffff"}},[s("code",{"v-pre":""},[s("span",{class:"line"},[s("span",{style:{color:"#AB5959"}},"const "),s("span",{style:{color:"#B07D48"}},"counter"),s("span",{style:{color:"#AB5959"}}," "),s("span",{style:{color:"#999999"}},"="),s("span",{style:{color:"#AB5959"}}," "),s("span",{style:{color:"#59873A"}},"ref"),s("span",{style:{color:"#999999"}},"("),s("span",{style:{color:"#2F798A"}},"1"),s("span",{style:{color:"#999999"}},")")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#AB5959"}},"const "),s("span",{style:{color:"#B07D48"}},"multiplier"),s("span",{style:{color:"#AB5959"}}," "),s("span",{style:{color:"#999999"}},"="),s("span",{style:{color:"#AB5959"}}," "),s("span",{style:{color:"#59873A"}},"ref"),s("span",{style:{color:"#999999"}},"("),s("span",{style:{color:"#2F798A"}},"2"),s("span",{style:{color:"#999999"}},")")]),l(`
`),s("span",{class:"line"}),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#AB5959"}},"const "),s("span",{style:{color:"#B07D48"}},"result"),s("span",{style:{color:"#AB5959"}}," "),s("span",{style:{color:"#999999"}},"="),s("span",{style:{color:"#AB5959"}}," "),s("span",{style:{color:"#59873A"}},"computed"),s("span",{style:{color:"#999999"}},"(()"),s("span",{style:{color:"#AB5959"}}," "),s("span",{style:{color:"#999999"}},"=>"),s("span",{style:{color:"#AB5959"}}," "),s("span",{style:{color:"#B07D48"}},"counter"),s("span",{style:{color:"#999999"}},"."),s("span",{style:{color:"#B07D48"}},"value"),s("span",{style:{color:"#AB5959"}}," * "),s("span",{style:{color:"#B07D48"}},"multiplier"),s("span",{style:{color:"#999999"}},"."),s("span",{style:{color:"#B07D48"}},"value"),s("span",{style:{color:"#999999"}},")")]),l(`
`),s("span",{class:"line"}),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#B07D48"}},"console"),s("span",{style:{color:"#999999"}},"."),s("span",{style:{color:"#59873A"}},"log"),s("span",{style:{color:"#999999"}},"("),s("span",{style:{color:"#B07D48"}},"result"),s("span",{style:{color:"#999999"}},"."),s("span",{style:{color:"#B07D48"}},"value"),s("span",{style:{color:"#999999"}},")"),s("span",{style:{color:"#393A34"}}," "),s("span",{style:{color:"#A0ADA0"}},"// 2")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#B07D48"}},"counter"),s("span",{style:{color:"#999999"}},"."),s("span",{style:{color:"#B07D48"}},"value"),s("span",{style:{color:"#393A34"}}," "),s("span",{style:{color:"#999999"}},"+="),s("span",{style:{color:"#393A34"}}," "),s("span",{style:{color:"#2F798A"}},"1")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#B07D48"}},"console"),s("span",{style:{color:"#999999"}},"."),s("span",{style:{color:"#59873A"}},"log"),s("span",{style:{color:"#999999"}},"("),s("span",{style:{color:"#B07D48"}},"result"),s("span",{style:{color:"#999999"}},"."),s("span",{style:{color:"#B07D48"}},"value"),s("span",{style:{color:"#999999"}},")"),s("span",{style:{color:"#393A34"}}," "),s("span",{style:{color:"#A0ADA0"}},"// 4")]),l(`
`),s("span",{class:"line"})])])])])]),s("p",null,[l("To know how the "),s("code",null,"computed"),l(" work, we need to dig into the lower level API "),s("code",null,"effect"),l(" first.")]),s("h2",{id:"effect",tabindex:"-1"},[l("Effect "),s("a",{class:"header-anchor",href:"#effect","aria-hidden":"true"},"#")]),s("p",null,[s("code",null,"effect"),l(' is a new API introduced in Vue 3. Underneath, itâ€™s the engine powers the "reactivity" in '),s("code",null,"computed"),l(" and "),s("code",null,"watch"),l(". For the most of the time, you donâ€™t need to directly use it. But knowing it well helps you understand the reactivity system much easier.")]),s("p",null,[s("code",null,"effect"),l(" takes the first argument as the "),s("code",null,"getter"),l(" and a second argument for the options. The "),s("code",null,"getter"),l(" is the function that collect its deps on each run via their "),s("code",null,"track()"),l(" hooks. The field "),s("code",null,"scheduler"),l(" in options provides a way to invoke a custom function when the deps change.")]),s("p",null,[l("So basically, you can write a simple "),s("code",null,"computed"),l(" on your own like:")]),s("pre",null,[s("code",{class:"language-ts"},[s("div",{class:"shiki-container"},[s("pre",{class:"shiki shiki-dark",style:{"background-color":"#121212"}},[s("code",{"v-pre":""},[s("span",{class:"line"},[s("span",{style:{color:"#CB7676"}},"const "),s("span",{style:{color:"#80A665"}},"computed"),s("span",{style:{color:"#CB7676"}}," "),s("span",{style:{color:"#666666"}},"="),s("span",{style:{color:"#CB7676"}}," "),s("span",{style:{color:"#666666"}},"("),s("span",{style:{color:"#BD976A"}},"getter"),s("span",{style:{color:"#666666"}},")"),s("span",{style:{color:"#CB7676"}}," "),s("span",{style:{color:"#666666"}},"=>"),s("span",{style:{color:"#CB7676"}}," "),s("span",{style:{color:"#666666"}},"{")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#CB7676"}},"  let "),s("span",{style:{color:"#BD976A"}},"value")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#CB7676"}},"  let "),s("span",{style:{color:"#BD976A"}},"dirty"),s("span",{style:{color:"#CB7676"}}," "),s("span",{style:{color:"#666666"}},"="),s("span",{style:{color:"#CB7676"}}," "),s("span",{style:{color:"#4D9375"}},"true")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#CB7676"}},"  ")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#CB7676"}},"  const "),s("span",{style:{color:"#BD976A"}},"runner"),s("span",{style:{color:"#CB7676"}}," "),s("span",{style:{color:"#666666"}},"="),s("span",{style:{color:"#CB7676"}}," "),s("span",{style:{color:"#80A665"}},"effect"),s("span",{style:{color:"#666666"}},"("),s("span",{style:{color:"#BD976A"}},"getter"),s("span",{style:{color:"#666666"}},","),s("span",{style:{color:"#CB7676"}}," "),s("span",{style:{color:"#666666"}},"{")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#CB7676"}},"    "),s("span",{style:{color:"#B8A965"}},"lazy"),s("span",{style:{color:"#666666"}},":"),s("span",{style:{color:"#CB7676"}}," "),s("span",{style:{color:"#4D9375"}},"true"),s("span",{style:{color:"#666666"}},",")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#CB7676"}},"    "),s("span",{style:{color:"#80A665"}},"scheduler"),s("span",{style:{color:"#666666"}},"()"),s("span",{style:{color:"#CB7676"}}," "),s("span",{style:{color:"#666666"}},"{")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#CB7676"}},"      "),s("span",{style:{color:"#BD976A"}},"dirty"),s("span",{style:{color:"#CB7676"}}," "),s("span",{style:{color:"#666666"}},"="),s("span",{style:{color:"#CB7676"}}," "),s("span",{style:{color:"#4D9375"}},"true"),s("span",{style:{color:"#CB7676"}}," "),s("span",{style:{color:"#758575DD"}},"// deps changed")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#CB7676"}},"    "),s("span",{style:{color:"#666666"}},"}")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#CB7676"}},"  "),s("span",{style:{color:"#666666"}},"})")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#CB7676"}},"  ")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#666666"}},"  "),s("span",{style:{color:"#758575DD"}},"// return should be a `Ref` in real world, simplified here")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#CB7676"}},"  "),s("span",{style:{color:"#4D9375"}},"return"),s("span",{style:{color:"#CB7676"}}," "),s("span",{style:{color:"#666666"}},"{")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#CB7676"}},"    get "),s("span",{style:{color:"#80A665"}},"value"),s("span",{style:{color:"#666666"}},"()"),s("span",{style:{color:"#CB7676"}}," "),s("span",{style:{color:"#666666"}},"{")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#CB7676"}},"      "),s("span",{style:{color:"#4D9375"}},"if"),s("span",{style:{color:"#CB7676"}}," "),s("span",{style:{color:"#666666"}},"("),s("span",{style:{color:"#BD976A"}},"dirty"),s("span",{style:{color:"#666666"}},")"),s("span",{style:{color:"#CB7676"}}," "),s("span",{style:{color:"#666666"}},"{")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#CB7676"}},"        "),s("span",{style:{color:"#BD976A"}},"value"),s("span",{style:{color:"#CB7676"}}," "),s("span",{style:{color:"#666666"}},"="),s("span",{style:{color:"#CB7676"}}," "),s("span",{style:{color:"#80A665"}},"runner"),s("span",{style:{color:"#666666"}},"()"),s("span",{style:{color:"#CB7676"}}," "),s("span",{style:{color:"#758575DD"}},"// re-evaluate")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#CB7676"}},"        "),s("span",{style:{color:"#BD976A"}},"dirty"),s("span",{style:{color:"#CB7676"}}," "),s("span",{style:{color:"#666666"}},"="),s("span",{style:{color:"#CB7676"}}," "),s("span",{style:{color:"#4D9375"}},"false")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#CB7676"}},"      "),s("span",{style:{color:"#666666"}},"}")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#CB7676"}},"      "),s("span",{style:{color:"#4D9375"}},"return"),s("span",{style:{color:"#CB7676"}}," "),s("span",{style:{color:"#BD976A"}},"value")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#CB7676"}},"    "),s("span",{style:{color:"#666666"}},"}")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#CB7676"}},"  "),s("span",{style:{color:"#666666"}},"}")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#666666"}},"}")]),l(`
`),s("span",{class:"line"})])]),s("pre",{class:"shiki shiki-light",style:{"background-color":"#ffffff"}},[s("code",{"v-pre":""},[s("span",{class:"line"},[s("span",{style:{color:"#AB5959"}},"const "),s("span",{style:{color:"#59873A"}},"computed"),s("span",{style:{color:"#AB5959"}}," "),s("span",{style:{color:"#999999"}},"="),s("span",{style:{color:"#AB5959"}}," "),s("span",{style:{color:"#999999"}},"("),s("span",{style:{color:"#B07D48"}},"getter"),s("span",{style:{color:"#999999"}},")"),s("span",{style:{color:"#AB5959"}}," "),s("span",{style:{color:"#999999"}},"=>"),s("span",{style:{color:"#AB5959"}}," "),s("span",{style:{color:"#999999"}},"{")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#AB5959"}},"  let "),s("span",{style:{color:"#B07D48"}},"value")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#AB5959"}},"  let "),s("span",{style:{color:"#B07D48"}},"dirty"),s("span",{style:{color:"#AB5959"}}," "),s("span",{style:{color:"#999999"}},"="),s("span",{style:{color:"#AB5959"}}," "),s("span",{style:{color:"#1E754F"}},"true")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#AB5959"}},"  ")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#AB5959"}},"  const "),s("span",{style:{color:"#B07D48"}},"runner"),s("span",{style:{color:"#AB5959"}}," "),s("span",{style:{color:"#999999"}},"="),s("span",{style:{color:"#AB5959"}}," "),s("span",{style:{color:"#59873A"}},"effect"),s("span",{style:{color:"#999999"}},"("),s("span",{style:{color:"#B07D48"}},"getter"),s("span",{style:{color:"#999999"}},","),s("span",{style:{color:"#AB5959"}}," "),s("span",{style:{color:"#999999"}},"{")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#AB5959"}},"    "),s("span",{style:{color:"#998418"}},"lazy"),s("span",{style:{color:"#999999"}},":"),s("span",{style:{color:"#AB5959"}}," "),s("span",{style:{color:"#1E754F"}},"true"),s("span",{style:{color:"#999999"}},",")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#AB5959"}},"    "),s("span",{style:{color:"#59873A"}},"scheduler"),s("span",{style:{color:"#999999"}},"()"),s("span",{style:{color:"#AB5959"}}," "),s("span",{style:{color:"#999999"}},"{")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#AB5959"}},"      "),s("span",{style:{color:"#B07D48"}},"dirty"),s("span",{style:{color:"#AB5959"}}," "),s("span",{style:{color:"#999999"}},"="),s("span",{style:{color:"#AB5959"}}," "),s("span",{style:{color:"#1E754F"}},"true"),s("span",{style:{color:"#AB5959"}}," "),s("span",{style:{color:"#A0ADA0"}},"// deps changed")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#AB5959"}},"    "),s("span",{style:{color:"#999999"}},"}")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#AB5959"}},"  "),s("span",{style:{color:"#999999"}},"})")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#AB5959"}},"  ")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#999999"}},"  "),s("span",{style:{color:"#A0ADA0"}},"// return should be a `Ref` in real world, simplified here")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#AB5959"}},"  "),s("span",{style:{color:"#1E754F"}},"return"),s("span",{style:{color:"#AB5959"}}," "),s("span",{style:{color:"#999999"}},"{")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#AB5959"}},"    get "),s("span",{style:{color:"#59873A"}},"value"),s("span",{style:{color:"#999999"}},"()"),s("span",{style:{color:"#AB5959"}}," "),s("span",{style:{color:"#999999"}},"{")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#AB5959"}},"      "),s("span",{style:{color:"#1E754F"}},"if"),s("span",{style:{color:"#AB5959"}}," "),s("span",{style:{color:"#999999"}},"("),s("span",{style:{color:"#B07D48"}},"dirty"),s("span",{style:{color:"#999999"}},")"),s("span",{style:{color:"#AB5959"}}," "),s("span",{style:{color:"#999999"}},"{")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#AB5959"}},"        "),s("span",{style:{color:"#B07D48"}},"value"),s("span",{style:{color:"#AB5959"}}," "),s("span",{style:{color:"#999999"}},"="),s("span",{style:{color:"#AB5959"}}," "),s("span",{style:{color:"#59873A"}},"runner"),s("span",{style:{color:"#999999"}},"()"),s("span",{style:{color:"#AB5959"}}," "),s("span",{style:{color:"#A0ADA0"}},"// re-evaluate")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#AB5959"}},"        "),s("span",{style:{color:"#B07D48"}},"dirty"),s("span",{style:{color:"#AB5959"}}," "),s("span",{style:{color:"#999999"}},"="),s("span",{style:{color:"#AB5959"}}," "),s("span",{style:{color:"#1E754F"}},"false")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#AB5959"}},"      "),s("span",{style:{color:"#999999"}},"}")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#AB5959"}},"      "),s("span",{style:{color:"#1E754F"}},"return"),s("span",{style:{color:"#AB5959"}}," "),s("span",{style:{color:"#B07D48"}},"value")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#AB5959"}},"    "),s("span",{style:{color:"#999999"}},"}")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#AB5959"}},"  "),s("span",{style:{color:"#999999"}},"}")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#999999"}},"}")]),l(`
`),s("span",{class:"line"})])])])])]),s("p",null,[l("If you really interested in how it works in Vue, check out "),s("a",{href:"https://github.com/vuejs/core/blob/main/packages/reactivity/src/computed.ts",target:"_blank",rel:"noopener"},"the source code here")]),s("h2",{id:"build-yourself-a-watch",tabindex:"-1"},[l("Build yourself a "),s("code",null,"watch"),l(),s("a",{class:"header-anchor",href:"#build-yourself-a-watch","aria-hidden":"true"},"#")]),s("p",null,[l("We have done the most important APIs in "),s("code",null,"@vue/reactivity"),l(" now, which is "),s("code",null,"ref"),l(),s("code",null,"reactive"),l(),s("code",null,"effect"),l(),s("code",null,"computed"),l(".")]),s("p",null,[l("Oh wait, we are missing the "),s("code",null,"watch"),l(" here!")]),s("pre",null,[s("code",{class:"language-js"},[s("div",{class:"shiki-container"},[s("pre",{class:"shiki shiki-dark",style:{"background-color":"#121212"}},[s("code",{"v-pre":""},[s("span",{class:"line"},[s("span",{style:{color:"#4D9375"}},"import"),s("span",{style:{color:"#DBD7CAEE"}}," "),s("span",{style:{color:"#666666"}},"{"),s("span",{style:{color:"#DBD7CAEE"}}," "),s("span",{style:{color:"#BD976A"}},"watch"),s("span",{style:{color:"#DBD7CAEE"}}," "),s("span",{style:{color:"#666666"}},"}"),s("span",{style:{color:"#DBD7CAEE"}}," "),s("span",{style:{color:"#4D9375"}},"from"),s("span",{style:{color:"#DBD7CAEE"}}," "),s("span",{style:{color:"#C98A7DAA"}},"'"),s("span",{style:{color:"#C98A7D"}},"@vue/reactivity"),s("span",{style:{color:"#C98A7DAA"}},"'"),s("span",{style:{color:"#DBD7CAEE"}}," "),s("span",{style:{color:"#758575DD"}},"// does NOT exist!")]),l(`
`),s("span",{class:"line"})])]),s("pre",{class:"shiki shiki-light",style:{"background-color":"#ffffff"}},[s("code",{"v-pre":""},[s("span",{class:"line"},[s("span",{style:{color:"#1E754F"}},"import"),s("span",{style:{color:"#393A34"}}," "),s("span",{style:{color:"#999999"}},"{"),s("span",{style:{color:"#393A34"}}," "),s("span",{style:{color:"#B07D48"}},"watch"),s("span",{style:{color:"#393A34"}}," "),s("span",{style:{color:"#999999"}},"}"),s("span",{style:{color:"#393A34"}}," "),s("span",{style:{color:"#1E754F"}},"from"),s("span",{style:{color:"#393A34"}}," "),s("span",{style:{color:"#B56959AA"}},"'"),s("span",{style:{color:"#B56959"}},"@vue/reactivity"),s("span",{style:{color:"#B56959AA"}},"'"),s("span",{style:{color:"#393A34"}}," "),s("span",{style:{color:"#A0ADA0"}},"// does NOT exist!")]),l(`
`),s("span",{class:"line"})])])])])]),s("p",null,[l("If you take a look at Vue 3â€™s source code, you will find that "),s("code",null,"watch"),l(" is actually "),s("a",{href:"https://github.com/vuejs/core/blob/main/packages/runtime-core/src/apiWatch.ts",target:"_blank",rel:"noopener"},[l("implemented in "),s("code",null,"@vue/runtime-core")]),l(", along with the Vueâ€™s component model and lifecycles. The main reason for this is that "),s("code",null,"watch"),l(" is deep bound with the componentâ€™s lifecycles (auto dispose, invalidate, etc.). But it shouldnâ€™t be the thing to keep you from using it outside of Vue.")]),s("p",null,[l("Letâ€™s implement the "),s("code",null,"watch"),l(" our own!")]),s("h3",{id:"the-basic",tabindex:"-1"},[l("The Basic "),s("a",{class:"header-anchor",href:"#the-basic","aria-hidden":"true"},"#")]),s("p",null,"Letâ€™s take a look at Vueâ€™s watch interface first"),s("pre",null,[s("code",{class:"language-ts"},[s("div",{class:"shiki-container"},[s("pre",{class:"shiki shiki-dark",style:{"background-color":"#121212"}},[s("code",{"v-pre":""},[s("span",{class:"line"},[s("span",{style:{color:"#CB7676"}},"const "),s("span",{style:{color:"#BD976A"}},"count"),s("span",{style:{color:"#CB7676"}}," "),s("span",{style:{color:"#666666"}},"="),s("span",{style:{color:"#CB7676"}}," "),s("span",{style:{color:"#80A665"}},"ref"),s("span",{style:{color:"#666666"}},"("),s("span",{style:{color:"#4C9A91"}},"0"),s("span",{style:{color:"#666666"}},")")]),l(`
`),s("span",{class:"line"}),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#80A665"}},"watch"),s("span",{style:{color:"#666666"}},"(")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#DBD7CAEE"}},"  "),s("span",{style:{color:"#666666"}},"()"),s("span",{style:{color:"#DBD7CAEE"}}," "),s("span",{style:{color:"#666666"}},"=>"),s("span",{style:{color:"#DBD7CAEE"}}," "),s("span",{style:{color:"#BD976A"}},"count"),s("span",{style:{color:"#666666"}},"."),s("span",{style:{color:"#BD976A"}},"value"),s("span",{style:{color:"#666666"}},",")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#DBD7CAEE"}},"  "),s("span",{style:{color:"#666666"}},"("),s("span",{style:{color:"#BD976A"}},"newValue"),s("span",{style:{color:"#666666"}},")"),s("span",{style:{color:"#DBD7CAEE"}}," "),s("span",{style:{color:"#666666"}},"=>"),s("span",{style:{color:"#DBD7CAEE"}}," "),s("span",{style:{color:"#666666"}},"{")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#DBD7CAEE"}},"    "),s("span",{style:{color:"#BD976A"}},"console"),s("span",{style:{color:"#666666"}},"."),s("span",{style:{color:"#80A665"}},"log"),s("span",{style:{color:"#666666"}},"("),s("span",{style:{color:"#C98A7DAA"}},"`"),s("span",{style:{color:"#C98A7D"}},"count changed to: "),s("span",{style:{color:"#666666"}},"${"),s("span",{style:{color:"#C98A7D"}},"newValue"),s("span",{style:{color:"#666666"}},"}"),s("span",{style:{color:"#C98A7D"}},"!"),s("span",{style:{color:"#C98A7DAA"}},"`"),s("span",{style:{color:"#666666"}},")")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#DBD7CAEE"}},"  "),s("span",{style:{color:"#666666"}},"}")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#666666"}},")")]),l(`
`),s("span",{class:"line"}),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#BD976A"}},"count"),s("span",{style:{color:"#666666"}},"."),s("span",{style:{color:"#BD976A"}},"value"),s("span",{style:{color:"#DBD7CAEE"}}," "),s("span",{style:{color:"#666666"}},"="),s("span",{style:{color:"#DBD7CAEE"}}," "),s("span",{style:{color:"#4C9A91"}},"2")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#758575DD"}},"// count changed to: 2!")]),l(`
`),s("span",{class:"line"})])]),s("pre",{class:"shiki shiki-light",style:{"background-color":"#ffffff"}},[s("code",{"v-pre":""},[s("span",{class:"line"},[s("span",{style:{color:"#AB5959"}},"const "),s("span",{style:{color:"#B07D48"}},"count"),s("span",{style:{color:"#AB5959"}}," "),s("span",{style:{color:"#999999"}},"="),s("span",{style:{color:"#AB5959"}}," "),s("span",{style:{color:"#59873A"}},"ref"),s("span",{style:{color:"#999999"}},"("),s("span",{style:{color:"#2F798A"}},"0"),s("span",{style:{color:"#999999"}},")")]),l(`
`),s("span",{class:"line"}),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#59873A"}},"watch"),s("span",{style:{color:"#999999"}},"(")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#393A34"}},"  "),s("span",{style:{color:"#999999"}},"()"),s("span",{style:{color:"#393A34"}}," "),s("span",{style:{color:"#999999"}},"=>"),s("span",{style:{color:"#393A34"}}," "),s("span",{style:{color:"#B07D48"}},"count"),s("span",{style:{color:"#999999"}},"."),s("span",{style:{color:"#B07D48"}},"value"),s("span",{style:{color:"#999999"}},",")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#393A34"}},"  "),s("span",{style:{color:"#999999"}},"("),s("span",{style:{color:"#B07D48"}},"newValue"),s("span",{style:{color:"#999999"}},")"),s("span",{style:{color:"#393A34"}}," "),s("span",{style:{color:"#999999"}},"=>"),s("span",{style:{color:"#393A34"}}," "),s("span",{style:{color:"#999999"}},"{")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#393A34"}},"    "),s("span",{style:{color:"#B07D48"}},"console"),s("span",{style:{color:"#999999"}},"."),s("span",{style:{color:"#59873A"}},"log"),s("span",{style:{color:"#999999"}},"("),s("span",{style:{color:"#B56959AA"}},"`"),s("span",{style:{color:"#B56959"}},"count changed to: "),s("span",{style:{color:"#999999"}},"${"),s("span",{style:{color:"#B56959"}},"newValue"),s("span",{style:{color:"#999999"}},"}"),s("span",{style:{color:"#B56959"}},"!"),s("span",{style:{color:"#B56959AA"}},"`"),s("span",{style:{color:"#999999"}},")")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#393A34"}},"  "),s("span",{style:{color:"#999999"}},"}")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#999999"}},")")]),l(`
`),s("span",{class:"line"}),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#B07D48"}},"count"),s("span",{style:{color:"#999999"}},"."),s("span",{style:{color:"#B07D48"}},"value"),s("span",{style:{color:"#393A34"}}," "),s("span",{style:{color:"#999999"}},"="),s("span",{style:{color:"#393A34"}}," "),s("span",{style:{color:"#2F798A"}},"2")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A0ADA0"}},"// count changed to: 2!")]),l(`
`),s("span",{class:"line"})])])])])]),s("p",null,[l("With the knowledge of "),s("code",null,"effect"),l(", itâ€™s quite straight forward to implement")]),s("pre",null,[s("code",{class:"language-ts"},[s("div",{class:"shiki-container"},[s("pre",{class:"shiki shiki-dark",style:{"background-color":"#121212"}},[s("code",{"v-pre":""},[s("span",{class:"line"},[s("span",{style:{color:"#CB7676"}},"const "),s("span",{style:{color:"#80A665"}},"watch"),s("span",{style:{color:"#CB7676"}}," "),s("span",{style:{color:"#666666"}},"="),s("span",{style:{color:"#CB7676"}}," "),s("span",{style:{color:"#666666"}},"("),s("span",{style:{color:"#BD976A"}},"getter"),s("span",{style:{color:"#666666"}},","),s("span",{style:{color:"#CB7676"}}," "),s("span",{style:{color:"#BD976A"}},"fn"),s("span",{style:{color:"#666666"}},")"),s("span",{style:{color:"#CB7676"}}," "),s("span",{style:{color:"#666666"}},"=>"),s("span",{style:{color:"#CB7676"}}," "),s("span",{style:{color:"#666666"}},"{")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#CB7676"}},"  const "),s("span",{style:{color:"#BD976A"}},"runner"),s("span",{style:{color:"#CB7676"}}," "),s("span",{style:{color:"#666666"}},"="),s("span",{style:{color:"#CB7676"}}," "),s("span",{style:{color:"#80A665"}},"effect"),s("span",{style:{color:"#666666"}},"("),s("span",{style:{color:"#BD976A"}},"getter"),s("span",{style:{color:"#666666"}},","),s("span",{style:{color:"#CB7676"}}," "),s("span",{style:{color:"#666666"}},"{")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#CB7676"}},"    "),s("span",{style:{color:"#B8A965"}},"lazy"),s("span",{style:{color:"#666666"}},":"),s("span",{style:{color:"#CB7676"}}," "),s("span",{style:{color:"#4D9375"}},"true"),s("span",{style:{color:"#666666"}},",")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#CB7676"}},"    "),s("span",{style:{color:"#B8A965"}},"scheduler"),s("span",{style:{color:"#666666"}},":"),s("span",{style:{color:"#CB7676"}}," "),s("span",{style:{color:"#BD976A"}},"fn")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#CB7676"}},"  "),s("span",{style:{color:"#666666"}},"}")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#CB7676"}},"  ")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#666666"}},"  "),s("span",{style:{color:"#758575DD"}},"// a callback function is returned to stop the effect")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#CB7676"}},"  "),s("span",{style:{color:"#80A665"}},"return"),s("span",{style:{color:"#CB7676"}}," "),s("span",{style:{color:"#666666"}},"()"),s("span",{style:{color:"#CB7676"}}," "),s("span",{style:{color:"#666666"}},"=>"),s("span",{style:{color:"#CB7676"}}," "),s("span",{style:{color:"#80A665"}},"stop"),s("span",{style:{color:"#666666"}},"("),s("span",{style:{color:"#BD976A"}},"runner"),s("span",{style:{color:"#666666"}},")")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#CB7676"}},"}")]),l(`
`),s("span",{class:"line"})])]),s("pre",{class:"shiki shiki-light",style:{"background-color":"#ffffff"}},[s("code",{"v-pre":""},[s("span",{class:"line"},[s("span",{style:{color:"#AB5959"}},"const "),s("span",{style:{color:"#59873A"}},"watch"),s("span",{style:{color:"#AB5959"}}," "),s("span",{style:{color:"#999999"}},"="),s("span",{style:{color:"#AB5959"}}," "),s("span",{style:{color:"#999999"}},"("),s("span",{style:{color:"#B07D48"}},"getter"),s("span",{style:{color:"#999999"}},","),s("span",{style:{color:"#AB5959"}}," "),s("span",{style:{color:"#B07D48"}},"fn"),s("span",{style:{color:"#999999"}},")"),s("span",{style:{color:"#AB5959"}}," "),s("span",{style:{color:"#999999"}},"=>"),s("span",{style:{color:"#AB5959"}}," "),s("span",{style:{color:"#999999"}},"{")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#AB5959"}},"  const "),s("span",{style:{color:"#B07D48"}},"runner"),s("span",{style:{color:"#AB5959"}}," "),s("span",{style:{color:"#999999"}},"="),s("span",{style:{color:"#AB5959"}}," "),s("span",{style:{color:"#59873A"}},"effect"),s("span",{style:{color:"#999999"}},"("),s("span",{style:{color:"#B07D48"}},"getter"),s("span",{style:{color:"#999999"}},","),s("span",{style:{color:"#AB5959"}}," "),s("span",{style:{color:"#999999"}},"{")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#AB5959"}},"    "),s("span",{style:{color:"#998418"}},"lazy"),s("span",{style:{color:"#999999"}},":"),s("span",{style:{color:"#AB5959"}}," "),s("span",{style:{color:"#1E754F"}},"true"),s("span",{style:{color:"#999999"}},",")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#AB5959"}},"    "),s("span",{style:{color:"#998418"}},"scheduler"),s("span",{style:{color:"#999999"}},":"),s("span",{style:{color:"#AB5959"}}," "),s("span",{style:{color:"#B07D48"}},"fn")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#AB5959"}},"  "),s("span",{style:{color:"#999999"}},"}")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#AB5959"}},"  ")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#999999"}},"  "),s("span",{style:{color:"#A0ADA0"}},"// a callback function is returned to stop the effect")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#AB5959"}},"  "),s("span",{style:{color:"#59873A"}},"return"),s("span",{style:{color:"#AB5959"}}," "),s("span",{style:{color:"#999999"}},"()"),s("span",{style:{color:"#AB5959"}}," "),s("span",{style:{color:"#999999"}},"=>"),s("span",{style:{color:"#AB5959"}}," "),s("span",{style:{color:"#59873A"}},"stop"),s("span",{style:{color:"#999999"}},"("),s("span",{style:{color:"#B07D48"}},"runner"),s("span",{style:{color:"#999999"}},")")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#AB5959"}},"}")]),l(`
`),s("span",{class:"line"})])])])])]),s("p",null,"Watch is lazy by default in Vue, you can add the third options to give control to the users."),s("h3",{id:"watch-for-ref",tabindex:"-1"},[l("Watch for Ref "),s("a",{class:"header-anchor",href:"#watch-for-ref","aria-hidden":"true"},"#")]),s("p",null,[l("You may also notice that the Vueâ€™s "),s("code",null,"watch"),l(" also allows passing the ref directly to it.")]),s("pre",null,[s("code",{class:"language-ts"},[s("div",{class:"shiki-container"},[s("pre",{class:"shiki shiki-dark",style:{"background-color":"#121212"}},[s("code",{"v-pre":""},[s("span",{class:"line"},[s("span",{style:{color:"#80A665"}},"watch"),s("span",{style:{color:"#666666"}},"(")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#DBD7CAEE"}},"  "),s("span",{style:{color:"#BD976A"}},"count"),s("span",{style:{color:"#666666"}},",")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#DBD7CAEE"}},"  "),s("span",{style:{color:"#666666"}},"()"),s("span",{style:{color:"#DBD7CAEE"}}," "),s("span",{style:{color:"#666666"}},"=>"),s("span",{style:{color:"#DBD7CAEE"}}," "),s("span",{style:{color:"#666666"}},"{"),s("span",{style:{color:"#DBD7CAEE"}}," "),s("span",{style:{color:"#758575DD"}},"/* onChanged */"),s("span",{style:{color:"#DBD7CAEE"}}," "),s("span",{style:{color:"#666666"}},"}")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#666666"}},")")]),l(`
`),s("span",{class:"line"})])]),s("pre",{class:"shiki shiki-light",style:{"background-color":"#ffffff"}},[s("code",{"v-pre":""},[s("span",{class:"line"},[s("span",{style:{color:"#59873A"}},"watch"),s("span",{style:{color:"#999999"}},"(")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#393A34"}},"  "),s("span",{style:{color:"#B07D48"}},"count"),s("span",{style:{color:"#999999"}},",")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#393A34"}},"  "),s("span",{style:{color:"#999999"}},"()"),s("span",{style:{color:"#393A34"}}," "),s("span",{style:{color:"#999999"}},"=>"),s("span",{style:{color:"#393A34"}}," "),s("span",{style:{color:"#999999"}},"{"),s("span",{style:{color:"#393A34"}}," "),s("span",{style:{color:"#A0ADA0"}},"/* onChanged */"),s("span",{style:{color:"#393A34"}}," "),s("span",{style:{color:"#999999"}},"}")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#999999"}},")")]),l(`
`),s("span",{class:"line"})])])])])]),s("p",null,"For that, just wrap it into a getter will do"),s("pre",null,[s("code",{class:"language-ts"},[s("div",{class:"shiki-container"},[s("pre",{class:"shiki shiki-dark",style:{"background-color":"#121212"}},[s("code",{"v-pre":""},[s("span",{class:"line"},[s("span",{style:{color:"#CB7676"}},"const "),s("span",{style:{color:"#80A665"}},"watch"),s("span",{style:{color:"#CB7676"}}," "),s("span",{style:{color:"#666666"}},"="),s("span",{style:{color:"#CB7676"}}," "),s("span",{style:{color:"#666666"}},"("),s("span",{style:{color:"#BD976A"}},"source"),s("span",{style:{color:"#666666"}},","),s("span",{style:{color:"#CB7676"}}," "),s("span",{style:{color:"#BD976A"}},"fn"),s("span",{style:{color:"#666666"}},")"),s("span",{style:{color:"#CB7676"}}," "),s("span",{style:{color:"#666666"}},"=>"),s("span",{style:{color:"#CB7676"}}," "),s("span",{style:{color:"#666666"}},"{")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#CB7676"}},"  const "),s("span",{style:{color:"#BD976A"}},"getter"),s("span",{style:{color:"#CB7676"}}," "),s("span",{style:{color:"#666666"}},"="),s("span",{style:{color:"#CB7676"}}," "),s("span",{style:{color:"#80A665"}},"isRef"),s("span",{style:{color:"#666666"}},"("),s("span",{style:{color:"#BD976A"}},"source"),s("span",{style:{color:"#666666"}},")")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#CB7676"}},"    ? "),s("span",{style:{color:"#666666"}},"()"),s("span",{style:{color:"#CB7676"}}," "),s("span",{style:{color:"#666666"}},"=>"),s("span",{style:{color:"#CB7676"}}," "),s("span",{style:{color:"#BD976A"}},"source"),s("span",{style:{color:"#666666"}},"."),s("span",{style:{color:"#BD976A"}},"value")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#CB7676"}},"    : "),s("span",{style:{color:"#BD976A"}},"source")]),l(`
`),s("span",{class:"line"}),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#CB7676"}},"  const "),s("span",{style:{color:"#BD976A"}},"runner"),s("span",{style:{color:"#CB7676"}}," "),s("span",{style:{color:"#666666"}},"="),s("span",{style:{color:"#CB7676"}}," "),s("span",{style:{color:"#80A665"}},"effect"),s("span",{style:{color:"#666666"}},"("),s("span",{style:{color:"#BD976A"}},"getter"),s("span",{style:{color:"#666666"}},","),s("span",{style:{color:"#CB7676"}}," "),s("span",{style:{color:"#666666"}},"{")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#CB7676"}},"    "),s("span",{style:{color:"#B8A965"}},"lazy"),s("span",{style:{color:"#666666"}},":"),s("span",{style:{color:"#CB7676"}}," "),s("span",{style:{color:"#4D9375"}},"true"),s("span",{style:{color:"#666666"}},",")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#CB7676"}},"    "),s("span",{style:{color:"#B8A965"}},"scheduler"),s("span",{style:{color:"#666666"}},":"),s("span",{style:{color:"#CB7676"}}," "),s("span",{style:{color:"#BD976A"}},"fn")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#CB7676"}},"  "),s("span",{style:{color:"#666666"}},"}")]),l(`
`),s("span",{class:"line"}),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#CB7676"}},"  "),s("span",{style:{color:"#80A665"}},"return"),s("span",{style:{color:"#CB7676"}}," "),s("span",{style:{color:"#666666"}},"()"),s("span",{style:{color:"#CB7676"}}," "),s("span",{style:{color:"#666666"}},"=>"),s("span",{style:{color:"#CB7676"}}," "),s("span",{style:{color:"#80A665"}},"stop"),s("span",{style:{color:"#666666"}},"("),s("span",{style:{color:"#BD976A"}},"runner"),s("span",{style:{color:"#666666"}},")")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#CB7676"}},"}")]),l(`
`),s("span",{class:"line"})])]),s("pre",{class:"shiki shiki-light",style:{"background-color":"#ffffff"}},[s("code",{"v-pre":""},[s("span",{class:"line"},[s("span",{style:{color:"#AB5959"}},"const "),s("span",{style:{color:"#59873A"}},"watch"),s("span",{style:{color:"#AB5959"}}," "),s("span",{style:{color:"#999999"}},"="),s("span",{style:{color:"#AB5959"}}," "),s("span",{style:{color:"#999999"}},"("),s("span",{style:{color:"#B07D48"}},"source"),s("span",{style:{color:"#999999"}},","),s("span",{style:{color:"#AB5959"}}," "),s("span",{style:{color:"#B07D48"}},"fn"),s("span",{style:{color:"#999999"}},")"),s("span",{style:{color:"#AB5959"}}," "),s("span",{style:{color:"#999999"}},"=>"),s("span",{style:{color:"#AB5959"}}," "),s("span",{style:{color:"#999999"}},"{")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#AB5959"}},"  const "),s("span",{style:{color:"#B07D48"}},"getter"),s("span",{style:{color:"#AB5959"}}," "),s("span",{style:{color:"#999999"}},"="),s("span",{style:{color:"#AB5959"}}," "),s("span",{style:{color:"#59873A"}},"isRef"),s("span",{style:{color:"#999999"}},"("),s("span",{style:{color:"#B07D48"}},"source"),s("span",{style:{color:"#999999"}},")")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#AB5959"}},"    ? "),s("span",{style:{color:"#999999"}},"()"),s("span",{style:{color:"#AB5959"}}," "),s("span",{style:{color:"#999999"}},"=>"),s("span",{style:{color:"#AB5959"}}," "),s("span",{style:{color:"#B07D48"}},"source"),s("span",{style:{color:"#999999"}},"."),s("span",{style:{color:"#B07D48"}},"value")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#AB5959"}},"    : "),s("span",{style:{color:"#B07D48"}},"source")]),l(`
`),s("span",{class:"line"}),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#AB5959"}},"  const "),s("span",{style:{color:"#B07D48"}},"runner"),s("span",{style:{color:"#AB5959"}}," "),s("span",{style:{color:"#999999"}},"="),s("span",{style:{color:"#AB5959"}}," "),s("span",{style:{color:"#59873A"}},"effect"),s("span",{style:{color:"#999999"}},"("),s("span",{style:{color:"#B07D48"}},"getter"),s("span",{style:{color:"#999999"}},","),s("span",{style:{color:"#AB5959"}}," "),s("span",{style:{color:"#999999"}},"{")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#AB5959"}},"    "),s("span",{style:{color:"#998418"}},"lazy"),s("span",{style:{color:"#999999"}},":"),s("span",{style:{color:"#AB5959"}}," "),s("span",{style:{color:"#1E754F"}},"true"),s("span",{style:{color:"#999999"}},",")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#AB5959"}},"    "),s("span",{style:{color:"#998418"}},"scheduler"),s("span",{style:{color:"#999999"}},":"),s("span",{style:{color:"#AB5959"}}," "),s("span",{style:{color:"#B07D48"}},"fn")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#AB5959"}},"  "),s("span",{style:{color:"#999999"}},"}")]),l(`
`),s("span",{class:"line"}),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#AB5959"}},"  "),s("span",{style:{color:"#59873A"}},"return"),s("span",{style:{color:"#AB5959"}}," "),s("span",{style:{color:"#999999"}},"()"),s("span",{style:{color:"#AB5959"}}," "),s("span",{style:{color:"#999999"}},"=>"),s("span",{style:{color:"#AB5959"}}," "),s("span",{style:{color:"#59873A"}},"stop"),s("span",{style:{color:"#999999"}},"("),s("span",{style:{color:"#B07D48"}},"runner"),s("span",{style:{color:"#999999"}},")")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#AB5959"}},"}")]),l(`
`),s("span",{class:"line"})])])])])]),s("h3",{id:"watch-deeply",tabindex:"-1"},[l("Watch Deeply "),s("a",{class:"header-anchor",href:"#watch-deeply","aria-hidden":"true"},"#")]),s("p",null,[l("One other great feature about "),s("code",null,"watch"),l(" is that it allows you to watch on deep changes.")]),s("pre",null,[s("code",{class:"language-ts"},[s("div",{class:"shiki-container"},[s("pre",{class:"shiki shiki-dark",style:{"background-color":"#121212"}},[s("code",{"v-pre":""},[s("span",{class:"line"},[s("span",{style:{color:"#CB7676"}},"const "),s("span",{style:{color:"#BD976A"}},"state"),s("span",{style:{color:"#CB7676"}}," "),s("span",{style:{color:"#666666"}},"="),s("span",{style:{color:"#CB7676"}}," "),s("span",{style:{color:"#80A665"}},"reactive"),s("span",{style:{color:"#666666"}},"({")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#CB7676"}},"  "),s("span",{style:{color:"#B8A965"}},"info"),s("span",{style:{color:"#666666"}},":"),s("span",{style:{color:"#CB7676"}}," "),s("span",{style:{color:"#666666"}},"{")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#CB7676"}},"    "),s("span",{style:{color:"#B8A965"}},"name"),s("span",{style:{color:"#666666"}},":"),s("span",{style:{color:"#CB7676"}}," "),s("span",{style:{color:"#C98A7DAA"}},"'"),s("span",{style:{color:"#C98A7D"}},"Anthony"),s("span",{style:{color:"#C98A7DAA"}},"'"),s("span",{style:{color:"#666666"}},",")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#CB7676"}},"  "),s("span",{style:{color:"#666666"}},"}")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#666666"}},"})")]),l(`
`),s("span",{class:"line"}),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#80A665"}},"watch"),s("span",{style:{color:"#666666"}},"("),s("span",{style:{color:"#BD976A"}},"state"),s("span",{style:{color:"#666666"}},","),s("span",{style:{color:"#DBD7CAEE"}}," "),s("span",{style:{color:"#666666"}},"()"),s("span",{style:{color:"#DBD7CAEE"}}," "),s("span",{style:{color:"#666666"}},"=>"),s("span",{style:{color:"#DBD7CAEE"}}," "),s("span",{style:{color:"#666666"}},"{"),s("span",{style:{color:"#DBD7CAEE"}}," "),s("span",{style:{color:"#BD976A"}},"console"),s("span",{style:{color:"#666666"}},"."),s("span",{style:{color:"#80A665"}},"log"),s("span",{style:{color:"#666666"}},"("),s("span",{style:{color:"#C98A7DAA"}},"'"),s("span",{style:{color:"#C98A7D"}},"changed!"),s("span",{style:{color:"#C98A7DAA"}},"'"),s("span",{style:{color:"#666666"}},")"),s("span",{style:{color:"#DBD7CAEE"}}," "),s("span",{style:{color:"#666666"}},"},"),s("span",{style:{color:"#DBD7CAEE"}}," "),s("span",{style:{color:"#666666"}},"{"),s("span",{style:{color:"#DBD7CAEE"}}," "),s("span",{style:{color:"#B8A965"}},"deep"),s("span",{style:{color:"#666666"}},":"),s("span",{style:{color:"#DBD7CAEE"}}," "),s("span",{style:{color:"#4D9375"}},"true"),s("span",{style:{color:"#DBD7CAEE"}}," "),s("span",{style:{color:"#666666"}},"})")]),l(`
`),s("span",{class:"line"}),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#BD976A"}},"state"),s("span",{style:{color:"#666666"}},"."),s("span",{style:{color:"#BD976A"}},"info"),s("span",{style:{color:"#666666"}},"."),s("span",{style:{color:"#BD976A"}},"name"),s("span",{style:{color:"#DBD7CAEE"}}," "),s("span",{style:{color:"#666666"}},"="),s("span",{style:{color:"#DBD7CAEE"}}," "),s("span",{style:{color:"#C98A7DAA"}},"'"),s("span",{style:{color:"#C98A7D"}},"Anthony Fu"),s("span",{style:{color:"#C98A7DAA"}},"'")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#758575DD"}},"// changed!")]),l(`
`),s("span",{class:"line"})])]),s("pre",{class:"shiki shiki-light",style:{"background-color":"#ffffff"}},[s("code",{"v-pre":""},[s("span",{class:"line"},[s("span",{style:{color:"#AB5959"}},"const "),s("span",{style:{color:"#B07D48"}},"state"),s("span",{style:{color:"#AB5959"}}," "),s("span",{style:{color:"#999999"}},"="),s("span",{style:{color:"#AB5959"}}," "),s("span",{style:{color:"#59873A"}},"reactive"),s("span",{style:{color:"#999999"}},"({")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#AB5959"}},"  "),s("span",{style:{color:"#998418"}},"info"),s("span",{style:{color:"#999999"}},":"),s("span",{style:{color:"#AB5959"}}," "),s("span",{style:{color:"#999999"}},"{")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#AB5959"}},"    "),s("span",{style:{color:"#998418"}},"name"),s("span",{style:{color:"#999999"}},":"),s("span",{style:{color:"#AB5959"}}," "),s("span",{style:{color:"#B56959AA"}},"'"),s("span",{style:{color:"#B56959"}},"Anthony"),s("span",{style:{color:"#B56959AA"}},"'"),s("span",{style:{color:"#999999"}},",")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#AB5959"}},"  "),s("span",{style:{color:"#999999"}},"}")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#999999"}},"})")]),l(`
`),s("span",{class:"line"}),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#59873A"}},"watch"),s("span",{style:{color:"#999999"}},"("),s("span",{style:{color:"#B07D48"}},"state"),s("span",{style:{color:"#999999"}},","),s("span",{style:{color:"#393A34"}}," "),s("span",{style:{color:"#999999"}},"()"),s("span",{style:{color:"#393A34"}}," "),s("span",{style:{color:"#999999"}},"=>"),s("span",{style:{color:"#393A34"}}," "),s("span",{style:{color:"#999999"}},"{"),s("span",{style:{color:"#393A34"}}," "),s("span",{style:{color:"#B07D48"}},"console"),s("span",{style:{color:"#999999"}},"."),s("span",{style:{color:"#59873A"}},"log"),s("span",{style:{color:"#999999"}},"("),s("span",{style:{color:"#B56959AA"}},"'"),s("span",{style:{color:"#B56959"}},"changed!"),s("span",{style:{color:"#B56959AA"}},"'"),s("span",{style:{color:"#999999"}},")"),s("span",{style:{color:"#393A34"}}," "),s("span",{style:{color:"#999999"}},"},"),s("span",{style:{color:"#393A34"}}," "),s("span",{style:{color:"#999999"}},"{"),s("span",{style:{color:"#393A34"}}," "),s("span",{style:{color:"#998418"}},"deep"),s("span",{style:{color:"#999999"}},":"),s("span",{style:{color:"#393A34"}}," "),s("span",{style:{color:"#1E754F"}},"true"),s("span",{style:{color:"#393A34"}}," "),s("span",{style:{color:"#999999"}},"})")]),l(`
`),s("span",{class:"line"}),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#B07D48"}},"state"),s("span",{style:{color:"#999999"}},"."),s("span",{style:{color:"#B07D48"}},"info"),s("span",{style:{color:"#999999"}},"."),s("span",{style:{color:"#B07D48"}},"name"),s("span",{style:{color:"#393A34"}}," "),s("span",{style:{color:"#999999"}},"="),s("span",{style:{color:"#393A34"}}," "),s("span",{style:{color:"#B56959AA"}},"'"),s("span",{style:{color:"#B56959"}},"Anthony Fu"),s("span",{style:{color:"#B56959AA"}},"'")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A0ADA0"}},"// changed!")]),l(`
`),s("span",{class:"line"})])])])])]),s("p",null,[l("To implement this feature, you need to collect the "),s("code",null,"track()"),l(" events on every nested property. We can achieve that with a "),s("code",null,"traverse"),l(" function.")]),s("pre",null,[s("code",{class:"language-ts"},[s("div",{class:"shiki-container"},[s("pre",{class:"shiki shiki-dark",style:{"background-color":"#121212"}},[s("code",{"v-pre":""},[s("span",{class:"line"},[s("span",{style:{color:"#CB7676"}},"function"),s("span",{style:{color:"#DBD7CAEE"}}," "),s("span",{style:{color:"#80A665"}},"traverse"),s("span",{style:{color:"#666666"}},"("),s("span",{style:{color:"#BD976A"}},"value"),s("span",{style:{color:"#666666"}},","),s("span",{style:{color:"#DBD7CAEE"}}," "),s("span",{style:{color:"#BD976A"}},"seen"),s("span",{style:{color:"#DBD7CAEE"}}," "),s("span",{style:{color:"#666666"}},"="),s("span",{style:{color:"#DBD7CAEE"}}," "),s("span",{style:{color:"#CB7676"}},"new"),s("span",{style:{color:"#DBD7CAEE"}}," "),s("span",{style:{color:"#80A665"}},"Set"),s("span",{style:{color:"#666666"}},"())"),s("span",{style:{color:"#DBD7CAEE"}}," "),s("span",{style:{color:"#666666"}},"{")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#DBD7CAEE"}},"  "),s("span",{style:{color:"#4D9375"}},"if"),s("span",{style:{color:"#DBD7CAEE"}}," "),s("span",{style:{color:"#666666"}},"("),s("span",{style:{color:"#CB7676"}},"!"),s("span",{style:{color:"#80A665"}},"isObject"),s("span",{style:{color:"#666666"}},"("),s("span",{style:{color:"#BD976A"}},"value"),s("span",{style:{color:"#666666"}},")"),s("span",{style:{color:"#DBD7CAEE"}}," "),s("span",{style:{color:"#CB7676"}},"||"),s("span",{style:{color:"#DBD7CAEE"}}," "),s("span",{style:{color:"#BD976A"}},"seen"),s("span",{style:{color:"#666666"}},"."),s("span",{style:{color:"#80A665"}},"has"),s("span",{style:{color:"#666666"}},"("),s("span",{style:{color:"#BD976A"}},"value"),s("span",{style:{color:"#666666"}},"))")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#DBD7CAEE"}},"    "),s("span",{style:{color:"#4D9375"}},"return"),s("span",{style:{color:"#DBD7CAEE"}}," "),s("span",{style:{color:"#BD976A"}},"value")]),l(`
`),s("span",{class:"line"}),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#DBD7CAEE"}},"  "),s("span",{style:{color:"#BD976A"}},"seen"),s("span",{style:{color:"#666666"}},"."),s("span",{style:{color:"#80A665"}},"add"),s("span",{style:{color:"#666666"}},"("),s("span",{style:{color:"#BD976A"}},"value"),s("span",{style:{color:"#666666"}},")"),s("span",{style:{color:"#DBD7CAEE"}}," "),s("span",{style:{color:"#758575DD"}},"// prevent circular reference ")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#DBD7CAEE"}},"  "),s("span",{style:{color:"#4D9375"}},"if"),s("span",{style:{color:"#DBD7CAEE"}}," "),s("span",{style:{color:"#666666"}},"("),s("span",{style:{color:"#80A665"}},"isArray"),s("span",{style:{color:"#666666"}},"("),s("span",{style:{color:"#BD976A"}},"value"),s("span",{style:{color:"#666666"}},"))"),s("span",{style:{color:"#DBD7CAEE"}}," "),s("span",{style:{color:"#666666"}},"{")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#DBD7CAEE"}},"    "),s("span",{style:{color:"#4D9375"}},"for"),s("span",{style:{color:"#DBD7CAEE"}}," "),s("span",{style:{color:"#666666"}},"("),s("span",{style:{color:"#CB7676"}},"let "),s("span",{style:{color:"#BD976A"}},"i"),s("span",{style:{color:"#CB7676"}}," "),s("span",{style:{color:"#666666"}},"="),s("span",{style:{color:"#CB7676"}}," "),s("span",{style:{color:"#4C9A91"}},"0"),s("span",{style:{color:"#666666"}},";"),s("span",{style:{color:"#DBD7CAEE"}}," "),s("span",{style:{color:"#BD976A"}},"i"),s("span",{style:{color:"#DBD7CAEE"}}," "),s("span",{style:{color:"#CB7676"}},"<"),s("span",{style:{color:"#DBD7CAEE"}}," "),s("span",{style:{color:"#BD976A"}},"value"),s("span",{style:{color:"#666666"}},"."),s("span",{style:{color:"#B8A965"}},"length"),s("span",{style:{color:"#666666"}},";"),s("span",{style:{color:"#DBD7CAEE"}}," "),s("span",{style:{color:"#BD976A"}},"i"),s("span",{style:{color:"#CB7676"}},"++"),s("span",{style:{color:"#666666"}},")")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#DBD7CAEE"}},"      "),s("span",{style:{color:"#80A665"}},"traverse"),s("span",{style:{color:"#666666"}},"("),s("span",{style:{color:"#BD976A"}},"value"),s("span",{style:{color:"#666666"}},"["),s("span",{style:{color:"#BD976A"}},"i"),s("span",{style:{color:"#666666"}},"],"),s("span",{style:{color:"#DBD7CAEE"}}," "),s("span",{style:{color:"#BD976A"}},"seen"),s("span",{style:{color:"#666666"}},")")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#DBD7CAEE"}},"  "),s("span",{style:{color:"#666666"}},"}")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#DBD7CAEE"}},"  "),s("span",{style:{color:"#4D9375"}},"else"),s("span",{style:{color:"#DBD7CAEE"}}," "),s("span",{style:{color:"#666666"}},"{")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#DBD7CAEE"}},"    "),s("span",{style:{color:"#4D9375"}},"for"),s("span",{style:{color:"#DBD7CAEE"}}," "),s("span",{style:{color:"#666666"}},"("),s("span",{style:{color:"#CB7676"}},"const "),s("span",{style:{color:"#BD976A"}},"key"),s("span",{style:{color:"#CB7676"}}," of"),s("span",{style:{color:"#DBD7CAEE"}}," "),s("span",{style:{color:"#BD976A"}},"Object"),s("span",{style:{color:"#666666"}},"."),s("span",{style:{color:"#80A665"}},"keys"),s("span",{style:{color:"#666666"}},"("),s("span",{style:{color:"#BD976A"}},"value"),s("span",{style:{color:"#666666"}},"))")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#DBD7CAEE"}},"      "),s("span",{style:{color:"#80A665"}},"traverse"),s("span",{style:{color:"#666666"}},"("),s("span",{style:{color:"#BD976A"}},"value"),s("span",{style:{color:"#666666"}},"["),s("span",{style:{color:"#BD976A"}},"key"),s("span",{style:{color:"#666666"}},"],"),s("span",{style:{color:"#DBD7CAEE"}}," "),s("span",{style:{color:"#BD976A"}},"seen"),s("span",{style:{color:"#666666"}},")")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#DBD7CAEE"}},"  "),s("span",{style:{color:"#666666"}},"}")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#DBD7CAEE"}},"  "),s("span",{style:{color:"#4D9375"}},"return"),s("span",{style:{color:"#DBD7CAEE"}}," "),s("span",{style:{color:"#BD976A"}},"value")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#666666"}},"}")]),l(`
`),s("span",{class:"line"}),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#CB7676"}},"const "),s("span",{style:{color:"#80A665"}},"watch"),s("span",{style:{color:"#CB7676"}}," "),s("span",{style:{color:"#666666"}},"="),s("span",{style:{color:"#CB7676"}}," "),s("span",{style:{color:"#666666"}},"("),s("span",{style:{color:"#BD976A"}},"source"),s("span",{style:{color:"#666666"}},","),s("span",{style:{color:"#CB7676"}}," "),s("span",{style:{color:"#BD976A"}},"fn"),s("span",{style:{color:"#666666"}},","),s("span",{style:{color:"#CB7676"}}," "),s("span",{style:{color:"#666666"}},"{"),s("span",{style:{color:"#CB7676"}}," "),s("span",{style:{color:"#BD976A"}},"deep"),s("span",{style:{color:"#666666"}},","),s("span",{style:{color:"#CB7676"}}," "),s("span",{style:{color:"#BD976A"}},"lazy"),s("span",{style:{color:"#CB7676"}}," "),s("span",{style:{color:"#666666"}},"="),s("span",{style:{color:"#CB7676"}}," "),s("span",{style:{color:"#4D9375"}},"true"),s("span",{style:{color:"#CB7676"}}," "),s("span",{style:{color:"#666666"}},"})"),s("span",{style:{color:"#CB7676"}}," "),s("span",{style:{color:"#666666"}},"=>"),s("span",{style:{color:"#CB7676"}}," "),s("span",{style:{color:"#666666"}},"{")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#CB7676"}},"  let "),s("span",{style:{color:"#BD976A"}},"getter"),s("span",{style:{color:"#CB7676"}}," "),s("span",{style:{color:"#666666"}},"="),s("span",{style:{color:"#CB7676"}}," "),s("span",{style:{color:"#80A665"}},"isRef"),s("span",{style:{color:"#666666"}},"("),s("span",{style:{color:"#BD976A"}},"source"),s("span",{style:{color:"#666666"}},")")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#CB7676"}},"    ? "),s("span",{style:{color:"#666666"}},"()"),s("span",{style:{color:"#CB7676"}}," "),s("span",{style:{color:"#666666"}},"=>"),s("span",{style:{color:"#CB7676"}}," "),s("span",{style:{color:"#BD976A"}},"source"),s("span",{style:{color:"#666666"}},"."),s("span",{style:{color:"#BD976A"}},"value")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#CB7676"}},"    : "),s("span",{style:{color:"#80A665"}},"isReactive"),s("span",{style:{color:"#666666"}},"("),s("span",{style:{color:"#BD976A"}},"source"),s("span",{style:{color:"#666666"}},")"),s("span",{style:{color:"#CB7676"}}," ")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#CB7676"}},"      ? "),s("span",{style:{color:"#666666"}},"()"),s("span",{style:{color:"#CB7676"}}," "),s("span",{style:{color:"#666666"}},"=>"),s("span",{style:{color:"#CB7676"}}," "),s("span",{style:{color:"#BD976A"}},"source")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#CB7676"}},"      : "),s("span",{style:{color:"#BD976A"}},"source")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#CB7676"}},"    ")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#CB7676"}},"  "),s("span",{style:{color:"#4D9375"}},"if"),s("span",{style:{color:"#CB7676"}}," "),s("span",{style:{color:"#666666"}},"("),s("span",{style:{color:"#BD976A"}},"deep"),s("span",{style:{color:"#666666"}},")")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#CB7676"}},"    "),s("span",{style:{color:"#80A665"}},"getter"),s("span",{style:{color:"#CB7676"}}," "),s("span",{style:{color:"#666666"}},"="),s("span",{style:{color:"#CB7676"}}," "),s("span",{style:{color:"#666666"}},"()"),s("span",{style:{color:"#CB7676"}}," "),s("span",{style:{color:"#666666"}},"=>"),s("span",{style:{color:"#CB7676"}}," "),s("span",{style:{color:"#80A665"}},"traverse"),s("span",{style:{color:"#666666"}},"("),s("span",{style:{color:"#80A665"}},"getter"),s("span",{style:{color:"#666666"}},"())")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#CB7676"}},"    ")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#CB7676"}},"  const "),s("span",{style:{color:"#BD976A"}},"runner"),s("span",{style:{color:"#CB7676"}}," "),s("span",{style:{color:"#666666"}},"="),s("span",{style:{color:"#CB7676"}}," "),s("span",{style:{color:"#80A665"}},"effect"),s("span",{style:{color:"#666666"}},"("),s("span",{style:{color:"#BD976A"}},"getter"),s("span",{style:{color:"#666666"}},","),s("span",{style:{color:"#CB7676"}}," "),s("span",{style:{color:"#666666"}},"{")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#CB7676"}},"    "),s("span",{style:{color:"#BD976A"}},"lazy"),s("span",{style:{color:"#666666"}},",")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#CB7676"}},"    "),s("span",{style:{color:"#B8A965"}},"scheduler"),s("span",{style:{color:"#666666"}},":"),s("span",{style:{color:"#CB7676"}}," "),s("span",{style:{color:"#BD976A"}},"fn")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#CB7676"}},"  "),s("span",{style:{color:"#666666"}},"}")]),l(`
`),s("span",{class:"line"}),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#CB7676"}},"  "),s("span",{style:{color:"#80A665"}},"return"),s("span",{style:{color:"#CB7676"}}," "),s("span",{style:{color:"#666666"}},"()"),s("span",{style:{color:"#CB7676"}}," "),s("span",{style:{color:"#666666"}},"=>"),s("span",{style:{color:"#CB7676"}}," "),s("span",{style:{color:"#80A665"}},"stop"),s("span",{style:{color:"#666666"}},"("),s("span",{style:{color:"#BD976A"}},"runner"),s("span",{style:{color:"#666666"}},")")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#CB7676"}},"}")]),l(`
`),s("span",{class:"line"})])]),s("pre",{class:"shiki shiki-light",style:{"background-color":"#ffffff"}},[s("code",{"v-pre":""},[s("span",{class:"line"},[s("span",{style:{color:"#AB5959"}},"function"),s("span",{style:{color:"#393A34"}}," "),s("span",{style:{color:"#59873A"}},"traverse"),s("span",{style:{color:"#999999"}},"("),s("span",{style:{color:"#B07D48"}},"value"),s("span",{style:{color:"#999999"}},","),s("span",{style:{color:"#393A34"}}," "),s("span",{style:{color:"#B07D48"}},"seen"),s("span",{style:{color:"#393A34"}}," "),s("span",{style:{color:"#999999"}},"="),s("span",{style:{color:"#393A34"}}," "),s("span",{style:{color:"#AB5959"}},"new"),s("span",{style:{color:"#393A34"}}," "),s("span",{style:{color:"#59873A"}},"Set"),s("span",{style:{color:"#999999"}},"())"),s("span",{style:{color:"#393A34"}}," "),s("span",{style:{color:"#999999"}},"{")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#393A34"}},"  "),s("span",{style:{color:"#1E754F"}},"if"),s("span",{style:{color:"#393A34"}}," "),s("span",{style:{color:"#999999"}},"("),s("span",{style:{color:"#AB5959"}},"!"),s("span",{style:{color:"#59873A"}},"isObject"),s("span",{style:{color:"#999999"}},"("),s("span",{style:{color:"#B07D48"}},"value"),s("span",{style:{color:"#999999"}},")"),s("span",{style:{color:"#393A34"}}," "),s("span",{style:{color:"#AB5959"}},"||"),s("span",{style:{color:"#393A34"}}," "),s("span",{style:{color:"#B07D48"}},"seen"),s("span",{style:{color:"#999999"}},"."),s("span",{style:{color:"#59873A"}},"has"),s("span",{style:{color:"#999999"}},"("),s("span",{style:{color:"#B07D48"}},"value"),s("span",{style:{color:"#999999"}},"))")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#393A34"}},"    "),s("span",{style:{color:"#1E754F"}},"return"),s("span",{style:{color:"#393A34"}}," "),s("span",{style:{color:"#B07D48"}},"value")]),l(`
`),s("span",{class:"line"}),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#393A34"}},"  "),s("span",{style:{color:"#B07D48"}},"seen"),s("span",{style:{color:"#999999"}},"."),s("span",{style:{color:"#59873A"}},"add"),s("span",{style:{color:"#999999"}},"("),s("span",{style:{color:"#B07D48"}},"value"),s("span",{style:{color:"#999999"}},")"),s("span",{style:{color:"#393A34"}}," "),s("span",{style:{color:"#A0ADA0"}},"// prevent circular reference ")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#393A34"}},"  "),s("span",{style:{color:"#1E754F"}},"if"),s("span",{style:{color:"#393A34"}}," "),s("span",{style:{color:"#999999"}},"("),s("span",{style:{color:"#59873A"}},"isArray"),s("span",{style:{color:"#999999"}},"("),s("span",{style:{color:"#B07D48"}},"value"),s("span",{style:{color:"#999999"}},"))"),s("span",{style:{color:"#393A34"}}," "),s("span",{style:{color:"#999999"}},"{")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#393A34"}},"    "),s("span",{style:{color:"#1E754F"}},"for"),s("span",{style:{color:"#393A34"}}," "),s("span",{style:{color:"#999999"}},"("),s("span",{style:{color:"#AB5959"}},"let "),s("span",{style:{color:"#B07D48"}},"i"),s("span",{style:{color:"#AB5959"}}," "),s("span",{style:{color:"#999999"}},"="),s("span",{style:{color:"#AB5959"}}," "),s("span",{style:{color:"#2F798A"}},"0"),s("span",{style:{color:"#999999"}},";"),s("span",{style:{color:"#393A34"}}," "),s("span",{style:{color:"#B07D48"}},"i"),s("span",{style:{color:"#393A34"}}," "),s("span",{style:{color:"#AB5959"}},"<"),s("span",{style:{color:"#393A34"}}," "),s("span",{style:{color:"#B07D48"}},"value"),s("span",{style:{color:"#999999"}},"."),s("span",{style:{color:"#998418"}},"length"),s("span",{style:{color:"#999999"}},";"),s("span",{style:{color:"#393A34"}}," "),s("span",{style:{color:"#B07D48"}},"i"),s("span",{style:{color:"#AB5959"}},"++"),s("span",{style:{color:"#999999"}},")")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#393A34"}},"      "),s("span",{style:{color:"#59873A"}},"traverse"),s("span",{style:{color:"#999999"}},"("),s("span",{style:{color:"#B07D48"}},"value"),s("span",{style:{color:"#999999"}},"["),s("span",{style:{color:"#B07D48"}},"i"),s("span",{style:{color:"#999999"}},"],"),s("span",{style:{color:"#393A34"}}," "),s("span",{style:{color:"#B07D48"}},"seen"),s("span",{style:{color:"#999999"}},")")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#393A34"}},"  "),s("span",{style:{color:"#999999"}},"}")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#393A34"}},"  "),s("span",{style:{color:"#1E754F"}},"else"),s("span",{style:{color:"#393A34"}}," "),s("span",{style:{color:"#999999"}},"{")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#393A34"}},"    "),s("span",{style:{color:"#1E754F"}},"for"),s("span",{style:{color:"#393A34"}}," "),s("span",{style:{color:"#999999"}},"("),s("span",{style:{color:"#AB5959"}},"const "),s("span",{style:{color:"#B07D48"}},"key"),s("span",{style:{color:"#AB5959"}}," of"),s("span",{style:{color:"#393A34"}}," "),s("span",{style:{color:"#B07D48"}},"Object"),s("span",{style:{color:"#999999"}},"."),s("span",{style:{color:"#59873A"}},"keys"),s("span",{style:{color:"#999999"}},"("),s("span",{style:{color:"#B07D48"}},"value"),s("span",{style:{color:"#999999"}},"))")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#393A34"}},"      "),s("span",{style:{color:"#59873A"}},"traverse"),s("span",{style:{color:"#999999"}},"("),s("span",{style:{color:"#B07D48"}},"value"),s("span",{style:{color:"#999999"}},"["),s("span",{style:{color:"#B07D48"}},"key"),s("span",{style:{color:"#999999"}},"],"),s("span",{style:{color:"#393A34"}}," "),s("span",{style:{color:"#B07D48"}},"seen"),s("span",{style:{color:"#999999"}},")")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#393A34"}},"  "),s("span",{style:{color:"#999999"}},"}")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#393A34"}},"  "),s("span",{style:{color:"#1E754F"}},"return"),s("span",{style:{color:"#393A34"}}," "),s("span",{style:{color:"#B07D48"}},"value")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#999999"}},"}")]),l(`
`),s("span",{class:"line"}),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#AB5959"}},"const "),s("span",{style:{color:"#59873A"}},"watch"),s("span",{style:{color:"#AB5959"}}," "),s("span",{style:{color:"#999999"}},"="),s("span",{style:{color:"#AB5959"}}," "),s("span",{style:{color:"#999999"}},"("),s("span",{style:{color:"#B07D48"}},"source"),s("span",{style:{color:"#999999"}},","),s("span",{style:{color:"#AB5959"}}," "),s("span",{style:{color:"#B07D48"}},"fn"),s("span",{style:{color:"#999999"}},","),s("span",{style:{color:"#AB5959"}}," "),s("span",{style:{color:"#999999"}},"{"),s("span",{style:{color:"#AB5959"}}," "),s("span",{style:{color:"#B07D48"}},"deep"),s("span",{style:{color:"#999999"}},","),s("span",{style:{color:"#AB5959"}}," "),s("span",{style:{color:"#B07D48"}},"lazy"),s("span",{style:{color:"#AB5959"}}," "),s("span",{style:{color:"#999999"}},"="),s("span",{style:{color:"#AB5959"}}," "),s("span",{style:{color:"#1E754F"}},"true"),s("span",{style:{color:"#AB5959"}}," "),s("span",{style:{color:"#999999"}},"})"),s("span",{style:{color:"#AB5959"}}," "),s("span",{style:{color:"#999999"}},"=>"),s("span",{style:{color:"#AB5959"}}," "),s("span",{style:{color:"#999999"}},"{")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#AB5959"}},"  let "),s("span",{style:{color:"#B07D48"}},"getter"),s("span",{style:{color:"#AB5959"}}," "),s("span",{style:{color:"#999999"}},"="),s("span",{style:{color:"#AB5959"}}," "),s("span",{style:{color:"#59873A"}},"isRef"),s("span",{style:{color:"#999999"}},"("),s("span",{style:{color:"#B07D48"}},"source"),s("span",{style:{color:"#999999"}},")")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#AB5959"}},"    ? "),s("span",{style:{color:"#999999"}},"()"),s("span",{style:{color:"#AB5959"}}," "),s("span",{style:{color:"#999999"}},"=>"),s("span",{style:{color:"#AB5959"}}," "),s("span",{style:{color:"#B07D48"}},"source"),s("span",{style:{color:"#999999"}},"."),s("span",{style:{color:"#B07D48"}},"value")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#AB5959"}},"    : "),s("span",{style:{color:"#59873A"}},"isReactive"),s("span",{style:{color:"#999999"}},"("),s("span",{style:{color:"#B07D48"}},"source"),s("span",{style:{color:"#999999"}},")"),s("span",{style:{color:"#AB5959"}}," ")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#AB5959"}},"      ? "),s("span",{style:{color:"#999999"}},"()"),s("span",{style:{color:"#AB5959"}}," "),s("span",{style:{color:"#999999"}},"=>"),s("span",{style:{color:"#AB5959"}}," "),s("span",{style:{color:"#B07D48"}},"source")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#AB5959"}},"      : "),s("span",{style:{color:"#B07D48"}},"source")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#AB5959"}},"    ")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#AB5959"}},"  "),s("span",{style:{color:"#1E754F"}},"if"),s("span",{style:{color:"#AB5959"}}," "),s("span",{style:{color:"#999999"}},"("),s("span",{style:{color:"#B07D48"}},"deep"),s("span",{style:{color:"#999999"}},")")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#AB5959"}},"    "),s("span",{style:{color:"#59873A"}},"getter"),s("span",{style:{color:"#AB5959"}}," "),s("span",{style:{color:"#999999"}},"="),s("span",{style:{color:"#AB5959"}}," "),s("span",{style:{color:"#999999"}},"()"),s("span",{style:{color:"#AB5959"}}," "),s("span",{style:{color:"#999999"}},"=>"),s("span",{style:{color:"#AB5959"}}," "),s("span",{style:{color:"#59873A"}},"traverse"),s("span",{style:{color:"#999999"}},"("),s("span",{style:{color:"#59873A"}},"getter"),s("span",{style:{color:"#999999"}},"())")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#AB5959"}},"    ")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#AB5959"}},"  const "),s("span",{style:{color:"#B07D48"}},"runner"),s("span",{style:{color:"#AB5959"}}," "),s("span",{style:{color:"#999999"}},"="),s("span",{style:{color:"#AB5959"}}," "),s("span",{style:{color:"#59873A"}},"effect"),s("span",{style:{color:"#999999"}},"("),s("span",{style:{color:"#B07D48"}},"getter"),s("span",{style:{color:"#999999"}},","),s("span",{style:{color:"#AB5959"}}," "),s("span",{style:{color:"#999999"}},"{")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#AB5959"}},"    "),s("span",{style:{color:"#B07D48"}},"lazy"),s("span",{style:{color:"#999999"}},",")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#AB5959"}},"    "),s("span",{style:{color:"#998418"}},"scheduler"),s("span",{style:{color:"#999999"}},":"),s("span",{style:{color:"#AB5959"}}," "),s("span",{style:{color:"#B07D48"}},"fn")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#AB5959"}},"  "),s("span",{style:{color:"#999999"}},"}")]),l(`
`),s("span",{class:"line"}),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#AB5959"}},"  "),s("span",{style:{color:"#59873A"}},"return"),s("span",{style:{color:"#AB5959"}}," "),s("span",{style:{color:"#999999"}},"()"),s("span",{style:{color:"#AB5959"}}," "),s("span",{style:{color:"#999999"}},"=>"),s("span",{style:{color:"#AB5959"}}," "),s("span",{style:{color:"#59873A"}},"stop"),s("span",{style:{color:"#999999"}},"("),s("span",{style:{color:"#B07D48"}},"runner"),s("span",{style:{color:"#999999"}},")")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#AB5959"}},"}")]),l(`
`),s("span",{class:"line"})])])])])]),s("p",null,[l("Done! The thing left to do is to polish, adding overloads to make it more flexible, add more options to get better control, and handle some edge cases. Then you should get yourself a good start for using a custom "),s("code",null,"watch"),l("!")]),s("h2",{id:"lifecycles",tabindex:"-1"},[l("Lifecycles "),s("a",{class:"header-anchor",href:"#lifecycles","aria-hidden":"true"},"#")]),s("p",null,[l("In Vue, "),s("code",null,"computed"),l(" and "),s("code",null,"watch"),l(" will automatically bind their "),s("code",null,"effect"),l(" runner to the current component instance. When the component get unmounted, the effects bond to it will be auto disposed. More specially, you can read "),s("a",{href:"https://github.com/vuejs/core/blob/985bd2bcb5fd8bccd1c15c8c5d89a6919fd73922/packages/runtime-core/src/apiWatch.ts#L294",target:"_blank",rel:"noopener"},"the source code here"),l(".")]),s("p",null,"Since we donâ€™t have an instance, if you want to stop those effects, you have to do them manually. When you have multiple effects in used, to stop them together, you have to manually collect them together. One easier way is to mock similar lifecycles like Vue. This requires some amount of works, I will explain that in another blog post. Please keep tuned."),s("h2",{id:"take-away",tabindex:"-1"},[l("Take Away "),s("a",{class:"header-anchor",href:"#take-away","aria-hidden":"true"},"#")]),s("p",null,[l("Thanks for reading! And hope it is helpful for you to understand and better play with the Vue reactivity system. If you want to have the "),s("code",null,"watch"),l(" outside of Vue, I made one for you (much more robust than the examples above for sure).")]),s("pre",{class:"block language-bash"},[l("npm i "),s("a",{href:"https://github.com/antfu/vue-reactivity-watch",target:"_blank"},"@vue-reactivity/watch"),l(`
`)]),s("p",null,"Have fun ;P")],-1),h="Watch with @vue/reactivity",d="A brief intro of how it works and a guide to implementing the (missing) `watch` on your own.",C="2020-09-18T00:00:00.000Z",f="en",g="12min",v="https://antfu.me/og/watch-with-reactivity.png",m=[{property:"og:title",content:"Watch with @vue/reactivity"},{property:"og:description",content:"A brief intro of how it works and a guide to implementing the (missing) `watch` on your own."},{name:"description",content:"A brief intro of how it works and a guide to implementing the (missing) `watch` on your own."},{property:"og:image",content:"https://antfu.me/og/watch-with-reactivity.png"},{name:"twitter:card",content:"summary_large_image"}],E={__name:"watch-with-reactivity",setup(i,{expose:e}){const o={title:"Watch with @vue/reactivity",description:"A brief intro of how it works and a guide to implementing the (missing) `watch` on your own.",date:"2020-09-18T00:00:00.000Z",lang:"en",duration:"12min",image:"https://antfu.me/og/watch-with-reactivity.png",meta:[{property:"og:title",content:"Watch with @vue/reactivity"},{property:"og:description",content:"A brief intro of how it works and a guide to implementing the (missing) `watch` on your own."},{name:"description",content:"A brief intro of how it works and a guide to implementing the (missing) `watch` on your own."},{property:"og:image",content:"https://antfu.me/og/watch-with-reactivity.png"},{name:"twitter:card",content:"summary_large_image"}]};return e({frontmatter:o}),a({title:"Watch with @vue/reactivity",meta:[{property:"og:title",content:"Watch with @vue/reactivity"},{property:"og:description",content:"A brief intro of how it works and a guide to implementing the (missing) `watch` on your own."},{name:"description",content:"A brief intro of how it works and a guide to implementing the (missing) `watch` on your own."},{property:"og:image",content:"https://antfu.me/og/watch-with-reactivity.png"},{name:"twitter:card",content:"summary_large_image"}]}),(A,u)=>{const n=r;return p(),t(n,{frontmatter:o},{default:c(()=>[y]),_:1})}}};export{C as date,E as default,d as description,g as duration,v as image,f as lang,m as meta,h as title};
