import{u as a,c as t,w as c,_ as p,o as r,a as s,d as l}from"./app-b1fb3549.js";const y=s("div",{class:"prose m-auto"},[s("p",null,[s("code",null,"async"),l(" / "),s("code",null,"await"),l(" in ES7 is truly a life-saver for the JavaScript world. It allows you to avoid "),s("a",{href:"http://callbackhell.com/",target:"_blank",rel:"noopener"},"callback hell"),l(" in your code and make it more readable. However, a common pitfall is that when you "),s("code",null,"await"),l(" a huge asynchronous task that takes very long time, it blocks the following code and could potentially make your app slow.")]),s("p",null,"For example:"),s("pre",null,[s("code",{class:"language-ts"},[s("div",{class:"shiki-container"},[s("pre",{class:"shiki shiki-dark",style:{"background-color":"#121212"}},[s("code",{"v-pre":""},[s("span",{class:"line"},[s("span",{style:{color:"#CB7676"}},"const "),s("span",{style:{color:"#BD976A"}},"app"),s("span",{style:{color:"#CB7676"}}," "),s("span",{style:{color:"#666666"}},"="),s("span",{style:{color:"#CB7676"}}," "),s("span",{style:{color:"#4D9375"}},"await"),s("span",{style:{color:"#CB7676"}}," "),s("span",{style:{color:"#80A665"}},"createServer"),s("span",{style:{color:"#666666"}},"()")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#CB7676"}},"const "),s("span",{style:{color:"#BD976A"}},"middlewareA"),s("span",{style:{color:"#CB7676"}}," "),s("span",{style:{color:"#666666"}},"="),s("span",{style:{color:"#CB7676"}}," "),s("span",{style:{color:"#4D9375"}},"await"),s("span",{style:{color:"#CB7676"}}," "),s("span",{style:{color:"#80A665"}},"resolveMiddlewareA"),s("span",{style:{color:"#666666"}},"()")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#CB7676"}},"const "),s("span",{style:{color:"#BD976A"}},"middlewareB"),s("span",{style:{color:"#CB7676"}}," "),s("span",{style:{color:"#666666"}},"="),s("span",{style:{color:"#CB7676"}}," "),s("span",{style:{color:"#4D9375"}},"await"),s("span",{style:{color:"#CB7676"}}," "),s("span",{style:{color:"#80A665"}},"resolveMiddlewareB"),s("span",{style:{color:"#666666"}},"()")]),l(`
`),s("span",{class:"line"}),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#BD976A"}},"app"),s("span",{style:{color:"#666666"}},"."),s("span",{style:{color:"#80A665"}},"use"),s("span",{style:{color:"#666666"}},"("),s("span",{style:{color:"#BD976A"}},"middlewareA"),s("span",{style:{color:"#666666"}},")")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#BD976A"}},"app"),s("span",{style:{color:"#666666"}},"."),s("span",{style:{color:"#80A665"}},"use"),s("span",{style:{color:"#666666"}},"("),s("span",{style:{color:"#BD976A"}},"middlewareB"),s("span",{style:{color:"#666666"}},")")]),l(`
`),s("span",{class:"line"})])]),s("pre",{class:"shiki shiki-light",style:{"background-color":"#ffffff"}},[s("code",{"v-pre":""},[s("span",{class:"line"},[s("span",{style:{color:"#AB5959"}},"const "),s("span",{style:{color:"#B07D48"}},"app"),s("span",{style:{color:"#AB5959"}}," "),s("span",{style:{color:"#999999"}},"="),s("span",{style:{color:"#AB5959"}}," "),s("span",{style:{color:"#1E754F"}},"await"),s("span",{style:{color:"#AB5959"}}," "),s("span",{style:{color:"#59873A"}},"createServer"),s("span",{style:{color:"#999999"}},"()")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#AB5959"}},"const "),s("span",{style:{color:"#B07D48"}},"middlewareA"),s("span",{style:{color:"#AB5959"}}," "),s("span",{style:{color:"#999999"}},"="),s("span",{style:{color:"#AB5959"}}," "),s("span",{style:{color:"#1E754F"}},"await"),s("span",{style:{color:"#AB5959"}}," "),s("span",{style:{color:"#59873A"}},"resolveMiddlewareA"),s("span",{style:{color:"#999999"}},"()")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#AB5959"}},"const "),s("span",{style:{color:"#B07D48"}},"middlewareB"),s("span",{style:{color:"#AB5959"}}," "),s("span",{style:{color:"#999999"}},"="),s("span",{style:{color:"#AB5959"}}," "),s("span",{style:{color:"#1E754F"}},"await"),s("span",{style:{color:"#AB5959"}}," "),s("span",{style:{color:"#59873A"}},"resolveMiddlewareB"),s("span",{style:{color:"#999999"}},"()")]),l(`
`),s("span",{class:"line"}),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#B07D48"}},"app"),s("span",{style:{color:"#999999"}},"."),s("span",{style:{color:"#59873A"}},"use"),s("span",{style:{color:"#999999"}},"("),s("span",{style:{color:"#B07D48"}},"middlewareA"),s("span",{style:{color:"#999999"}},")")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#B07D48"}},"app"),s("span",{style:{color:"#999999"}},"."),s("span",{style:{color:"#59873A"}},"use"),s("span",{style:{color:"#999999"}},"("),s("span",{style:{color:"#B07D48"}},"middlewareB"),s("span",{style:{color:"#999999"}},")")]),l(`
`),s("span",{class:"line"})])])])])]),s("p",null,[l("We have used three "),s("code",null,"await"),l(" in the example, while the three async function does not actually relying on each other, having them sequentially we are possibility wasted some time of the operations that could be parallelized (IO, Network, etc.)")]),s("p",null,[l("So we can use "),s("a",{href:"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise/all",target:"_blank",rel:"noopener"},[s("code",null,"Promise.all")]),l(" to optimize the code:")]),s("pre",null,[s("code",{class:"language-ts"},[s("div",{class:"shiki-container"},[s("pre",{class:"shiki shiki-dark",style:{"background-color":"#121212"}},[s("code",{"v-pre":""},[s("span",{class:"line"},[s("span",{style:{color:"#CB7676"}},"const "),s("span",{style:{color:"#666666"}},"["),s("span",{style:{color:"#BD976A"}},"app"),s("span",{style:{color:"#666666"}},","),s("span",{style:{color:"#CB7676"}}," "),s("span",{style:{color:"#BD976A"}},"middlewareA"),s("span",{style:{color:"#666666"}},","),s("span",{style:{color:"#CB7676"}}," "),s("span",{style:{color:"#BD976A"}},"middlewareB"),s("span",{style:{color:"#666666"}},"]"),s("span",{style:{color:"#CB7676"}}," "),s("span",{style:{color:"#666666"}},"="),s("span",{style:{color:"#CB7676"}}," "),s("span",{style:{color:"#4D9375"}},"await"),s("span",{style:{color:"#CB7676"}}," "),s("span",{style:{color:"#B8A965"}},"Promise"),s("span",{style:{color:"#666666"}},"."),s("span",{style:{color:"#80A665"}},"all"),s("span",{style:{color:"#666666"}},"(")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#CB7676"}},"  "),s("span",{style:{color:"#666666"}},"[")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#CB7676"}},"    "),s("span",{style:{color:"#80A665"}},"createServer"),s("span",{style:{color:"#666666"}},"(),")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#CB7676"}},"    "),s("span",{style:{color:"#80A665"}},"resolveMiddlewareA"),s("span",{style:{color:"#666666"}},"(),")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#CB7676"}},"    "),s("span",{style:{color:"#80A665"}},"resolveMiddlewareB"),s("span",{style:{color:"#666666"}},"(),")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#CB7676"}},"  "),s("span",{style:{color:"#666666"}},"],")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#666666"}},")")]),l(`
`),s("span",{class:"line"}),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#BD976A"}},"app"),s("span",{style:{color:"#666666"}},"."),s("span",{style:{color:"#80A665"}},"use"),s("span",{style:{color:"#666666"}},"("),s("span",{style:{color:"#BD976A"}},"middlewareA"),s("span",{style:{color:"#666666"}},")")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#BD976A"}},"app"),s("span",{style:{color:"#666666"}},"."),s("span",{style:{color:"#80A665"}},"use"),s("span",{style:{color:"#666666"}},"("),s("span",{style:{color:"#BD976A"}},"middlewareB"),s("span",{style:{color:"#666666"}},")")]),l(`
`),s("span",{class:"line"})])]),s("pre",{class:"shiki shiki-light",style:{"background-color":"#ffffff"}},[s("code",{"v-pre":""},[s("span",{class:"line"},[s("span",{style:{color:"#AB5959"}},"const "),s("span",{style:{color:"#999999"}},"["),s("span",{style:{color:"#B07D48"}},"app"),s("span",{style:{color:"#999999"}},","),s("span",{style:{color:"#AB5959"}}," "),s("span",{style:{color:"#B07D48"}},"middlewareA"),s("span",{style:{color:"#999999"}},","),s("span",{style:{color:"#AB5959"}}," "),s("span",{style:{color:"#B07D48"}},"middlewareB"),s("span",{style:{color:"#999999"}},"]"),s("span",{style:{color:"#AB5959"}}," "),s("span",{style:{color:"#999999"}},"="),s("span",{style:{color:"#AB5959"}}," "),s("span",{style:{color:"#1E754F"}},"await"),s("span",{style:{color:"#AB5959"}}," "),s("span",{style:{color:"#998418"}},"Promise"),s("span",{style:{color:"#999999"}},"."),s("span",{style:{color:"#59873A"}},"all"),s("span",{style:{color:"#999999"}},"(")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#AB5959"}},"  "),s("span",{style:{color:"#999999"}},"[")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#AB5959"}},"    "),s("span",{style:{color:"#59873A"}},"createServer"),s("span",{style:{color:"#999999"}},"(),")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#AB5959"}},"    "),s("span",{style:{color:"#59873A"}},"resolveMiddlewareA"),s("span",{style:{color:"#999999"}},"(),")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#AB5959"}},"    "),s("span",{style:{color:"#59873A"}},"resolveMiddlewareB"),s("span",{style:{color:"#999999"}},"(),")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#AB5959"}},"  "),s("span",{style:{color:"#999999"}},"],")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#999999"}},")")]),l(`
`),s("span",{class:"line"}),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#B07D48"}},"app"),s("span",{style:{color:"#999999"}},"."),s("span",{style:{color:"#59873A"}},"use"),s("span",{style:{color:"#999999"}},"("),s("span",{style:{color:"#B07D48"}},"middlewareA"),s("span",{style:{color:"#999999"}},")")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#B07D48"}},"app"),s("span",{style:{color:"#999999"}},"."),s("span",{style:{color:"#59873A"}},"use"),s("span",{style:{color:"#999999"}},"("),s("span",{style:{color:"#B07D48"}},"middlewareB"),s("span",{style:{color:"#999999"}},")")]),l(`
`),s("span",{class:"line"})])])])])]),s("p",null,"In another example, you might relying on the async result, but sometime not that urgent:"),s("pre",null,[s("code",{class:"language-ts"},[s("div",{class:"shiki-container"},[s("pre",{class:"shiki shiki-dark",style:{"background-color":"#121212"}},[s("code",{"v-pre":""},[s("span",{class:"line"},[s("span",{style:{color:"#CB7676"}},"async"),s("span",{style:{color:"#DBD7CAEE"}}," "),s("span",{style:{color:"#CB7676"}},"function"),s("span",{style:{color:"#DBD7CAEE"}}," "),s("span",{style:{color:"#80A665"}},"createPlugin"),s("span",{style:{color:"#666666"}},"()"),s("span",{style:{color:"#DBD7CAEE"}}," "),s("span",{style:{color:"#666666"}},"{")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#DBD7CAEE"}},"  "),s("span",{style:{color:"#CB7676"}},"const "),s("span",{style:{color:"#BD976A"}},"toolkit"),s("span",{style:{color:"#CB7676"}}," "),s("span",{style:{color:"#666666"}},"="),s("span",{style:{color:"#CB7676"}}," "),s("span",{style:{color:"#4D9375"}},"await"),s("span",{style:{color:"#CB7676"}}," "),s("span",{style:{color:"#80A665"}},"initToolKit"),s("span",{style:{color:"#666666"}},"()")]),l(`
`),s("span",{class:"line"}),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#DBD7CAEE"}},"  "),s("span",{style:{color:"#4D9375"}},"return"),s("span",{style:{color:"#DBD7CAEE"}}," "),s("span",{style:{color:"#666666"}},"{")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#DBD7CAEE"}},"    "),s("span",{style:{color:"#80A665"}},"onHookA"),s("span",{style:{color:"#666666"}},"()"),s("span",{style:{color:"#DBD7CAEE"}}," "),s("span",{style:{color:"#666666"}},"{")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#DBD7CAEE"}},"      "),s("span",{style:{color:"#BD976A"}},"toolkit"),s("span",{style:{color:"#666666"}},"."),s("span",{style:{color:"#80A665"}},"invokeA"),s("span",{style:{color:"#666666"}},"()")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#DBD7CAEE"}},"    "),s("span",{style:{color:"#666666"}},"},")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#DBD7CAEE"}},"    "),s("span",{style:{color:"#80A665"}},"onHookB"),s("span",{style:{color:"#666666"}},"()"),s("span",{style:{color:"#DBD7CAEE"}}," "),s("span",{style:{color:"#666666"}},"{")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#DBD7CAEE"}},"      "),s("span",{style:{color:"#BD976A"}},"toolkit"),s("span",{style:{color:"#666666"}},"."),s("span",{style:{color:"#80A665"}},"invokeB"),s("span",{style:{color:"#666666"}},"()")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#DBD7CAEE"}},"    "),s("span",{style:{color:"#666666"}},"},")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#DBD7CAEE"}},"  "),s("span",{style:{color:"#666666"}},"}")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#666666"}},"}")]),l(`
`),s("span",{class:"line"}),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#CB7676"}},"const "),s("span",{style:{color:"#BD976A"}},"plugin"),s("span",{style:{color:"#CB7676"}}," "),s("span",{style:{color:"#666666"}},"="),s("span",{style:{color:"#CB7676"}}," "),s("span",{style:{color:"#4D9375"}},"await"),s("span",{style:{color:"#CB7676"}}," "),s("span",{style:{color:"#80A665"}},"createPlugin"),s("span",{style:{color:"#666666"}},"()")]),l(`
`),s("span",{class:"line"})])]),s("pre",{class:"shiki shiki-light",style:{"background-color":"#ffffff"}},[s("code",{"v-pre":""},[s("span",{class:"line"},[s("span",{style:{color:"#AB5959"}},"async"),s("span",{style:{color:"#393A34"}}," "),s("span",{style:{color:"#AB5959"}},"function"),s("span",{style:{color:"#393A34"}}," "),s("span",{style:{color:"#59873A"}},"createPlugin"),s("span",{style:{color:"#999999"}},"()"),s("span",{style:{color:"#393A34"}}," "),s("span",{style:{color:"#999999"}},"{")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#393A34"}},"  "),s("span",{style:{color:"#AB5959"}},"const "),s("span",{style:{color:"#B07D48"}},"toolkit"),s("span",{style:{color:"#AB5959"}}," "),s("span",{style:{color:"#999999"}},"="),s("span",{style:{color:"#AB5959"}}," "),s("span",{style:{color:"#1E754F"}},"await"),s("span",{style:{color:"#AB5959"}}," "),s("span",{style:{color:"#59873A"}},"initToolKit"),s("span",{style:{color:"#999999"}},"()")]),l(`
`),s("span",{class:"line"}),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#393A34"}},"  "),s("span",{style:{color:"#1E754F"}},"return"),s("span",{style:{color:"#393A34"}}," "),s("span",{style:{color:"#999999"}},"{")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#393A34"}},"    "),s("span",{style:{color:"#59873A"}},"onHookA"),s("span",{style:{color:"#999999"}},"()"),s("span",{style:{color:"#393A34"}}," "),s("span",{style:{color:"#999999"}},"{")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#393A34"}},"      "),s("span",{style:{color:"#B07D48"}},"toolkit"),s("span",{style:{color:"#999999"}},"."),s("span",{style:{color:"#59873A"}},"invokeA"),s("span",{style:{color:"#999999"}},"()")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#393A34"}},"    "),s("span",{style:{color:"#999999"}},"},")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#393A34"}},"    "),s("span",{style:{color:"#59873A"}},"onHookB"),s("span",{style:{color:"#999999"}},"()"),s("span",{style:{color:"#393A34"}}," "),s("span",{style:{color:"#999999"}},"{")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#393A34"}},"      "),s("span",{style:{color:"#B07D48"}},"toolkit"),s("span",{style:{color:"#999999"}},"."),s("span",{style:{color:"#59873A"}},"invokeB"),s("span",{style:{color:"#999999"}},"()")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#393A34"}},"    "),s("span",{style:{color:"#999999"}},"},")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#393A34"}},"  "),s("span",{style:{color:"#999999"}},"}")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#999999"}},"}")]),l(`
`),s("span",{class:"line"}),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#AB5959"}},"const "),s("span",{style:{color:"#B07D48"}},"plugin"),s("span",{style:{color:"#AB5959"}}," "),s("span",{style:{color:"#999999"}},"="),s("span",{style:{color:"#AB5959"}}," "),s("span",{style:{color:"#1E754F"}},"await"),s("span",{style:{color:"#AB5959"}}," "),s("span",{style:{color:"#59873A"}},"createPlugin"),s("span",{style:{color:"#999999"}},"()")]),l(`
`),s("span",{class:"line"})])])])])]),s("p",null,[l("Even though you don’t need "),s("code",null,"toolkit"),l(" immediately, you are still forced to use "),s("code",null,"async function"),l(" because the "),s("code",null,"initToolKit"),l(" is async. To avoid this, we could make the promise been resolved in the hooks instead")]),s("pre",null,[s("code",{class:"language-ts"},[s("div",{class:"shiki-container"},[s("pre",{class:"shiki shiki-dark",style:{"background-color":"#121212"}},[s("code",{"v-pre":""},[s("span",{class:"line"},[s("span",{style:{color:"#CB7676"}},"function"),s("span",{style:{color:"#DBD7CAEE"}}," "),s("span",{style:{color:"#80A665"}},"createPlugin"),s("span",{style:{color:"#666666"}},"()"),s("span",{style:{color:"#DBD7CAEE"}}," "),s("span",{style:{color:"#666666"}},"{")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#DBD7CAEE"}},"  "),s("span",{style:{color:"#CB7676"}},"const "),s("span",{style:{color:"#BD976A"}},"toolkitPromise"),s("span",{style:{color:"#CB7676"}}," "),s("span",{style:{color:"#666666"}},"="),s("span",{style:{color:"#CB7676"}}," "),s("span",{style:{color:"#80A665"}},"initToolKit"),s("span",{style:{color:"#666666"}},"()")]),l(`
`),s("span",{class:"line"}),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#DBD7CAEE"}},"  "),s("span",{style:{color:"#4D9375"}},"return"),s("span",{style:{color:"#DBD7CAEE"}}," "),s("span",{style:{color:"#666666"}},"{")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#DBD7CAEE"}},"    "),s("span",{style:{color:"#CB7676"}},"async"),s("span",{style:{color:"#DBD7CAEE"}}," "),s("span",{style:{color:"#80A665"}},"onHookA"),s("span",{style:{color:"#666666"}},"()"),s("span",{style:{color:"#DBD7CAEE"}}," "),s("span",{style:{color:"#666666"}},"{")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#DBD7CAEE"}},"      "),s("span",{style:{color:"#CB7676"}},"const "),s("span",{style:{color:"#BD976A"}},"toolkit"),s("span",{style:{color:"#CB7676"}}," "),s("span",{style:{color:"#666666"}},"="),s("span",{style:{color:"#CB7676"}}," "),s("span",{style:{color:"#4D9375"}},"await"),s("span",{style:{color:"#CB7676"}}," "),s("span",{style:{color:"#BD976A"}},"toolkitPromise")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#DBD7CAEE"}},"      "),s("span",{style:{color:"#BD976A"}},"toolkit"),s("span",{style:{color:"#666666"}},"."),s("span",{style:{color:"#80A665"}},"invokeA"),s("span",{style:{color:"#666666"}},"()")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#DBD7CAEE"}},"    "),s("span",{style:{color:"#666666"}},"},")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#DBD7CAEE"}},"    "),s("span",{style:{color:"#CB7676"}},"async"),s("span",{style:{color:"#DBD7CAEE"}}," "),s("span",{style:{color:"#80A665"}},"onHookB"),s("span",{style:{color:"#666666"}},"()"),s("span",{style:{color:"#DBD7CAEE"}}," "),s("span",{style:{color:"#666666"}},"{")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#DBD7CAEE"}},"      "),s("span",{style:{color:"#CB7676"}},"const "),s("span",{style:{color:"#BD976A"}},"toolkit"),s("span",{style:{color:"#CB7676"}}," "),s("span",{style:{color:"#666666"}},"="),s("span",{style:{color:"#CB7676"}}," "),s("span",{style:{color:"#4D9375"}},"await"),s("span",{style:{color:"#CB7676"}}," "),s("span",{style:{color:"#BD976A"}},"toolkitPromise")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#DBD7CAEE"}},"      "),s("span",{style:{color:"#BD976A"}},"toolkit"),s("span",{style:{color:"#666666"}},"."),s("span",{style:{color:"#80A665"}},"invokeB"),s("span",{style:{color:"#666666"}},"()")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#DBD7CAEE"}},"    "),s("span",{style:{color:"#666666"}},"},")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#DBD7CAEE"}},"  "),s("span",{style:{color:"#666666"}},"}")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#666666"}},"}")]),l(`
`),s("span",{class:"line"}),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#758575DD"}},"// now it's sync!")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#CB7676"}},"const "),s("span",{style:{color:"#BD976A"}},"plugin"),s("span",{style:{color:"#CB7676"}}," "),s("span",{style:{color:"#666666"}},"="),s("span",{style:{color:"#CB7676"}}," "),s("span",{style:{color:"#80A665"}},"createPlugin"),s("span",{style:{color:"#666666"}},"()")]),l(`
`),s("span",{class:"line"})])]),s("pre",{class:"shiki shiki-light",style:{"background-color":"#ffffff"}},[s("code",{"v-pre":""},[s("span",{class:"line"},[s("span",{style:{color:"#AB5959"}},"function"),s("span",{style:{color:"#393A34"}}," "),s("span",{style:{color:"#59873A"}},"createPlugin"),s("span",{style:{color:"#999999"}},"()"),s("span",{style:{color:"#393A34"}}," "),s("span",{style:{color:"#999999"}},"{")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#393A34"}},"  "),s("span",{style:{color:"#AB5959"}},"const "),s("span",{style:{color:"#B07D48"}},"toolkitPromise"),s("span",{style:{color:"#AB5959"}}," "),s("span",{style:{color:"#999999"}},"="),s("span",{style:{color:"#AB5959"}}," "),s("span",{style:{color:"#59873A"}},"initToolKit"),s("span",{style:{color:"#999999"}},"()")]),l(`
`),s("span",{class:"line"}),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#393A34"}},"  "),s("span",{style:{color:"#1E754F"}},"return"),s("span",{style:{color:"#393A34"}}," "),s("span",{style:{color:"#999999"}},"{")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#393A34"}},"    "),s("span",{style:{color:"#AB5959"}},"async"),s("span",{style:{color:"#393A34"}}," "),s("span",{style:{color:"#59873A"}},"onHookA"),s("span",{style:{color:"#999999"}},"()"),s("span",{style:{color:"#393A34"}}," "),s("span",{style:{color:"#999999"}},"{")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#393A34"}},"      "),s("span",{style:{color:"#AB5959"}},"const "),s("span",{style:{color:"#B07D48"}},"toolkit"),s("span",{style:{color:"#AB5959"}}," "),s("span",{style:{color:"#999999"}},"="),s("span",{style:{color:"#AB5959"}}," "),s("span",{style:{color:"#1E754F"}},"await"),s("span",{style:{color:"#AB5959"}}," "),s("span",{style:{color:"#B07D48"}},"toolkitPromise")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#393A34"}},"      "),s("span",{style:{color:"#B07D48"}},"toolkit"),s("span",{style:{color:"#999999"}},"."),s("span",{style:{color:"#59873A"}},"invokeA"),s("span",{style:{color:"#999999"}},"()")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#393A34"}},"    "),s("span",{style:{color:"#999999"}},"},")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#393A34"}},"    "),s("span",{style:{color:"#AB5959"}},"async"),s("span",{style:{color:"#393A34"}}," "),s("span",{style:{color:"#59873A"}},"onHookB"),s("span",{style:{color:"#999999"}},"()"),s("span",{style:{color:"#393A34"}}," "),s("span",{style:{color:"#999999"}},"{")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#393A34"}},"      "),s("span",{style:{color:"#AB5959"}},"const "),s("span",{style:{color:"#B07D48"}},"toolkit"),s("span",{style:{color:"#AB5959"}}," "),s("span",{style:{color:"#999999"}},"="),s("span",{style:{color:"#AB5959"}}," "),s("span",{style:{color:"#1E754F"}},"await"),s("span",{style:{color:"#AB5959"}}," "),s("span",{style:{color:"#B07D48"}},"toolkitPromise")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#393A34"}},"      "),s("span",{style:{color:"#B07D48"}},"toolkit"),s("span",{style:{color:"#999999"}},"."),s("span",{style:{color:"#59873A"}},"invokeB"),s("span",{style:{color:"#999999"}},"()")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#393A34"}},"    "),s("span",{style:{color:"#999999"}},"},")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#393A34"}},"  "),s("span",{style:{color:"#999999"}},"}")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#999999"}},"}")]),l(`
`),s("span",{class:"line"}),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#A0ADA0"}},"// now it's sync!")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#AB5959"}},"const "),s("span",{style:{color:"#B07D48"}},"plugin"),s("span",{style:{color:"#AB5959"}}," "),s("span",{style:{color:"#999999"}},"="),s("span",{style:{color:"#AB5959"}}," "),s("span",{style:{color:"#59873A"}},"createPlugin"),s("span",{style:{color:"#999999"}},"()")]),l(`
`),s("span",{class:"line"})])])])])]),s("p",null,[l("Since a Promise could only "),s("a",{href:"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise#description",target:"_blank",rel:"noopener"},"be resolved once"),l(", using multiple "),s("code",null,"await"),l(" for a single Promise instance is "),s("a",{href:"https://blog.ashleygrant.com/2020/04/30/resolved-javascript-promises-can-be-used-multiple-times/",target:"_blank",rel:"noopener"},"totally fine"),l(" - it will return the resolved result immediate if the Promise is allready settled.")]),s("p",null,"To be more generalized, we could have an utility function like:"),s("pre",null,[s("code",{class:"language-ts"},[s("div",{class:"shiki-container"},[s("pre",{class:"shiki shiki-dark",style:{"background-color":"#121212"}},[s("code",{"v-pre":""},[s("span",{class:"line"},[s("span",{style:{color:"#4D9375"}},"export"),s("span",{style:{color:"#DBD7CAEE"}}," "),s("span",{style:{color:"#CB7676"}},"function"),s("span",{style:{color:"#DBD7CAEE"}}," "),s("span",{style:{color:"#80A665"}},"createSingletonPromise"),s("span",{style:{color:"#666666"}},"<"),s("span",{style:{color:"#5DA9A7"}},"T"),s("span",{style:{color:"#666666"}},">("),s("span",{style:{color:"#80A665"}},"fn"),s("span",{style:{color:"#666666"}},": () => "),s("span",{style:{color:"#5DA9A7"}},"Promise"),s("span",{style:{color:"#666666"}},"<"),s("span",{style:{color:"#5DA9A7"}},"T"),s("span",{style:{color:"#666666"}},">)"),s("span",{style:{color:"#DBD7CAEE"}}," "),s("span",{style:{color:"#666666"}},"{")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#DBD7CAEE"}},"  "),s("span",{style:{color:"#CB7676"}},"let "),s("span",{style:{color:"#BD976A"}},"_promise"),s("span",{style:{color:"#666666"}},": "),s("span",{style:{color:"#5DA9A7"}},"Promise"),s("span",{style:{color:"#666666"}},"<"),s("span",{style:{color:"#5DA9A7"}},"T"),s("span",{style:{color:"#666666"}},"> | "),s("span",{style:{color:"#CB7676"}},"undefined")]),l(`
`),s("span",{class:"line"}),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#DBD7CAEE"}},"  "),s("span",{style:{color:"#4D9375"}},"return"),s("span",{style:{color:"#DBD7CAEE"}}," "),s("span",{style:{color:"#666666"}},"()"),s("span",{style:{color:"#DBD7CAEE"}}," "),s("span",{style:{color:"#666666"}},"=>"),s("span",{style:{color:"#DBD7CAEE"}}," "),s("span",{style:{color:"#666666"}},"{")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#DBD7CAEE"}},"    "),s("span",{style:{color:"#4D9375"}},"if"),s("span",{style:{color:"#DBD7CAEE"}}," "),s("span",{style:{color:"#666666"}},"("),s("span",{style:{color:"#CB7676"}},"!"),s("span",{style:{color:"#BD976A"}},"_promise"),s("span",{style:{color:"#666666"}},")")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#DBD7CAEE"}},"      "),s("span",{style:{color:"#BD976A"}},"_promise"),s("span",{style:{color:"#DBD7CAEE"}}," "),s("span",{style:{color:"#666666"}},"="),s("span",{style:{color:"#DBD7CAEE"}}," "),s("span",{style:{color:"#80A665"}},"fn"),s("span",{style:{color:"#666666"}},"()")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#DBD7CAEE"}},"    "),s("span",{style:{color:"#4D9375"}},"return"),s("span",{style:{color:"#DBD7CAEE"}}," "),s("span",{style:{color:"#BD976A"}},"_promise")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#DBD7CAEE"}},"  "),s("span",{style:{color:"#666666"}},"}")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#666666"}},"}")]),l(`
`),s("span",{class:"line"})])]),s("pre",{class:"shiki shiki-light",style:{"background-color":"#ffffff"}},[s("code",{"v-pre":""},[s("span",{class:"line"},[s("span",{style:{color:"#1E754F"}},"export"),s("span",{style:{color:"#393A34"}}," "),s("span",{style:{color:"#AB5959"}},"function"),s("span",{style:{color:"#393A34"}}," "),s("span",{style:{color:"#59873A"}},"createSingletonPromise"),s("span",{style:{color:"#999999"}},"<"),s("span",{style:{color:"#2E808F"}},"T"),s("span",{style:{color:"#999999"}},">("),s("span",{style:{color:"#59873A"}},"fn"),s("span",{style:{color:"#999999"}},": () => "),s("span",{style:{color:"#2E808F"}},"Promise"),s("span",{style:{color:"#999999"}},"<"),s("span",{style:{color:"#2E808F"}},"T"),s("span",{style:{color:"#999999"}},">)"),s("span",{style:{color:"#393A34"}}," "),s("span",{style:{color:"#999999"}},"{")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#393A34"}},"  "),s("span",{style:{color:"#AB5959"}},"let "),s("span",{style:{color:"#B07D48"}},"_promise"),s("span",{style:{color:"#999999"}},": "),s("span",{style:{color:"#2E808F"}},"Promise"),s("span",{style:{color:"#999999"}},"<"),s("span",{style:{color:"#2E808F"}},"T"),s("span",{style:{color:"#999999"}},"> | "),s("span",{style:{color:"#AB5959"}},"undefined")]),l(`
`),s("span",{class:"line"}),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#393A34"}},"  "),s("span",{style:{color:"#1E754F"}},"return"),s("span",{style:{color:"#393A34"}}," "),s("span",{style:{color:"#999999"}},"()"),s("span",{style:{color:"#393A34"}}," "),s("span",{style:{color:"#999999"}},"=>"),s("span",{style:{color:"#393A34"}}," "),s("span",{style:{color:"#999999"}},"{")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#393A34"}},"    "),s("span",{style:{color:"#1E754F"}},"if"),s("span",{style:{color:"#393A34"}}," "),s("span",{style:{color:"#999999"}},"("),s("span",{style:{color:"#AB5959"}},"!"),s("span",{style:{color:"#B07D48"}},"_promise"),s("span",{style:{color:"#999999"}},")")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#393A34"}},"      "),s("span",{style:{color:"#B07D48"}},"_promise"),s("span",{style:{color:"#393A34"}}," "),s("span",{style:{color:"#999999"}},"="),s("span",{style:{color:"#393A34"}}," "),s("span",{style:{color:"#59873A"}},"fn"),s("span",{style:{color:"#999999"}},"()")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#393A34"}},"    "),s("span",{style:{color:"#1E754F"}},"return"),s("span",{style:{color:"#393A34"}}," "),s("span",{style:{color:"#B07D48"}},"_promise")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#393A34"}},"  "),s("span",{style:{color:"#999999"}},"}")]),l(`
`),s("span",{class:"line"},[s("span",{style:{color:"#999999"}},"}")]),l(`
`),s("span",{class:"line"})])])])])]),s("p",null,[l("This function is also available in my utilities collection "),s("a",{href:"https://github.com/antfu/utils",target:"_blank",rel:"noopener"},[s("code",null,"@antfu/utils")])])],-1),u="Optimize Await",m="2021-07-01T16:00:00.000Z",E="en",C="8min",k="https://antfu.me/og/optimize-await.png",g=[{property:"og:title",content:"Optimize Await"},{property:"og:image",content:"https://antfu.me/og/optimize-await.png"},{name:"twitter:card",content:"summary_large_image"}],h={__name:"optimize-await",setup(i,{expose:n}){const o={title:"Optimize Await",date:"2021-07-01T16:00:00.000Z",lang:"en",duration:"8min",image:"https://antfu.me/og/optimize-await.png",meta:[{property:"og:title",content:"Optimize Await"},{property:"og:image",content:"https://antfu.me/og/optimize-await.png"},{name:"twitter:card",content:"summary_large_image"}]};return n({frontmatter:o}),a({title:"Optimize Await",meta:[{property:"og:title",content:"Optimize Await"},{property:"og:image",content:"https://antfu.me/og/optimize-await.png"},{name:"twitter:card",content:"summary_large_image"}]}),(B,D)=>{const e=p;return r(),t(e,{frontmatter:o},{default:c(()=>[y]),_:1})}}};export{m as date,h as default,C as duration,k as image,E as lang,g as meta,u as title};
